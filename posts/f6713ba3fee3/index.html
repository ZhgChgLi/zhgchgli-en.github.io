<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Implementing Google Services RPA Automation with Google Apps Script" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Implementing Robotic Process Automation for Google Workspace services using Google Apps Script" /><meta property="og:description" content="Implementing Robotic Process Automation for Google Workspace services using Google Apps Script" /><link rel="canonical" href="https://en.zhgchg.li/posts/f6713ba3fee3/" /><meta property="og:url" content="https://en.zhgchg.li/posts/f6713ba3fee3/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-04-14T23:16:45+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg" /><meta property="twitter:title" content="Implementing Google Services RPA Automation with Google Apps Script" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-04-16T15:46:35+08:00","datePublished":"2024-04-14T23:16:45+08:00","description":"Implementing Robotic Process Automation for Google Workspace services using Google Apps Script","headline":"Implementing Google Services RPA Automation with Google Apps Script","image":"https://en.zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/f6713ba3fee3/"},"url":"https://en.zhgchg.li/posts/f6713ba3fee3/"}</script><title>Implementing Google Services RPA Automation with Google Apps Script | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Implementing Google Services RPA Automation with Google Apps Script</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Implementing Google Services RPA Automation with Google Apps Script</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1713107805" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 14, 2024 </em> </span> <span> Updated <em class="" data-ts="1713253595" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 16, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="7984 words" > <em>44 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="implementing-google-services-rpa-automation-with-google-apps-script"><span class="me-2">Implementing Google Services RPA Automation with Google Apps Script</span><a href="#implementing-google-services-rpa-automation-with-google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Implementing Robotic Process Automation for Google Workspace services using Google Apps Script</p><p><a href="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg" alt="Photo by [Possessed Photography](https://unsplash.com/@possessedphotography?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p>Photo by <a href="https://unsplash.com/@possessedphotography?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Possessed Photography</a></p><h3 id="robotic-process-automation"><span class="me-2">Robotic Process Automation</span><a href="#robotic-process-automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>RPA (Robotic Process Automation) translates to “process automation robots” in Chinese. Looking back at human history, from hand-gathering to the Stone Age, then to agricultural civilization, from the industrial revolution of the last century to the information boom of the past 20 years, human work efficiency and productivity have grown exponentially. Along the way, RPA applications have been ubiquitous, such as waterwheels in the agricultural era (automated threshing work), textile machines in the industrial revolution (automated textile work), factory robotic arms (automated assembly work), and finally, the automated information-related work introduced in this article, such as automatic report queries, automatic notifications, and so on.</p><p>Embarrassingly, I only recently learned this term. Since my first job (7 years ago), I have been doing RPA-related work, such as writing crawlers to collect statistics, automating CI/CD processes, automating data queries, automating stability data alerts, and automating daily routine operations. However, I used to refer to it simply as “automation.” It’s time to give it a proper name — RPA (Robotic Process Automation).</p><p><strong>Previously, my RPA efforts focused more on “writing code to automate tasks to solve single problems,”</strong> lacking comprehensive preliminary evaluation and analysis, the use of No/Low Code tools, regulations, operational monitoring, actual data statistics, continuous improvement, corporate culture promotion, and so on. These are all essential aspects of complete RPA. However, as mentioned earlier, I only recently learned about this professional field, so let me start with a practical article!</p><p>There are many platforms providing RPA services, such as Automation Anywhere, UiPath, Microsoft Power Automate, Blue Prism, or Zapier, IFTTT, Automate.io. You need to choose the appropriate service based on the actual problem you want to solve and the platform.</p><p>I recommend a free open-source browser-based RPA tool: <a href="https://chromewebstore.google.com/detail/automa/infppggnoaenmfagbfknfkancpbljcca" target="_blank">Automa</a>.</p><blockquote><p><strong><em>Broadly speaking, transforming the active dependence between people or between people and tasks into dependence on platforms is also a form of RPA.</em></strong></p></blockquote><blockquote><p><strong><em>For example: using project management tools like Asana/Jira to manage work tasks uniformly.</em></strong></p></blockquote><blockquote><p><strong><em>Based on the concept of transforming active to passive, we can also implement an RPA for services that originally required manual checks for new notifications, automatically notifying us when there are new changes.</em></strong></p></blockquote><blockquote><p><strong><em>For example: The previously implemented <a href="../d414bdbdb8c9/">Gmail to Slack</a> forwards specific notification emails to the work group.</em></strong></p></blockquote><h4 id="evaluation-of-the-benefits-of-robotic-process-automation"><span class="me-2">Evaluation of the Benefits of Robotic Process Automation</span><a href="#evaluation-of-the-benefits-of-robotic-process-automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Previously, in the “<a href="../11f6c8568154/"><strong>2021 Pinkoi Tech Career Talk — Unveiling the Secrets of a Highly Efficient Engineering Team</strong></a>”, we discussed the costs of small accumulations and interruptions in flow; assuming a routine repetitive task takes 15 minutes to solve each time, occurs 10 times a week, and wastes nearly 130 hours a year; if we also consider the cost of “context switching,” it could ultimately waste nearly 200 hours a year.</p><p><a href="/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.png" alt="[**2021 Pinkoi Tech Career Talk — Unveiling the Secrets of a Highly Efficient Engineering Team**](../11f6c8568154/)" class="lazyload" data-proofer-ignore></a></p><p><a href="../11f6c8568154/"><strong>2021 Pinkoi Tech Career Talk — Unveiling the Secrets of a Highly Efficient Engineering Team</strong></a></p><blockquote><p>Context switching means that when we are highly focused on important tasks, we need to pause to handle other matters, and the time it takes to get back into the state after handling them.</p></blockquote><p>The benefits evaluation of developing RPA can refer to the figure below. As long as the development time required and the frequency encountered are greater than the time wasted, it is worth investing resources to implement:</p><p><a href="/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.png" alt="[https://twitter.com/swyx/status/1196401158744502272](https://twitter.com/swyx/status/1196401158744502272){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p><a href="https://twitter.com/swyx/status/1196401158744502272" target="_blank">https://twitter.com/swyx/status/1196401158744502272</a></p><ul><li>X-axis: Task frequency ex: 50/Day (50 times a day)<li>Y-axis: How much manpower time is required to complete the task each time<li>Time cost range is calculated over 5 years, the middle of the table indicates the manpower cost wasted over 5 years<li>White indicates that the time cost of automation is greater than the benefits obtained, not worth improving<li>Green indicates items worth automating<li>Red strongly suggests converting to automation</ul><blockquote><p><strong><em>In addition to saving time, automated standardized processes can also reduce the chance of human error and improve stability.</em></strong></p></blockquote><h4 id="the-relationship-between-robotic-process-automation-and-ai"><span class="me-2">The Relationship Between Robotic Process Automation and AI</span><a href="#the-relationship-between-robotic-process-automation-and-ai" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>With the rise of AI, RPA is also frequently mentioned; but I think RPA has no direct relationship with AI, <strong>RPA existed long before the era of AI, and the benefits of AI adoption in enterprises may not be as high as the benefits of perfecting RPA. RPA is more about corporate culture and work habits</strong>; however, it is undeniable that AI can indeed help RPA reach the next level. For example, RPA used to only handle precise, routine tasks, but with AI, it can handle some fuzzy, more dynamic, and intelligent judgment tasks.</p><h3 id="robotic-process-automation-at-google-workspace"><span class="me-2">Robotic Process Automation at Google Workspace</span><a href="#robotic-process-automation-at-google-workspace" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Google Workspace (formerly G Suite) is our daily office collaboration partner. We use Gmail for email hosting, Google Docs for documents, Google Sheets for spreadsheets, Google Forms for forms, etc. The integration between these services or communication with internal and external systems requires us to implement RPA to complete.</p><p>However, Google does not provide direct RPA services, which can be achieved through the following services:</p><ul><li>No Code: <a href="https://cloud.google.com/appsheet#pricing" target="_blank">App Sheet</a> (paid service), allows non-developers to directly build service integration automation through GUI.<li>Low Code: <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a> (free service), allows quick and direct bridging of Google services, external/internal systems with simple programming.<li>Function as a Service: <a href="https://cloud.google.com/functions?hl=zh_tw" target="_blank">Cloud Functions</a> (paid service with free tier), allows writing complete code and services, deployed and executed directly through Google Cloud.</ul><p>I haven’t used the No Code platform <a href="https://cloud.google.com/appsheet#pricing" target="_blank">App Sheet</a>, but I have quite a bit of experience with <a href="https://cloud.google.com/functions?hl=zh_tw" target="_blank">Cloud Functions</a> and <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a>. Here are some personal experiences and choices:</p><h4 id="cloud-functions"><span class="me-2">Cloud Functions</span><a href="#cloud-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Requires deployment to execute<li>Supports multiple programming languages: Node.js, Python, Java, Go, PHP, Ruby…<li>Supports third-party package dependency management, installation, and usage<li>Supports complete authentication mechanisms<li>Maximum execution time limit: 60 minutes<li>Pay-as-you-go: charged based on the number of invocations, execution time, different processors, and memory used<li>Limited by cold start issues (if not called for a long time, the first call will take longer response time)<li>Cannot directly integrate with Google services, needs to go through Auth/API authentication<li><strong>Free tier as follows</strong> Cloud Functions offers a perpetual free tier for compute time resources, including allocations of GB-seconds and GHz-seconds. In addition to 2 million invocations, this free tier also provides 400,000 GB-seconds and 200,000 GHz-seconds of compute time, as well as 5 GB of internet data transfer per month. The free tier usage is calculated in equivalent USD amounts at the Tier 1 pricing level. Regardless of whether the function execution region uses Tier 1 and/or Tier 2 pricing, the equivalent USD amount will be allocated to you. However, when deducting the free tier quota, the system will be based on the function execution region’s tier (Tier 1 or Tier 2). Please note that even if you are using the free tier, you must have a valid billing account.</ul><p>In summary, Cloud Functions are recommended when more comprehensive and complex RPA integration functions or more external API integration needs are required.</p><p>Previous cases using Cloud Functions include:</p><ul><li><a href="../bd94cc88f9c9/">Slack ChatGPT Conversation Bot</a><li><a href="../70a1409b149a/">Automatic Check-in Bot</a></ul><p>I use it when integrating with non-Google Workspace services and bridging other external services.</p><h4 id="google-apps-script"><span class="me-2">Google Apps Script</span><a href="#google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Convenient, simple, and fast<li>Completely free<li>No cumbersome and complex Auth authentication required for service integration (Google Apps Script uses the currently executing account as the execution identity)<li>Built-in scheduling and calendar trigger functions<li>Use Google network to execute network requests<li>Can only use Google Apps Script (based on JavaScript) for development<li>Does not support package management tools, no version control function<li><strong>Due to security issues, <a href="https://issuetracker.google.com/issues/36758197" target="_blank">customizing Request User-Agent information is not possible</a></strong><li><strong>Execution time limit, the script must complete the work within 6 minutes, otherwise, it will be terminated.</strong><li>For other restrictions and quotas, please refer to the official <a href="https://developers.google.com/apps-script/guides/services/quotas?hl=zh-tw" target="_blank">GAS information</a>:</ul><p><a href="/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Previous cases using Google Apps Script include:</p><ul><li><a href="../d61062833c1a/">Integrating Slack x Google Form x Google Sheet</a><li><a href="../d414bdbdb8c9/">Integrating Slack x Gmail</a><li><a href="../793cb8f89b72/">Integrating Google Analytics x Slack</a><li><a href="../e77b80cc6f89/">Integrating Firebase Crashlytics x Big Query x Slack</a><li><a href="../382218e15697/">Integrating Github x LineBot</a></ul><p>Due to execution time and API Request customization limitations, I only use Google Apps Script for simple and quick services; or when there is a need to integrate with Google services, I will prioritize using Google Apps Script (because using Cloud Functions requires implementing a complete Google service authentication process).</p><h3 id="robotic-process-automation-with-google-apps-script--work-daily-report-google-sheet-x-google-analytics"><span class="me-2">Robotic Process Automation with Google Apps Script — Work Daily Report (Google Sheet x Google Analytics)</span><a href="#robotic-process-automation-with-google-apps-script--work-daily-report-google-sheet-x-google-analytics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Finally, we come to the topic of this article, using Google Apps Script to achieve Google service RPA automation.</p><h4 id="background"><span class="me-2">Background</span><a href="#background" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The product team needs to query Google Analytics data daily and fill it into the Google Sheet data report for team trend analysis; and publish the daily data content to the Dashboard screen so that all members can grasp the current situation.</p><p>Colleagues need to spend about 30 minutes to complete this task every day when they arrive at the company; if there are other things to deal with, they need to wait until this routine work is completed or delay the release of daily data messages.</p><p><strong>Simple estimation of RPA benefits:</strong></p><ul><li>Annual consumption expenditure: 1 person x 30 mins x 365 days (holiday data also needs to be supplemented) <strong>= 182 hours</strong><li>Automation setup cost: In this case, it takes about 1 person x 5 days <strong>= 40 hours</strong></ul><blockquote><p>Therefore, we only need to invest one week of development time to solve the workload of the colleague responsible for data checking in the long run, allowing them to focus on more important tasks.</p></blockquote><h4 id="goal"><span class="me-2">Goal</span><a href="#goal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Our goal is to use Google Apps Script to create an RPA that automatically retrieves daily data from Google Analytics and internal system report APIs and fills it into Google Sheets, as well as setting up a Web UI Dashboard.</p><h4 id="final-effect"><span class="me-2">Final Effect</span><a href="#final-effect" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.png" alt="" class="lazyload" data-proofer-ignore></a></p><ul><li>Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing" target="_blank">https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing</a></ul><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png" alt="" class="lazyload" data-proofer-ignore></a></p><ul><li>Web GUI URL: <a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></ul><blockquote><p><strong><em>The data is fake, purely for demo use; from 2024/04/13 onwards, it will be particularly low or remain at 0 because my zhgchg.li GA really has “0” traffic Q_Q.</em></strong></p></blockquote><h4 id="tasks-to-complete"><span class="me-2">Tasks to Complete</span><a href="#tasks-to-complete" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>Create Google Apps Script, familiarize with the editor<li>Obtain/create the corresponding date Sheet<li>Connect to Google Analytics to retrieve data<li>Populate data<li>Set up scheduling for daily automatic execution</ol><h4 id="disclaimer"><span class="me-2">Disclaimer</span><a href="#disclaimer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>For the sake of explanation, the following code will be as less abstract as possible and more explanatory. You can modify it according to your actual needs.</p><blockquote><p><strong><em>A complete public Google Sheet &amp; Google Apps Script is attached at the end of the article. If you are too lazy to follow step by step, you can directly modify the template provided at the end.</em></strong></p></blockquote><h4 id="step-1-create-google-apps-script"><span class="me-2">Step 1. Create Google Apps Script</span><a href="#step-1-create-google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Simply select “Extensions” -&gt; “Apps Script” on the report we want to automate to automatically create a Google Apps Script linked to the Google Sheet report.</p><p>Alternatively, you can directly create it from the Google Apps Script homepage <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a>, but this will not link to the Google Sheet.</p><blockquote><p><strong>It is not necessary to link to operate the corresponding Google Sheet</strong>, both methods can be used. The difference lies in the ownership of the Script. If it is linked to the report, it belongs to the report owner; if created by yourself, it belongs to the creator. Ownership will affect whether the script will be invalidated or deleted if the account is deactivated due to resignation.</p></blockquote><p><a href="/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>After creating the script, we can first rename our script project from the top.</p><h4 id="google-apps-script-basics"><span class="me-2">Google Apps Script Basics</span><a href="#google-apps-script-basics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Before moving on to the next step of writing the program, let’s supplement some basic knowledge of Google Apps Script.</p><p><strong>About the Editor</strong></p><p>The SDK for Google services is introduced by default (no special introduction is required to call and use):</p><ul><li>CalendarApp Calendar<li>DocumentApp Google Drive<li>FormApp Google Form<li>SpreadsheetApp Google Sheet<li>GmailApp Gmail<li><a href="https://developers.google.com/apps-script/reference/slides/border?hl=zh-tw#getdashstyle" target="_blank">Others…</a></ul><p><a href="/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><ol><li>File: You can add multiple <code class="language-plaintext highlighter-rouge">.gs</code> files to store different object codes for better organization; all files will execute under the same Namespace and lifecycle, so be careful as object names and variable names may overwrite each other if duplicated. In addition to <code class="language-plaintext highlighter-rouge">.gs</code> script files, you can also add <code class="language-plaintext highlighter-rouge">.html</code> HTML Template files for rendering Web UI. (This will be introduced later)<li>Library: Libraries written by others (a.k.a Lib) can be imported using their Script ID. Of course, the scripts we write can also be deployed as libraries for others to use. There are also some tools packaged by experts that can be used, but the downside is that you can only search for Script IDs via Google, as there is no official library list for reference. e.g. HTML Parser Tool Cheer.io Script ID: <code class="language-plaintext highlighter-rouge">1ReeQ6WO8kKNxoaA_O0XEQ589cIrRvEBA9qcWpNqdOP17i47u6N9M5Xh0</code><li>Services: SDKs for Google services. Services not included by default can be added here. e.g. Google Analytics Data<li>Undo, Redo<li>Save or Control + s<li>Run or Control + r Errors will be directly prompted in the Console and the script will terminate.<li>Debug Execution will pause and the right-side Debug View will pop up when it hits a Break point (10). You can then continue execution. Errors will pause execution and the right-side Debug View will pop up.<li>Target method for debugging and execution (Function Name) Only methods in the currently selected file can be chosen.<li>View editor execution logs</ol><blockquote><p><em>Another point to note is indentation. In some browsers, pressing “Control + [” to indent will trigger the back page action, so be careful!</em></p></blockquote><p><a href="https://chromewebstore.google.com/detail/lfjcgcmkmjjlieihflfhjopckgpelofo" target="_blank"><strong>Google Apps Script GitHub Assistant Chrome Extension</strong></a></p><ul><li>It is recommended to install this Extension to connect Google Apps Script with git, enabling version control to prevent accidental changes.</ul><p><a href="/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.png" alt="" class="lazyload" data-proofer-ignore></a></p><ul><li>If you encounter Push/Pull Errors or no response when clicking, please follow the steps above: “Options” -&gt; Connect to Github or re-authenticate Google authorization.</ul><p><strong>Logger Message</strong></p><p>You can use the following script with Debug to print Debug Logs in the Console.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hi</span><span class="dl">"</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>Execution Logs and Error Information</strong></p><p>Logs or errors during execution in the editor will be displayed directly. To check execution logs or errors during automatic execution, go to the “Executions” tab.</p><p><a href="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><strong>Automatic Triggers</strong></p><p><a href="/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>The “Triggers” tab allows you to set how methods in the script are automatically triggered. The automatic trigger conditions that can be set include:</p><ul><li>When Google Sheet: opens, edits, content changes, form submissions<li>Scheduled triggers: every X minutes, X hours, X days, X weeks, X months<li>Specific date triggers: YYYY-MM-DD HH:MM<li>When Calendar: updates</ul><p>Error notification settings can be configured to notify you when the script execution fails.</p><p><strong>Grant Execution Permissions</strong></p><blockquote><p><strong><em>The first execution/deployment or adding new services/resources will require re-authorization. Subsequent executions will use the authorized identity, so ensure that the authorized (usually current) account has the necessary permissions for the resources/services (e.g., Google Sheet permissions).</em></strong></p></blockquote><p>After the account selection pop-up appears, choose the account to authorize for execution (usually the current Google Apps Script account):</p><p><a href="/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>The message “Google hasn’t verified this app” appears because the app we are developing is for personal use and does not need to be verified by Google.</p><p>Simply click “Advanced” -&gt; “Go to XXX (unsafe)” -&gt; “Allow”:</p><p><a href="/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>After completing the authorization, you can successfully run the script. If there are no changes to the resources, re-authorization is not required.</p><h4 id="2-obtaincreate-the-sheet-for-the-corresponding-date"><span class="me-2">2. Obtain/Create the Sheet for the Corresponding Date</span><a href="#2-obtaincreate-the-sheet-for-the-corresponding-date" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After understanding the basic knowledge, we can write the program for the first function.</p><p>We create the following multiple files to store different objects:</p><p><code class="language-plaintext highlighter-rouge">DailyReportStyle.gs</code> field style object:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">HeaderStyle</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#e3284b</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">ContentStyle</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#000000</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">HeaderDateStyle</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#001a40</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">DailyReportField.gs</code> field data object:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">DailyReportField</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">headerStyle</span><span class="p">,</span> <span class="nx">contentStyle</span><span class="p">,</span> <span class="nx">format</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">headerStyle</span> <span class="o">=</span> <span class="nx">headerStyle</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">contentStyle</span> <span class="o">=</span> <span class="nx">contentStyle</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="nx">format</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">DailyReport.gs</code> main report program logic:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">DailyReport</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">HeaderDateStyle</span><span class="p">()),</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Day of the Week</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">HeaderDateStyle</span><span class="p">()),</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Daily Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;5)</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// =4(PC Traffic) + 5(Mobile Traffic)</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">PC Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">),</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Mobile Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">),</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Registrations</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1">// Explanation of the daily traffic formula:</span>
    <span class="c1">// 1. The COLUMN() function returns the column number of the current cell.</span>
    <span class="c1">// 2. ADDRESS(1, COLUMN(), 4) generates an absolute reference address with the given row number (result of `COLUMN()`) and fixed column number (1). The third parameter 4 indicates a relative address without any dollar signs ($). For example, if you use this function in any cell in the third column, it will return "C1".</span>
    <span class="c1">// 3. SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") removes the number 1 from the address generated by the ADDRESS function, leaving only the column letter, e.g., "C".</span>
    <span class="c1">// 4. INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") &amp; 4) here &amp; 4 should actually be &amp;4. The result of the `SUBSTITUTE` function is concatenated with the number 4, forming a string like "C4", and then the INDIRECT function converts this string into the corresponding cell reference. So, if you use this formula in any cell in column C, it will reference C4.</span>
    <span class="c1">// 5. Similarly, `INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") &amp; 5)` references the cell in the fifth row of the same column. For example, if you use this formula in any cell in column C, it will reference C5.</span>
    <span class="c1">// 6. Finally, the values of the cells referenced by these two INDIRECT functions are added together.</span>
  <span class="p">}</span>

  <span class="nx">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSheet</span><span class="p">();</span>

  <span class="p">}</span>

  <span class="c1">// Get the target Sheet for the given date</span>
  <span class="nx">getSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Distinguish Sheets by month, find the current month's Sheet</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getSheetName</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">thisMonthSheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// If not found, create a new monthly Sheet</span>
      <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">makeMonthSheet</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Monthly Sheet naming convention</span>
  <span class="nx">getSheetName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Create a new monthly Sheet</span>
  <span class="nx">makeMonthSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Add the current month's Sheet, move it to the first position</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nx">insertSheet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getSheetName</span><span class="p">(),</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">activate</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nx">moveActiveSheet</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// Add the first column, field names, set Pinned, width 200</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">insertColumnsBefore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">setFrozenColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">setColumnWidths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

    <span class="c1">// Fill in the field names</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">headerStyle</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nx">setHorizontalAlignment</span><span class="p">(</span><span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Set row heights</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">setRowHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

    <span class="c1">// Set Pinned for the first and second rows (Date, Day of the Week)</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">setFrozenRows</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// Add a summary column</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">insertColumnsAfter</span><span class="p">(</span><span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getLastColumn</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Add one column after the last column</span>
    <span class="kd">const</span> <span class="nx">summaryColumnIndex</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getLastColumn</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Fill in the summary column</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">summaryRowIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Date...</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Total</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Day of the Week...merge...</span>
        <span class="kd">const</span> <span class="nx">mergeRange</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">,</span> <span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">mergeRange</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Total</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="nx">mergeRange</span><span class="p">.</span><span class="nx">merge</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">)), 0)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>

        <span class="c1">// 1. The IFERROR(value, [value_if_error]) function is used to check if there is an error in the formula and return a specified value if there is an error. It takes two parameters: `value` is the expression or function to be calculated, and `value_if_error` is the value returned when value has an error. In this context, if the calculation in the SUM function has an error, it returns 0.</span>
        <span class="c1">// 2. The SUM(range) function is used to calculate the sum of all numbers in the range.</span>
        <span class="c1">// 3. The INDIRECT(ref_text, [is_A1_notation]) function converts a text string into a cell reference. Here, the INDIRECT function is used to dynamically generate the required reference range.</span>
        <span class="c1">// 4. The SUBSTITUTE(text, old_text, new_text, [instance_num]) function replaces specified text in a text string. Here, SUBSTITUTE is used to replace the "1" in the address returned by the ADDRESS function with other content.</span>
        <span class="c1">// 5. The ADDRESS(row, column, [abs_num], [a1], [sheet]) function returns the cell address corresponding to the given row and column numbers. Here, ADDRESS(1, 1, 4) generates the cell address of the first row and first column, but since abs_num is 4, the address does not include the worksheet name and fixed symbol $. Similarly, `ADDRESS(1, COLUMN() - 1, 4)` generates the cell address from the first row to the previous column of the current column.</span>
        <span class="c1">// 6. The COLUMN() function returns the column number of the current cell.</span>
        <span class="c1">// 7. summaryRowIndex = the row number</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nx">setBackgroundColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nx">setFontColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">bold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nx">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nx">setHorizontalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">horizontalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nx">setVerticalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">verticalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nx">setFontSize</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nx">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span><span class="p">,</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">BorderStyle</span><span class="p">.</span><span class="nx">SOLID</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> as the main program entry point:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">function</span> <span class="nx">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
  <span class="nx">report</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>After completion, we return to <code class="language-plaintext highlighter-rouge">Main.gs</code>, select “debug” and press debug to check if the execution result is correct and if there are any errors.</p><p><a href="/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>If executed correctly, the report will show the current new month, with default fields and total fields. If it already exists, there will be no response.</p><h4 id="3-integrate-google-analytics-to-fetch-data"><span class="me-2">3. Integrate Google Analytics to fetch data</span><a href="#3-integrate-google-analytics-to-fetch-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>First, you need to add the “AnalyticsData” service:</p><p><a href="/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Use the GA4 Debug Tool to construct query conditions:</p><ul><li><a href="https://ga-dev-tools.google/ga4/query-explorer/" target="_blank">https://ga-dev-tools.google/ga4/query-explorer/</a><li>You can compare and construct the filtering conditions in the GA 4 backend<li><strong>This article uses querying the number of Sessions as an example, distinguishing device Grouping</strong></ul><p>Log in and authorize, then select the target resource:</p><p><a href="/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Note down the number displayed under the property, which is the GA Property ID you want to query.</p><p>Set query parameters and Filter conditions:</p><p><a href="/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Press “Make Request” to get the Response result:</p><p><a href="/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>You can simultaneously compare the data with the same conditions in the GA 4 backend to see if they match. If there is a significant difference, it might be because some Filter conditions were not added, so you need to check again.</p><h4 id="note"><span class="me-2">Note</span><a href="#note" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>A small pitfall discovered by a marketing colleague: some GA data may have delay issues, meaning the numbers you check today might be different from those you checked yesterday (e.g., bounce rate). Therefore, it’s best to backtrack the data a few days to ensure the final numbers are accurate.</p><blockquote><p><em>After confirming that the GA Debug Tool is working correctly, we can convert it into Google Apps Script.</em></p></blockquote><p>Add a new <code class="language-plaintext highlighter-rouge">GAData.gs</code> file:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="c1">// Remember to add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined</span>
<span class="c1">// GA Debug Tool: https://ga-dev-tools.web.app/ga4/query-explorer/</span>

<span class="kd">class</span> <span class="nx">GAData</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">traffic</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fetchGADailyUsage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pc_traffic</span> <span class="o">=</span> <span class="nx">traffic</span><span class="p">[</span><span class="dl">"</span><span class="s2">desktop</span><span class="dl">"</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mobile_traffic</span> <span class="o">=</span> <span class="nx">traffic</span><span class="p">[</span><span class="dl">"</span><span class="s2">mobile</span><span class="dl">"</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="nx">fetchGADailyUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">dimensionPlatform</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nx">newDimension</span><span class="p">();</span>
    <span class="nx">dimensionPlatform</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">deviceCategory</span><span class="dl">"</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">metric</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nx">newMetric</span><span class="p">();</span>
    <span class="nx">metric</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">sessions</span><span class="dl">"</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">dateRange</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nx">newDateRange</span><span class="p">();</span>
    <span class="c1">// Default query for data within the given date range e.g. 2024-01-01 ~ 2024-01-01</span>
    <span class="nx">dateRange</span><span class="p">.</span><span class="nx">startDate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getDateString</span><span class="p">();</span>
    <span class="nx">dateRange</span><span class="p">.</span><span class="nx">endDate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getDateString</span><span class="p">();</span>

    <span class="c1">// Filter Example:</span>
    <span class="c1">// const filterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// const filter = AnalyticsData.newFilter();</span>
    <span class="c1">// filter.fieldName = "landingPagePlusQueryString";</span>
    <span class="c1">// const stringFilter = AnalyticsData.newStringFilter()</span>
    <span class="c1">// stringFilter.value = "/life|/article|/chat|/house|/event/230502|/event/230310";</span>
    <span class="c1">// stringFilter.matchType = "PARTIAL_REGEXP";</span>
    <span class="c1">// filter.stringFilter = stringFilter;</span>
    <span class="c1">// filterExpression.filter = filter;</span>

    <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nx">newRunReportRequest</span><span class="p">();</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="nx">dimensionPlatform</span><span class="p">];</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="nx">metric</span><span class="p">];</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">dateRanges</span> <span class="o">=</span> <span class="nx">dateRange</span><span class="p">;</span>

    <span class="c1">// Filter Example:</span>
    <span class="c1">// const filterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// filterExpression.expression = filterExpression;</span>
    <span class="c1">// request.dimensionFilter = filterExpression;</span>
    <span class="c1">// or Not</span>
    <span class="c1">// const notFilterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// notFilterExpression.notExpression = filterExpression;</span>
    <span class="c1">// request.dimensionFilter = notFilterExpression;</span>

    <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">runReport</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="dl">"</span><span class="s2">properties/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">gaPropertyId</span><span class="p">).</span><span class="nx">rows</span><span class="p">;</span>
    <span class="c1">// No data</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">report</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">desktop</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">mobile</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// [{metricValues=[{value=4517}], dimensionValues=[{value=mobile}]}, {metricValues=[{value=3189}], dimensionValues=[{value=desktop}]}, {metricValues=[{value=63}], dimensionValues=[{value=tablet}]}]</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">report</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">element</span><span class="p">.</span><span class="nx">dimensionValues</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">metricValues</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">getDateString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM-dd</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> Add test content:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
  <span class="nx">report</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
  <span class="c1">//</span>
  <span class="kd">var</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GAData</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gaData</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Press run or debug to get the program fetch result:</p><p><a href="/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>OK! The comparison matches.</p><p><a href="/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>When this step is completed, the directory file structure is as shown above.</p><h4 id="4-fill-in-the-data"><span class="me-2">4. Fill in the data</span><a href="#4-fill-in-the-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After creating the Sheet and checking the data, the next step is to fill in the data into the fields.</p><p>Adjust <code class="language-plaintext highlighter-rouge">DailyReport.gs</code> to add logic for adding fields &amp; filling data by date:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">DailyReport</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">weekString</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">Sunday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Monday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Tuesday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Wednesday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Thursday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Friday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Saturday</span><span class="dl">"</span><span class="p">][</span><span class="nx">date</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()];</span> <span class="c1">// Get the day of the week, Sunday is 0, Monday is 1, and so on</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">HeaderDateStyle</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">dateString</span><span class="p">),</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Day</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">HeaderDateStyle</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">weekString</span><span class="p">),</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Daily Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;5)</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// =4(PC Traffic) + 5(Mobile Traffic)</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">PC Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">.</span><span class="nx">pc_traffic</span><span class="p">),</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Mobile Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">.</span><span class="nx">mobile_traffic</span><span class="p">),</span>
      <span class="k">new</span> <span class="nx">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Registrations</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">.</span><span class="nx">registers</span><span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSheet</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">dateColumnIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">makeOrGetDateColumn</span><span class="p">(</span><span class="nx">sheet</span><span class="p">);</span> <span class="c1">// Get the existing update or create a new field</span>

    <span class="c1">// Fill in the field content</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">rowIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">dateColumnIndex</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setFormat</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">format</span><span class="p">);</span>          
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Get the target Sheet for the given date</span>
  <span class="nx">getSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Distinguish Sheets by month, find the current month's Sheet</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getSheetName</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">thisMonthSheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// If not found, create a new month Sheet</span>
      <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">makeMonthSheet</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Month Sheet naming</span>
  <span class="nx">getSheetName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Create a new month Sheet</span>
  <span class="nx">makeMonthSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Add the current month's Sheet, move to the first position</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nx">insertSheet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getSheetName</span><span class="p">(),</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">activate</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nx">moveActiveSheet</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// Add the first column, field name, set Pinned, width 200</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">insertColumnsBefore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">setFrozenColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">setColumnWidths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

    <span class="c1">// Fill in the field names</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">headerStyle</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nx">setHorizontalAlignment</span><span class="p">(</span><span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Set row height</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">setRowHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

    <span class="c1">// Set Pinned for the first and second rows (Date, Day)</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">setFrozenRows</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// Add total field</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">insertColumnsAfter</span><span class="p">(</span><span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getLastColumn</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Add a column after the last column</span>
    <span class="kd">const</span> <span class="nx">summaryColumnIndex</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getLastColumn</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Fill in the total field</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">summaryRowIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Date...</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Total</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Day...merge...</span>
        <span class="kd">const</span> <span class="nx">mergeRange</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">,</span> <span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">mergeRange</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Total</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="nx">mergeRange</span><span class="p">.</span><span class="nx">merge</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">)), 0)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Create or get the date field</span>
  <span class="c1">// Add a field from the most recent day</span>
  <span class="nx">makeOrGetDateColumn</span><span class="p">(</span><span class="nx">sheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">firstRowColumnsRange</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getLastColumn</span><span class="p">());</span> <span class="c1">// Get the data range of the first row (date)</span>
    <span class="kd">const</span> <span class="nx">firstRowColumns</span> <span class="o">=</span> <span class="nx">firstRowColumnsRange</span><span class="p">.</span><span class="nx">getValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// Get the values of the data range, 0 = first row</span>
    
    <span class="kd">var</span> <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span> <span class="c1">// Find the index of the corresponding date field</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Not Found, find the position of the previous day</span>
      <span class="kd">var</span> <span class="nx">preDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
      <span class="nx">preDate</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

      <span class="k">while</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">preDate</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">sheet</span><span class="p">.</span><span class="nx">insertColumnsAfter</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Add a column after the previous day's field</span>
        <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sheet</span><span class="p">.</span><span class="nx">insertColumnsAfter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Default, directly add a column after the first column</span>
        <span class="nx">columnIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span> 

    <span class="c1">// Set column width</span>
    <span class="nx">sheet</span><span class="p">.</span><span class="nx">setColumnWidths</span><span class="p">(</span><span class="nx">columnIndex</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">columnIndex</span>
  <span class="p">}</span>

  <span class="c1">// Set field format style</span>
  <span class="nx">setFormat</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">format</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">format</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nx">setNumberFormat</span><span class="p">(</span><span class="nx">format</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Fill content into the field</span>
  <span class="nx">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nx">setBackgroundColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nx">setFontColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">bold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nx">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nx">setHorizontalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">horizontalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nx">setVerticalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">verticalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nx">setFontSize</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nx">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span><span class="p">,</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">BorderStyle</span><span class="p">.</span><span class="nx">SOLID</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Adjust <code class="language-plaintext highlighter-rouge">Main.gs</code> to add data integration and assign values during the build phase:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GAData</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nx">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
  
<span class="p">}</span>

<span class="c1">// Simulate some data that might be obtained by hitting other platform APIs.</span>
<span class="kd">function</span> <span class="nx">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXAMPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p>After completion, go back to <code class="language-plaintext highlighter-rouge">Main.gs</code>, select <code class="language-plaintext highlighter-rouge">debug</code>, and press debug to check if the execution result is correct and if there are any errors.</p><p><a href="/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Back to Google Sheet! Success! We have successfully added the data for the date automatically.</p><h4 id="5-set-up-a-schedule-for-daily-automatic-execution"><span class="me-2">5. Set up a schedule for daily automatic execution</span><a href="#5-set-up-a-schedule-for-daily-automatic-execution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After completing the script, just set up the automatic trigger conditions to complete it automatically every day.</p><p>Adjust <code class="language-plaintext highlighter-rouge">Main.gs</code> to add the <code class="language-plaintext highlighter-rouge">cronjob()</code> function:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cronjob</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// In reality, it is usually the data from yesterday that is checked today for complete data.</span>
<span class="kd">function</span> <span class="nx">cronjob</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">yesterday</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="nx">yesterday</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GAData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nx">fetchInHouseReportData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">yesterday</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Simulate some data that might be obtained by hitting other platform APIs.</span>
<span class="kd">function</span> <span class="nx">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXAMPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Switch to the “Triggers” tab in the editor and select “Add Trigger” in the bottom right corner:</p><p><a href="/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.png" alt="" class="lazyload" data-proofer-ignore></a></p><ul><li>Select the function you want to execute: the newly added <code class="language-plaintext highlighter-rouge">Main.gs</code> Function <code class="language-plaintext highlighter-rouge">cronjob</code><li>Select the deployment to execute: Head (latest version)<li>Select the event source: Time-driven<li>Select the type of time-based trigger: Day timer<li>Select the time period: AM 4:00 — AM 5:00 (GMT+08:00) Usually, it will execute as soon as it hits AM 4:00.<li>Error notification settings: Whether to notify immediately when the script encounters an error or to summarize it daily</ul><p><strong>Save the settings, and you’re done.</strong></p><p>You can then go to the “Executions” tab to check the execution record results:</p><p><a href="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote><p><strong><em>At this point, we have completed the RPA function for automating queries, adding data, and filling in data reports. 🎉🎉🎉</em></strong></p></blockquote><h4 id="setting-up-a-web-gui-dashboard"><span class="me-2">Setting Up a Web GUI Dashboard</span><a href="#setting-up-a-web-gui-dashboard" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Next, there is a secondary requirement. We need to create a simple web display of daily data (similar to a war room concept) that will be directly displayed on a large screen on the wall behind the team.</p><p><strong>The effect is as shown below:</strong></p><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><strong>Add <code class="language-plaintext highlighter-rouge">Web_DailyReport.gs</code> to read Google Sheets and convert the columns and styles to HTML format for display:</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">WebDailyReport</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">dayCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span> <span class="o">=</span> <span class="nx">dayCount</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sheetRows</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Day of the Week</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Daily Traffic</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">PC Traffic</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Mobile Traffic</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Registration Count</span><span class="dl">"</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="nx">allData</span><span class="p">(</span><span class="nx">startDate</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sheetRowsIndexs</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">preDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
      <span class="nx">preDate</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span> <span class="o">-</span> <span class="nx">count</span><span class="p">));</span>
      <span class="kd">const</span> <span class="nx">sheetName</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">targetSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="nx">sheetName</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">targetSheet</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">firstRowColumnsRange</span> <span class="o">=</span> <span class="nx">targetSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">targetSheet</span><span class="p">.</span><span class="nx">getLastColumn</span><span class="p">());</span> <span class="c1">// Get the range of the first row (date)</span>
        <span class="kd">const</span> <span class="nx">firstRowColumns</span> <span class="o">=</span> <span class="nx">firstRowColumnsRange</span><span class="p">.</span><span class="nx">getValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// Get the values of the range, 0 = first row</span>
        <span class="kd">var</span> <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span> <span class="c1">// Find the index of the corresponding date column</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetRows</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">sheetRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFieldRow</span><span class="p">(</span><span class="nx">targetSheet</span><span class="p">,</span> <span class="nx">sheetRow</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Add the first column</span>
            <span class="kd">const</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">].</span><span class="nx">map</span><span class="p">((</span><span class="nx">rowIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">targetSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="kd">const</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">].</span><span class="nx">map</span><span class="p">((</span><span class="nx">rowIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">targetSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">columnIndex</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
          <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nx">count</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">transformResult</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">columnIndex</span> <span class="k">in</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">rowIndex</span> <span class="k">in</span> <span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">columnIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">].</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">][</span><span class="nx">rowIndex</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">][</span><span class="nx">rowIndex</span><span class="p">]);</span>
        <span class="p">}</span>
        
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">transformResult</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Convert field attributes to display objects</span>
  <span class="nx">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">getDisplayValues</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nx">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">backgroundColors</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">getBackgrounds</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nx">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">colors</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">getFontColorObjects</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nx">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">sizes</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">getFontSizes</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nx">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">bolds</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">getFontWeights</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nx">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">horizontalAlignments</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">getHorizontalAlignments</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nx">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">verticalAlignments</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">getVerticalAlignments</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nx">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="nx">row</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">backgroundColor</span><span class="dl">"</span><span class="p">:</span> <span class="nx">backgroundColors</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">color</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorStripper</span><span class="p">(</span><span class="nx">colors</span><span class="p">[</span><span class="nx">index</span><span class="p">]?.</span><span class="nx">asRgbColor</span><span class="p">()?.</span><span class="nx">asHexString</span><span class="p">()),</span>
          <span class="dl">"</span><span class="s2">size</span><span class="dl">"</span><span class="p">:</span> <span class="nx">sizes</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">:</span> <span class="nx">bolds</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">horizontalAlignment</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">alignConventer</span><span class="p">(</span><span class="nx">horizontalAlignments</span><span class="p">[</span><span class="nx">index</span><span class="p">]),</span>
          <span class="dl">"</span><span class="s2">verticalAlignment</span><span class="dl">"</span><span class="p">:</span> <span class="nx">verticalAlignments</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">colorStripper</span><span class="p">(</span><span class="nx">colorString</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">colorString</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">colorString</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">colorString</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">"</span><span class="s2">#</span><span class="dl">"</span><span class="o">+</span><span class="nx">colorString</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">colorString</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">alignConventer</span><span class="p">(</span><span class="nx">horizontalAlignment</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">horizontalAlignment</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="nx">or</span> <span class="nx">horizontalAlignment</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">horizontalAlignment</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">general-</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">getFieldRow</span><span class="p">(</span><span class="nx">sheet</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">firstColumnRowsRange</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getLastRow</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Get the range of the first column (field)</span>
    <span class="kd">const</span> <span class="nx">firstColumnRows</span> <span class="o">=</span> <span class="nx">firstColumnRowsRange</span><span class="p">.</span><span class="nx">getValues</span><span class="p">();</span> <span class="c1">// Get the values of the range</span>
    <span class="kd">const</span> <span class="nx">foundIndex</span> <span class="o">=</span> <span class="nx">firstColumnRows</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">((</span><span class="nx">firstColumnRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">firstColumnRow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">name</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">foundIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">foundIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> <strong>Add Web Request Handle:</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cronjob</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">cronjob</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">yesterday</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="nx">yesterday</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GAData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nx">fetchInHouseReportData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">yesterday</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web_DailyReport_ Scaffolding</span><span class="dl">'</span><span class="p">).</span><span class="nx">evaluate</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getDailyReportBody</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web_DailyReport_Body</span><span class="dl">'</span><span class="p">).</span><span class="nx">evaluate</span><span class="p">().</span><span class="nx">getContent</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// FOR POST</span>
<span class="c1">// function doPost(e) {</span>
<span class="c1">//  ref: https://developers.google.com/apps-script/guides/web?hl=zh-tw</span>
<span class="c1">// }</span>


<span class="c1">// Simulate some data that might be obtained by hitting other platform APIs.</span>
<span class="kd">function</span> <span class="nx">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXAMPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Add <code class="language-plaintext highlighter-rouge">Web_DailyReport_ Scaffolding.html</code> Web Dashboard framework, since our war room screen needs to automatically update content, we create a Web skeleton that periodically fetches HTML content using Ajax:</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      function onSuccess(html) {
        if (html != null) {
          var div = document.getElementById('result');
          div.innerHTML = html;
        }
     }
     setInterval(()=&gt;{
       google.script.run.withSuccessHandler(onSuccess).getDailyReportBody()
     }, 1000 * 60 * 60 * 1);
     google.script.run.withSuccessHandler(onSuccess).getDailyReportBody();
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"result"</span><span class="nt">&gt;</span>Loading...<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><strong>New</strong> <code class="language-plaintext highlighter-rouge">Web_DailyReport_Body.html</code> where the actual data is rendered into HTML:</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
    table {
        border-collapse: collapse;
        width: 100%;
        text-align: center;
    }
    th, td {
        border: 1px solid #000000;
        padding: 8px;
        text-align: center;
        font-size: 36px;
    }
      <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">style=</span><span class="s">"text-align:center"</span><span class="nt">&gt;</span>ZHGCHG.LI<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"dataTable"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
          <span class="err">&lt;</span>?
          // Display data from the past 7 days
          const dashboard = new WebDailyReport(targetGoogleSheetID, 7);
          // Starting from yesterday
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          const data = dashboard.allData(yesterday);
          for(const rowIndex in data) {
            const row = data[rowIndex];
            ?&gt;
            <span class="nt">&lt;tr&gt;</span>
              <span class="err">&lt;</span>?
              for(const columnIndex in row) {
                const column = row[columnIndex];
                ?&gt;
                <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: &lt;?=column["</span><span class="err">backgroundColor"]?</span><span class="nt">&gt;</span>; color: <span class="cp">&lt;?=column["color"]?&gt;</span>; text-align: <span class="cp">&lt;?=column["horizontalAlignment"]?&gt;</span>;"&gt;
                  <span class="cp">&lt;?=column["value"]?&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
                <span class="err">&lt;</span>?
              }
              ?&gt;
            <span class="nt">&lt;/tr&gt;</span>
            <span class="err">&lt;</span>?
          }
          ?&gt;
        <span class="nt">&lt;/tbody&gt;</span>
      <span class="nt">&lt;/table&gt;</span>
      <span class="nt">&lt;script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><blockquote><p><strong><em>Please note, we are fetching data from yesterday onwards for the past 7 days for comparison, today’s data will not be displayed.</em></strong></p></blockquote><p>The project directory after completing the above steps is as follows:</p><p><a href="/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><strong>Test Deployment:</strong></p><p>Click on the top right corner of the project “Deploy” -&gt; “Test Deployment”</p><p><a href="/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.png" alt="" class="lazyload" data-proofer-ignore></a></p><ul><li>After deployment, click the URL to view the test results.<li><strong>Please note this URL is for one-time testing only. If the code is adjusted, you need to click the test deployment operation again.</strong></ul><p>If stuck on Loading… or a server error occurs, you can go back to the “Executions” tab in the editor to check the error message:</p><p><a href="/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><strong>Complete Final Deployment:</strong></p><p>If the test is fine, you can complete the final deployment and release the URL.</p><p>Click on the top right corner of the project “Deploy” -&gt; “New Deployment” -&gt; Top left corner “Select type” -&gt; “Web app”:</p><p><a href="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.png" alt="" class="lazyload" data-proofer-ignore></a></p><ul><li>Execution Identity: Default is the current account (same as Google Apps Script user)<li>Who can access: Set to anyone with the link can access, or restrict to organization only, requiring Google login to access.<li>Deployment completed, get the URL.</ul><p><strong>Code changes require redeployment to take effect:</strong></p><p>Please note that when the code changes, you need to redeploy (the URL will not change) for the changes to take effect, otherwise, it will always be the old version.</p><p>Click on the top right corner of the project “Deploy” -&gt; “Manage deployments”:</p><p><a href="/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Click on the top right corner “Pen 🖊️ ICON” -&gt; “Version” -&gt; “Create new version” -&gt; “Deploy”.</p><p>After deployment, click the URL, or go back to the original URL and refresh to see the new changes.</p><h4 id="completed-all-our-rpa-requirements-are-now-fulfilled"><span class="me-2">🎉🎉Completed! All our RPA requirements are now fulfilled.🎉🎉</span><a href="#completed-all-our-rpa-requirements-are-now-fulfilled" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Final result:</p><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png" alt="(Modify the program to backfill this month's data, otherwise, there will only be one entry for yesterday in the new data)" class="lazyload" data-proofer-ignore></a></p><p>(Modify the program to backfill this month’s data, otherwise, there will only be one entry for yesterday in the new data)</p><blockquote><p><a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></p></blockquote><h3 id="complete-google-sheet-demo"><span class="me-2">Complete Google Sheet Demo:</span><a href="#complete-google-sheet-demo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing" target="_blank">https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing</a><li>Web GUI URL: <a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a><li><strong>Google Apps Script:</strong> <a href="https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit" target="_blank">https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit</a></ul><h3 id="finally-here-are-some-other-daily-life-applications"><span class="me-2">Finally, here are some other daily life applications:</span><a href="#finally-here-are-some-other-daily-life-applications" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line"><span class="me-2">Robotic Process Automation with Google Apps Script — Github Repo Star Notifier to Line</span><a href="#robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://medium.com/zrealm-ios-dev/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697" target="_blank" class="img-link shimmer" ><img data-src="https://miro.medium.com/v2/resize:fit:1200/1*fUtW942huwnSbPF-ar4OCQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><h4 id="robotic-process-automation-with-google-apps-script--notion-database-to-calendar"><span class="me-2">Robotic Process Automation with Google Apps Script — Notion Database to Calendar</span><a href="#robotic-process-automation-with-google-apps-script--notion-database-to-calendar" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Previously implemented the Notion to Calendar functionality.</p><blockquote><p><em>The implementation method is to connect to the Notion API to fetch Database data and apply it to generate an ICS format webpage, which is then deployed as a public webpage; this URL can be added to Apple Calendar.</em></p></blockquote><p><code class="language-plaintext highlighter-rouge">Main.gs</code> :</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre><td class="rouge-code"><pre><span class="c1">// Constant variables</span>
<span class="kd">const</span> <span class="nx">notionToken</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">XXXXX</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">safeToken</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">XXXXX</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ics</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">ics</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">parameter</span><span class="p">.</span><span class="nx">token</span> <span class="o">!=</span> <span class="nx">safeToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ContentService</span><span class="p">.</span><span class="nx">createTextOutput</span><span class="p">(</span><span class="dl">"</span><span class="s2">Access Denied!</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ics</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nx">getQuickNote</span><span class="p">();</span>
  
  <span class="k">return</span> <span class="nx">ContentService</span><span class="p">.</span><span class="nx">createTextOutput</span><span class="p">(</span><span class="nx">ics</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">().</span><span class="nx">getContent</span><span class="p">()).</span><span class="nx">setMimeType</span><span class="p">(</span><span class="nx">ContentService</span><span class="p">.</span><span class="nx">MimeType</span><span class="p">.</span><span class="nx">ICAL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ics</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">ics</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ics</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nx">getQuickNote</span><span class="p">();</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ics</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">().</span><span class="nx">getContent</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getQuickNote</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// YOUR FILTER Condition:</span>
  <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">property</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">is_not_empty</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="p">,</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">property</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Name</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">is_not_empty</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">getDatabase</span><span class="p">(</span><span class="nx">YOUR_DATABASE_ID</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
    <span class="kd">const</span> <span class="nx">properties</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">properties</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">create</span> <span class="o">=</span> <span class="nx">toICSDate</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="dl">"</span><span class="s2">created_time</span><span class="dl">"</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">edit</span> <span class="o">=</span> <span class="nx">toICSDate</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="dl">"</span><span class="s2">last_edited_time</span><span class="dl">"</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">start</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">toICSDate</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">endDate</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">startDate</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">toICSDate</span><span class="p">(</span><span class="nx">endDate</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Type</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">multi_select</span><span class="dl">'</span><span class="p">]?.[</span><span class="mi">0</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">];</span>

    <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[</span><span class="dl">"</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="dl">"</span><span class="s2">] </span><span class="dl">"</span><span class="o">+</span><span class="nx">properties</span><span class="p">?.[</span><span class="dl">'</span><span class="s1">Name</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span><span class="p">]?.[</span><span class="mi">0</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">description</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">];</span>
    
    <span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="nx">id</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">create</span><span class="dl">"</span><span class="p">:</span><span class="nx">create</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">edit</span><span class="dl">"</span><span class="p">:</span><span class="nx">edit</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span><span class="nx">start</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">:</span><span class="nx">end</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span><span class="nx">title</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span><span class="nx">description</span>
      <span class="p">}</span>
    <span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">events</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// TO UTC Date</span>
<span class="kd">function</span> <span class="nx">toICSDate</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">icsDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  <span class="nx">icsDate</span><span class="p">.</span><span class="nx">setHours</span><span class="p">(</span><span class="nx">icsDate</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">icsDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyyMMdd'T'HHmmss'Z'</span><span class="dl">"</span><span class="p">);</span><span class="c1">// 20240304T132300Z</span>
<span class="p">}</span>

<span class="c1">// Notion</span>
<span class="kd">function</span> <span class="nx">getDatabase</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.notion.com/v1/databases/</span><span class="dl">'</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="dl">'</span><span class="s1">/query/</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bearer </span><span class="dl">'</span><span class="o">+</span><span class="nx">notionToken</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Notion-Version</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2022-06-28</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="na">payload</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
  <span class="p">};</span> 
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">getContentText</span><span class="p">());</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">ics.html</code> :</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre>BEGIN:VCALENDAR
PRODID:-//Google Inc//Google Calendar 70.9054//EN
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:NotionCalendar
X-WR-TIMEZONE:Asia/Taipei
BEGIN:VTIMEZONE
TZID:Asia/Taipei
X-LIC-LOCATION:Asia/Taipei
BEGIN:STANDARD
TZOFFSETFROM:+0800
TZOFFSETTO:+0800
TZNAME:CST
DTSTART:19700101T000000
END:STANDARD
END:VTIMEZONE
&lt;?
  for(const eventIndex in events) {
    const event = events[eventIndex];
    ?&gt;
BEGIN:VEVENT
DTSTART:&lt;?=event["start"]?&gt;

DTEND:&lt;?=event["end"]?&gt;

DTSTAMP:&lt;?=event["edit"]?&gt;

UID:&lt;?=event["id"]?&gt;

CREATED:&lt;?=event["create"]?&gt;

LAST-MODIFIED:&lt;?=event["edit"]?&gt;

SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:&lt;?=event["title"]?&gt;

DESCRIPTION:&lt;?=event["description"]?&gt;

TRANSP:OPAQUE
END:VEVENT
&lt;?
  }
?&gt;
END:VCALENDAR
</pre></table></code></div></div><p>As mentioned earlier, deploy as a web service, click on the top right corner of the project “Deploy” -&gt; “New Deployment” -&gt; top left corner “Select Type” -&gt; “Web Application”:</p><p><a href="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.png" alt="" class="lazyload" data-proofer-ignore></a></p><ul><li>Who can access should be set to everyone, as Google login verification cannot be performed when adding Calendar.</ul><p><a href="/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.png" class="popup img-link "><img data-src="/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><strong>Add the URL to the calendar subscription, and it’s done</strong> 🎉🎉🎉🎉 <strong>!</strong></p><h3 id="commercial-time"><span class="me-2">Commercial Time</span><a href="#commercial-time" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If you and your team have automation tool or process integration needs, whether it’s Slack App development, Notion, Asana, Google Sheet, Google Form, GA data, various integration needs, feel free to <a href="https://zhgchg.li/contact/" target="_blank"><strong>contact me for development</strong></a>.</p><p>If you have any questions or comments, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/f6713ba3fee3/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/f6713ba3fee3" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/roboticprocessautomation/" class="post-tag no-text-decoration" >roboticprocessautomation</a> <a href="/tags/rpa-solutions/" class="post-tag no-text-decoration" >rpa-solutions</a> <a href="/tags/google-apps-script/" class="post-tag no-text-decoration" >google-apps-script</a> <a href="/tags/google-sheets/" class="post-tag no-text-decoration" >google-sheets</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Implementing%20Google%20Services%20RPA%20Automation%20with%20Google%20Apps%20Script%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Ff6713ba3fee3%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Implementing%20Google%20Services%20RPA%20Automation%20with%20Google%20Apps%20Script%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Ff6713ba3fee3%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Ff6713ba3fee3%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/793cb8f89b72/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1637506030" data-df="ll" > Nov 21, 2021 </em><h4 class="pt-0 my-2" data-toc-skip>Crashlytics + Google Analytics Automatically Query App Crash-Free Users Rate</h4><div class="text-muted small"><p> Crashlytics + Google Analytics Automatically Query App Crash-Free Users Rate Using Google Apps Script to query Crashlytics through Google Analytics and automatically fill it into Google Sheet ...</p></div></div></a></div><div class="col"> <a href="/posts/309d0302877b/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1724083008" data-df="ll" > Aug 19, 2024 </em><h4 class="pt-0 my-2" data-toc-skip>iOS Shortcut Automation Scenarios - Automatically Forwarding Text Messages and Creating Reminder Tasks</h4><div class="text-muted small"><p> iOS Shortcut Automation Scenarios - Automatically Forwarding Text Messages and Creating Reminder Tasks iOS uses Shortcuts to easily automate forwarding specific text messages to Line and automatic...</p></div></div></a></div><div class="col"> <a href="/posts/d61062833c1a/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1623603501" data-df="ll" > Jun 14, 2021 </em><h4 class="pt-0 my-2" data-toc-skip>Building a Fully Automated WFH Employee Health Reporting System with Slack</h4><div class="text-muted small"><p> Building a Fully Automated WFH Employee Health Reporting System with Slack Enhancing work efficiency by playing with Slack Workflow combined with Google Sheet with App Script Photo by Stephen P...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/bd94cc88f9c9/" class="btn btn-outline-primary" prompt="Older" ><p>Slack & ChatGPT Integration</p></a> <a href="/posts/b04f4fba3cf2/" class="btn btn-outline-primary" prompt="Newer" ><p>What Can Be Done to Commemorate When an App Product Reaches Its End?</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
