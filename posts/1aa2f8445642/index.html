<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Real-world Decode Issues with Codable" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="From basic to advanced, deeply using Decodable to meet all possible problem scenarios" /><meta property="og:description" content="From basic to advanced, deeply using Decodable to meet all possible problem scenarios" /><link rel="canonical" href="https://en.zhgchg.li/posts/1aa2f8445642/" /><meta property="og:url" content="https://en.zhgchg.li/posts/1aa2f8445642/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-14T00:33:58+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.jpeg" /><meta property="twitter:title" content="Real-world Decode Issues with Codable" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-04-13T16:24:35+08:00","datePublished":"2020-06-14T00:33:58+08:00","description":"From basic to advanced, deeply using Decodable to meet all possible problem scenarios","headline":"Real-world Decode Issues with Codable","image":"https://en.zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/1aa2f8445642/"},"url":"https://en.zhgchg.li/posts/1aa2f8445642/"}</script><title>Real-world Decode Issues with Codable | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Real-world Decode Issues with Codable</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Real-world Decode Issues with Codable</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1592066038" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 14, 2020 </em> </span> <span> Updated <em class="" data-ts="1712996675" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.jpeg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.jpeg" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3847 words" > <em>21 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="real-world-decode-issues-with-codable-part-1"><span class="me-2">Real-world Decode Issues with Codable (Part 1)</span><a href="#real-world-decode-issues-with-codable-part-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>From basic to advanced, deeply using Decodable to meet all possible problem scenarios</p><p><a href="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.jpeg" class="popup img-link "><img data-src="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.jpeg" alt="Photo by [Gustas Brazaitis](https://unsplash.com/@gustasbrazaitis){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p>Photo by <a href="https://unsplash.com/@gustasbrazaitis" target="_blank">Gustas Brazaitis</a></p><h3 id="preface"><span class="me-2">Preface</span><a href="#preface" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Due to the backend API upgrade, we need to adjust the API processing architecture. Recently, we took this opportunity to update the original network processing architecture written in Objective-C to Swift. Due to the different languages, it is no longer suitable to use the original <a href="https://github.com/RestKit/RestKit" target="_blank">Restkit</a> to handle our network layer applications. However, it must be said that Restkit’s functionality is very powerful, and it was used very effectively in the project with almost no major issues. But it is relatively cumbersome, almost no longer maintained, and purely Objective-C. It will inevitably need to be replaced in the future.</p><p>Restkit almost handled all the network request-related functions we needed, from basic network processing, API calls, network processing, to response processing JSON String to Object, and even storing objects into Core Data. It was a framework that could handle ten tasks at once.</p><p>With the evolution of the times, the current frameworks no longer focus on an all-in-one package but more on flexibility, lightness, and combination, increasing more flexibility and creating more variations. Therefore, when replacing it with Swift, we chose to use Moya as the network processing part of the package, and other functions we needed were combined in other ways.</p><h3 id="main-content"><span class="me-2">Main Content</span><a href="#main-content" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>For the JSON String to Object Mapping part, we use Swift’s built-in Codable (Decodable) protocol &amp; JSONDecoder for processing. We split the Entity/Model to enhance responsibility separation, operation, and readability. Additionally, we also need to consider the code base mixing Objective-C and Swift.</p><blockquote><p><em>＊ The Encodable part is omitted, and the examples only show the implementation of Decodable. They are similar; if you can decode, you can also encode.</em></p></blockquote><h3 id="getting-started"><span class="me-2">Getting Started</span><a href="#getting-started" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Assume our initial API Response JSON String is as follows:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"It's Accusefive, not Five Accuse!"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thinking of You Under the Stars"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli@gmail.com"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>From the above example, we can split it into three entities &amp; models: User, Song, and Comment. For convenience, let’s write the Entity/Model in the same file.</p><p>User:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">UserEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">//Model:</span>
<span class="kd">class</span> <span class="kt">UserModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">UserEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
      <span class="k">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">email</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Song:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">//Model:</span>
<span class="kd">class</span> <span class="kt">SongModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">SongEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Comment:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">SongEntity</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
<span class="p">}</span>

<span class="c1">//Model:</span>
<span class="kd">class</span> <span class="kt">CommentModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">CommentEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">comment</span>
      <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="kt">SongModel</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
      <span class="k">self</span><span class="o">.</span><span class="n">commenter</span> <span class="o">=</span> <span class="kt">UserModel</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">commenter</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">SongModel</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserModel</span>
<span class="p">}</span>
</pre></table></code></div></div><p>JSONDecoder:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 123456, </span><span class="se">\"</span><span class="s">comment</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">It's Accusefive, not Five Accuse!</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">target_object</span><span class="se">\"</span><span class="s">: { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 99, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Thinking of You Under the Stars</span><span class="se">\"</span><span class="s"> }, </span><span class="se">\"</span><span class="s">commenter</span><span class="se">\"</span><span class="s">: { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">user</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 1, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">zhgchgli</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">email</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">zhgchgli@gmail.com</span><span class="se">\"</span><span class="s"> } }"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="codingkeys-enum"><span class="me-2">CodingKeys Enum?</span><a href="#codingkeys-enum" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>When our JSON String Key Name does not match the Entity Object Property Name, we can add a CodingKeys enum internally to map them, as we cannot control the naming convention of the backend data source.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">case</span> <span class="kt">PropertyKeyName</span> <span class="o">=</span> <span class="s">"backend_field_name"</span>
<span class="k">case</span> <span class="kt">PropertyKeyName</span> <span class="c1">// If not specified, the default is to use PropertyKeyName as the backend field name</span>
</pre></table></code></div></div><p>Once the CodingKeys enum is added, all non-Optional fields must be enumerated, and you cannot just list the keys you want to customize.</p><p>Another way is to set the keyDecodingStrategy of JSONDecoder. If the response data fields and property names differ only by <code class="language-plaintext highlighter-rouge">snake_case</code> &lt;-&gt; <code class="language-plaintext highlighter-rouge">camelCase</code>, you can directly set <code class="language-plaintext highlighter-rouge">.keyDecodingStrategy</code> = <code class="language-plaintext highlighter-rouge">.convertFromSnakeCase</code> to automatically match the mapping.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="n">jsonDecoder</span><span class="o">.</span><span class="n">keyDecodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="n">convertFromSnakeCase</span>
<span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="when-the-returned-data-is-an-array"><span class="me-2">When the returned data is an array:</span><a href="#when-the-returned-data-is-an-array" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">songs</span><span class="p">:[</span><span class="kt">SongEntity</span><span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="adding-constraints-to-string"><span class="me-2">Adding constraints to String:</span><a href="#adding-constraints-to-string" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">SongType</span>
  
  <span class="kd">enum</span> <span class="kt">SongType</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">rock</span>
    <span class="k">case</span> <span class="n">pop</span>
    <span class="k">case</span> <span class="n">country</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Applicable to string types with a limited range, writing them as Enums makes it convenient for us to pass and use; if a value appears that is not enumerated, decoding will fail!</p><h4 id="make-good-use-of-generics-to-wrap-fixed-structures"><span class="me-2">Make good use of generics to wrap fixed structures:</span><a href="#make-good-use-of-generics-to-wrap-fixed-structures" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Assuming the JSON String returned in multiple instances has a fixed format:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nl">"offset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>You can wrap it using generics:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">PageEntity</span><span class="o">&lt;</span><span class="kt">E</span><span class="p">:</span> <span class="kt">Decodable</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">offset</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">limit</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">E</span><span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Usage: <code class="language-plaintext highlighter-rouge">PageEntity&lt;Song&gt;.self</code></p><h4 id="datetimestamp-automatic-decoding"><span class="me-2">Date/Timestamp automatic decoding:</span><a href="#datetimestamp-automatic-decoding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Set the <code class="language-plaintext highlighter-rouge">dateDecodingStrategy</code> of <code class="language-plaintext highlighter-rouge">JSONDecoder</code></p><ul><li><code class="language-plaintext highlighter-rouge">.secondsSince1970/.millisecondsSince1970</code>: Unix timestamp<li><code class="language-plaintext highlighter-rouge">.deferredToDate</code>: Apple’s timestamp, rarely used, different from Unix timestamp, it starts from 2001/01/01<li><code class="language-plaintext highlighter-rouge">.iso8601</code>: ISO 8601 date format<li><code class="language-plaintext highlighter-rouge">.formatted(DateFormatter)</code>: Decode Date according to the passed-in DateFormatter<li><code class="language-plaintext highlighter-rouge">.custom</code>: Custom Date Decode logic</ul><p><strong>.custom example: Assuming the API returns both YYYY/MM/DD and ISO 8601 formats, both need to be decoded:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">dateFormatter</span> <span class="o">=</span> <span class="kt">DateFormatter</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">iso8601DateFormatter</span> <span class="o">=</span> <span class="kt">ISO8601DateFormatter</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="n">decoder</span><span class="o">.</span><span class="n">dateDecodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="nf">custom</span><span class="p">({</span> <span class="p">(</span><span class="n">decoder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Date</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">dateString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
    
    <span class="c1">//ISO8601:</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="n">iso8601DateFormatter</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">dateString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">date</span>
    <span class="p">}</span>
    
    <span class="c1">//YYYY-MM-DD:</span>
    <span class="n">dateFormatter</span><span class="o">.</span><span class="n">dateFormat</span> <span class="o">=</span> <span class="s">"yyyy-MM-dd"</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">dateString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">date</span>
    <span class="p">}</span>
    
    <span class="k">throw</span> <span class="kt">DecodingError</span><span class="o">.</span><span class="nf">dataCorruptedError</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">container</span><span class="p">,</span> <span class="nv">debugDescription</span><span class="p">:</span> <span class="s">"Cannot decode date string </span><span class="se">\(</span><span class="n">dateString</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</pre></table></code></div></div><blockquote><p><em>＊DateFormatter is very performance-consuming when initialized, try to reuse it as much as possible.</em></p></blockquote><h4 id="basic-decode-knowledge"><span class="me-2">Basic Decode knowledge:</span><a href="#basic-decode-knowledge" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>The field types (struct/class/enum) within the Decodable Protocol must implement the Decodable Protocol; or assign values when initializing the decoder<li>Decoding will fail if the field types do not match<li>If a field in the Decodable Object is set to Optional, it is optional; if provided, it will be decoded<li>Optional fields can accept: JSON String without the field, provided but given as nil<li>Blank, 0 is not equal to nil, nil is nil; pay attention to weakly typed backend APIs!<li>By default, if a non-Optional field in the Decodable Object is an enum and the JSON String does not provide it, decoding will fail (will explain how to handle this later)<li>By default, decoding failure will directly interrupt and exit, it cannot simply skip erroneous data (will explain how to handle this later)</ol><p><a href="/assets/1aa2f8445642/1*B-j47uMMshXozF32msbRtg.jpeg" class="popup img-link "><img data-src="/assets/1aa2f8445642/1*B-j47uMMshXozF32msbRtg.jpeg" alt="[Left: &quot;&quot; Right: nil](https://josjong.com/2017/10/16/null-vs-empty-strings-why-oracle-was-right-and-apple-is-not/){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p><a href="https://josjong.com/2017/10/16/null-vs-empty-strings-why-oracle-was-right-and-apple-is-not/" target="_blank">Left: “” / Right: nil</a></p><h3 id="advanced-usage"><span class="me-2">Advanced Usage</span><a href="#advanced-usage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>So far, the basic usage has been completed, but the real world is not that simple. Below are some advanced scenarios you might encounter and solutions using Codable. From here on, we can no longer rely on the original Decode to help us with Mapping; we need to implement <code class="language-plaintext highlighter-rouge">init(from decoder: Decoder)</code> for custom Decode operations.</p><blockquote><p><em>＊For now, we will only show the Entity part; the Model is not needed yet.</em></p></blockquote><h4 id="initfrom-decoder-decoder"><span class="me-2">init(from decoder: Decoder)</span><a href="#initfrom-decoder-decoder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>init decoder, must assign initial values to all non-Optional fields (that’s init!).</p><p>When customizing Decode operations, we need to get the <code class="language-plaintext highlighter-rouge">container</code> from the <code class="language-plaintext highlighter-rouge">decoder</code> to operate on the values. There are three types of containers to retrieve content from.</p><p><a href="/assets/1aa2f8445642/1*U2Rt9KZq3Vw_lkZkJl7t_Q.png" class="popup img-link "><img data-src="/assets/1aa2f8445642/1*U2Rt9KZq3Vw_lkZkJl7t_Q.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><strong>First type container(keyedBy: CodingKeys.self)</strong> <strong>Operate according to CodingKeys:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">name</span>
    <span class="p">}</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1">// Parameter 1 accepts support: class implementing Decodable</span>
        <span class="c1">// Parameter 2 CodingKeys</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Second type singleValueContainer</strong> <strong>Retrieve the whole package for operation (single value):</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="kt">HandsomeLevel</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">handsome</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">normal</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"zhgchgli"</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">handsome</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">normal</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">UserEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">HandsomeLevel</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span>
        <span class="k">case</span> <span class="n">name</span>
        <span class="k">case</span> <span class="n">email</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Suitable for Associated Value Enum field types, for example, name also carries a level of handsomeness!</p><p><strong>Third type unkeyedContainer</strong> <strong>Treat the whole package as an array:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">items</span><span class="p">:[</span><span class="kt">Decodable</span><span class="p">]</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">unkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">unkeyedContainer</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">unkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="c1">// The internal pointer of unkeyedContainer will automatically point to the next object after the decode operation</span>
            <span class="c1">// Until it points to the end, indicating the traversal is complete</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"[</span><span class="se">\"</span><span class="s">test</span><span class="se">\"</span><span class="s">,1234,5566]"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">ListEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><p>Applicable to array fields of variable types.</p><h4 id="under-container-we-can-also-use-nestedcontainer--nestedunkeyedcontainer-to-operate-on-specific-fields"><span class="me-2">Under Container, we can also use nestedContainer / nestedUnkeyedContainer to operate on specific fields:</span><a href="#under-container-we-can-also-use-nestedcontainer--nestedunkeyedcontainer-to-operate-on-specific-fields" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><strong><em>＊Flatten data fields (similar to flatMap)</em></strong></p></blockquote><p><a href="/assets/1aa2f8445642/1*IE_dCAdXGDMaW-nSNT2ITg.png" class="popup img-link "><img data-src="/assets/1aa2f8445642/1*IE_dCAdXGDMaW-nSNT2ITg.png" alt="" class="lazyload" data-proofer-ignore></a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">items</span>
        <span class="k">case</span> <span class="n">date</span>
        <span class="k">case</span> <span class="n">name</span>
        <span class="k">case</span> <span class="n">target</span>
    <span class="p">}</span>
    
    <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">type</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">Decodable</span><span class="p">]</span>
    <span class="k">var</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">Decodable</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Date</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">name</span><span class="p">)</span>
        
        <span class="k">let</span> <span class="nv">nestedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedContainer</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        
        <span class="k">let</span> <span class="nv">type</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type</span> <span class="o">==</span> <span class="s">"song"</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">var</span> <span class="nv">unkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedUnkeyedContainer</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">unkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Access and decode objects of different levels. The example demonstrates using nestedContainer to flatten out the type for target/items and then decode accordingly based on the type.</p><h4 id="decode--decodeifpresent"><span class="me-2">Decode &amp; DecodeIfPresent</span><a href="#decode--decodeifpresent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><strong>DecodeIfPresent:</strong> Decode only when the response provides the data field (when Codable Property is set to Optional)<li><strong>Decode:</strong> Perform the decode operation. If the response does not provide the data field, it will throw an error.</ul><blockquote><p><strong><em>＊The above is just a brief introduction to the methods and functions of init decoder and container. It’s okay if you don’t understand; we’ll dive directly into real-world scenarios and experience the combined operations in the examples.</em></strong></p></blockquote><h3 id="real-world-scenario"><span class="me-2">Real-world Scenario</span><a href="#real-world-scenario" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Returning to the original example JSON String.</p><h4 id="scenario-1-suppose-today-the-comment-could-be-on-a-song-or-a-person-the-targetobject-field-could-be-user-or-song-how-should-we-handle-it"><span class="me-2">Scenario 1. Suppose today the comment could be on a song or a person. The <code class="language-plaintext highlighter-rouge">targetObject</code> field could be <code class="language-plaintext highlighter-rouge">User</code> or <code class="language-plaintext highlighter-rouge">Song</code>. How should we handle it?</span><a href="#scenario-1-suppose-today-the-comment-could-be-on-a-song-or-a-person-the-targetobject-field-could-be-user-or-song-how-should-we-handle-it" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123456</span><span class="p">,</span><span class="w">
      </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"It's Accusefive, not Five Accuse!"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thinking of You Under the Stars"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli@gmail.com"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w">
      </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"66666!"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aaaa"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aaaa@gmail.com"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h4 id="method-a"><span class="me-2">Method a.</span><a href="#method-a" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Using Enum as a container for Decode.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">TargetObject</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
    
    <span class="kd">enum</span> <span class="kt">TargetObject</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nf">song</span><span class="p">(</span><span class="kt">SongEntity</span><span class="p">)</span>
        <span class="k">case</span> <span class="nf">user</span><span class="p">(</span><span class="kt">UserEntity</span><span class="p">)</span>
        
        <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">type</span>
        <span class="p">}</span>
        
        <span class="kd">enum</span> <span class="kt">TargetObjectType</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">Decodable</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">song</span>
            <span class="k">case</span> <span class="n">user</span>
        <span class="p">}</span>
        
        <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">singleValueContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">targetObjectType</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">TargetObjectType</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
            
            <span class="k">switch</span> <span class="n">targetObjectType</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">song</span><span class="p">:</span>
                <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span> <span class="n">singleValueContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
                <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">user</span><span class="p">:</span>
                <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="k">try</span> <span class="n">singleValueContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
                <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We change the <code class="language-plaintext highlighter-rouge">targetObject</code> property to an Associated Value Enum, deciding what content to put inside the Enum during Decode.</p><p>The core practice is to create a Decodable Enum as a container, decode it by first extracting the key field (the <code class="language-plaintext highlighter-rouge">type</code> field in the example JSON String), and if it is <code class="language-plaintext highlighter-rouge">Song</code>, use singleValueContainer to decode the whole package into <code class="language-plaintext highlighter-rouge">SongEntity</code>, and similarly for <code class="language-plaintext highlighter-rouge">User</code>.</p><p><strong>Extract from Enum when using:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//if case let</span>
<span class="k">if</span> <span class="k">case</span> <span class="k">let</span> <span class="nv">CommentEntity</span><span class="o">.</span><span class="kt">TargetObject</span><span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">case</span> <span class="k">let</span> <span class="nv">CommentEntity</span><span class="o">.</span><span class="kt">TargetObject</span><span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="n">song</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//switch case let</span>
<span class="k">switch</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="k">let</span> <span class="nv">song</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="k">let</span> <span class="nv">user</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="method-b"><span class="me-2">Method b.</span><a href="#method-b" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Declare the field property as Base Class.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">type</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">Decodable</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">comment</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">commenter</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">commenter</span><span class="p">)</span>
        
        <span class="c1">//</span>
        <span class="k">let</span> <span class="nv">targetObjectContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedContainer</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">targetObjectType</span> <span class="o">=</span> <span class="k">try</span> <span class="n">targetObjectContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">targetObjectType</span> <span class="o">==</span> <span class="s">"user"</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The principle is similar, but here we first use <code class="language-plaintext highlighter-rouge">nestedContainer</code> to dive into <code class="language-plaintext highlighter-rouge">targetObject</code> to get the <code class="language-plaintext highlighter-rouge">type</code> and then decide what type <code class="language-plaintext highlighter-rouge">targetObject</code> should be parsed into.</p><p><strong>Cast when using:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="k">as?</span> <span class="kt">Song</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="k">as?</span> <span class="kt">User</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="scenario-2-how-to-decode-if-the-data-array-contains-multiple-types-of-data"><span class="me-2">Scenario 2. How to decode if the data array contains multiple types of data?</span><a href="#scenario-2-how-to-decode-if-the-data-array-contains-multiple-types-of-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>{
  "results": [
    {
      "type": "song",
      "id": 99,
      "name": "Thinking of You Under the Stars"
    },
    {
      "type": "user",
      "id": 1,
      "name": "zhgchgli",
      "email": "zhgchgli@gmail.com"
    }
  ]
}
</pre></table></code></div></div><p>Combine the <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> mentioned above with the solution from Scenario 1; you can also use <strong>Scenario 1</strong>’s <strong>a. solution</strong>, using Associated Value Enum to store values.</p><h4 id="scenario-3-decode-json-string-field-only-when-it-has-a-value"><span class="me-2">Scenario 3. Decode JSON String field only when it has a value</span><a href="#scenario-3-decode-json-string-field-only-when-it-has-a-value" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>[
  {
    "type": "song",
    "id": 99,
    "name": "Thinking of You Under the Stars"
  },
  {
    "type": "song",
    "id": 11
  }
]
</pre></table></code></div></div><p>Use decodeIfPresent to decode.</p><h4 id="scenario-4-skip-data-that-fails-to-decode-in-an-array"><span class="me-2">Scenario 4. Skip data that fails to decode in an array</span><a href="#scenario-4-skip-data-that-fails-to-decode-in-an-array" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thinking of You Under the Stars"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Take Me to Find Nightlife"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>As mentioned earlier, Decodable by default requires all data to be correctly parsed to map the output; sometimes you may encounter unstable data from the backend, providing a long array but with some entries missing fields or having mismatched field types causing decode failures; resulting in the entire package failing and returning nil.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ResultsEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">results</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">SongEntity</span><span class="p">]</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">var</span> <span class="nv">nestedUnkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedUnkeyedContainer</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">results</span><span class="p">)</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">EmptyEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">EmptyEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">results</span><span class="se">\"</span><span class="s">: [ { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 99, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Thinking of You Under the Stars</span><span class="se">\"</span><span class="s"> }, { </span><span class="se">\"</span><span class="s">error</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">error</span><span class="se">\"</span><span class="s"> }, { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 19, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Take Me to Find Nightlife</span><span class="se">\"</span><span class="s"> } ] }"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">ResultsEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><p>The solution is similar to <strong>Scenario 2’s solution</strong>; <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> iterates through each content and performs try? Decode. If Decode fails, it uses Empty Decode to allow the <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code>’s internal pointer to continue executing.</p><blockquote><p><em>＊This method is somewhat of a workaround because we cannot command <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> to skip, and <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> must successfully decode to continue executing. Therefore, we do it this way. Some in the Swift community have suggested adding <a href="https://forums.swift.org/t/pitch-unkeyeddecodingcontainer-movenext-to-skip-items-in-deserialization/22151/16" target="_blank">moveNext()</a>, but it has not been implemented in the current version.</em></p></blockquote><h4 id="scenario-5-some-fields-are-for-internal-use-in-my-program-not-for-decode"><span class="me-2">Scenario 5. Some fields are for internal use in my program, not for Decode</span><a href="#scenario-5-some-fields-are-for-internal-use-in-my-program-not-for-decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h4 id="method-a-entitymodel"><span class="me-2">Method a. Entity/Model</span><a href="#method-a-entitymodel" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Here we need to mention what was said at the beginning about the utility of splitting Entity/Model; Entity is solely responsible for JSON String to Entity (Decodable) Mapping; Model initWith Entity, the actual program transmission, operation, and business logic all use Model.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SongModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">SongEntity</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">type</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="k">var</span> <span class="nv">isSave</span><span class="p">:</span><span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span> <span class="c1">//business logic</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Benefits of splitting Entity/Model:</strong></p><ol><li>Clear responsibilities, Entity: JSON String to Decodable, Model: business logic<li>Clear mapping of fields, just look at Entity<li>Avoid cluttering when there are many fields<li><strong>Can be used in Objective-C</strong> (since Model is just NSObject, struct/Decodable is not visible in Objective-C)<li>Internal business logic and fields can be placed in Model</ol><h4 id="method-b-init-handling"><span class="me-2">Method b. init handling</span><a href="#method-b-init-handling" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>List CodingKeys and exclude fields for internal use, give default values during init or set fields with default values or make them Optional, but these are not good methods, just runnable ones.</p><h4 id="20200626-update--next-scenario-6-api-response-uses-01-to-represent-bool-how-to-decode"><span class="me-2">[2020/06/26 Update] — Next Scenario 6. API Response uses 0/1 to represent Bool, how to Decode?</span><a href="#20200626-update--next-scenario-6-api-response-uses-01-to-represent-bool-how-to-decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="../cb00b1977537/">Summary of Decode issues encountered in real use of Codable (Part 2)</a></ul><h4 id="20200626-update--next-scenario-7-dont-want-to-rewrite-init-decoder-every-time"><span class="me-2">[2020/06/26 Update] — Next Scenario 7. Don’t want to rewrite init decoder every time</span><a href="#20200626-update--next-scenario-7-dont-want-to-rewrite-init-decoder-every-time" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="../cb00b1977537/">Summary of Decode issues encountered in real use of Codable (Part 2)</a></ul><h4 id="20200626-update--next-scenario-8-reasonable-handling-of-response-null-field-data"><span class="me-2">[2020/06/26 Update] — Next Scenario 8. Reasonable handling of Response Null field data</span><a href="#20200626-update--next-scenario-8-reasonable-handling-of-response-null-field-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="../cb00b1977537/">Summary of Decode issues encountered in real use of Codable (Part 2)</a></ul><h3 id="comprehensive-scenario-example"><span class="me-2">Comprehensive Scenario Example</span><a href="#comprehensive-scenario-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A complete example combining the basic and advanced usage mentioned above:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre>{
  "count": 5,
  "offset": 0,
  "limit": 10,
  "results": [
    {
      "id": 123456,
      "comment": "It's Accusefive, not Fiveaccuse!",
      "target_object": {
        "type": "song",
        "id": 99,
        "name": "Thinking of You Under the Stars",
        "create_date": "2020-06-13T15:21:42+0800"
      },
      "commenter": {
        "type": "user",
        "id": 1,
        "name": "zhgchgli",
        "email": "zhgchgli@gmail.com",
        "birthday": "1994/07/18"
      }
    },
    {
      "error": "not found"
    },
    {
      "error": "not found"
    },
    {
      "id": 2,
      "comment": "Haha, me too!",
      "target_object": {
        "type": "user",
        "id": 1,
        "name": "zhgchgli",
        "email": "zhgchgli@gmail.com",
        "birthday": "1994/07/18"
      },
      "commenter": {
        "type": "user",
        "id": 1,
        "name": "Passerby A",
        "email": "man@gmail.com",
        "birthday": "2000/01/12"
      }
    }
  ]
}
</pre></table></code></div></div><p><strong>Output:</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>zhgchgli: It's Accusefive, not Five Accuse!
</pre></table></code></div></div><p>Complete example demonstration as above!</p><h3 id="next-part--other-scenarios-updated"><span class="me-2">(Next) Part &amp; Other Scenarios Updated:</span><a href="#next-part--other-scenarios-updated" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="../cb00b1977537/">Summary of Decode Issues Encountered in Real Use of Codable (Part 2)</a></ul><h3 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The benefits of choosing to use Codable, first of all, are because it is native, you don’t have to worry about no one maintaining it in the future, and it looks nice when written; but relatively, the restrictions are stricter, it is less flexible in parsing JSON Strings, otherwise, you have to do more things as described in this article to complete it, and the performance is actually not superior to using other Mapping packages (Decodable still uses NSJSONSerialization from the Objective-C era for parsing). However, I think Apple might optimize this in future updates, so we won’t need to change the program then.</p><p>The scenarios and examples in the article may be extreme, but sometimes you can’t help it when you encounter them; of course, we hope that in general situations, simple Codable can meet our needs; but with the above techniques, there should be no unsolvable problems!</p><blockquote><p><em>Thanks to <a href="https://twitter.com/saiday" target="_blank">＠saiday</a> for technical support.</em></p></blockquote><p><a href="https://www.youtube.com/watch?v=W9Fq1HC_5hg" target="_blank" class="img-link shimmer" ><img data-src="/assets/1aa2f8445642/43b3_hqdefault.jpg" alt="Accusefive【Take us to the light】Official Music Video" title="Accusefive【Take us to the light】Official Music Video" class="lazyload" data-proofer-ignore></a></p><h3 id="further-reading"><span class="me-2">Further Reading</span><a href="#further-reading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><a href="https://kemchenj.github.io/2018-06-03/" target="_blank">In-depth Decodable — Writing a JSON Parser Beyond Native</a> Full of content, deeply understanding Decoder/JSONDecoder.<li><a href="https://onevcat.com/2018/03/swift-meta/" target="_blank">Looking at Problems from Different Angles — From Codable to Swift Metaprogramming</a><li><a href="https://medium.com/better-programming/why-model-objects-shouldnt-implement-swift-s-decodable-or-encodable-protocols-1249cb44d4b3" target="_blank">Why Model Objects Shouldn’t Implement Swift’s Decodable or Encodable Protocols</a></ol><p>If you have any questions or comments, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/1aa2f8445642/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/1aa2f8445642" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/codable/" class="post-tag no-text-decoration" >codable</a> <a href="/tags/json/" class="post-tag no-text-decoration" >json</a> <a href="/tags/decode/" class="post-tag no-text-decoration" >decode</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Real-world%20Decode%20Issues%20with%20Codable%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F1aa2f8445642%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Real-world%20Decode%20Issues%20with%20Codable%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F1aa2f8445642%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F1aa2f8445642%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/cb00b1977537/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1593107791" data-df="ll" > Jun 26, 2020 </em><h4 class="pt-0 my-2" data-toc-skip>Real-World Codable Decoding Issues (Part 2)</h4><div class="text-muted small"><p> Real-World Codable Decoding Issues (Part 2) Handling Response Null Fields Reasonably, No Need to Always Rewrite init decoder Photo by Zan Introduction Following the previous article “Real-Worl...</p></div></div></a></div><div class="col"> <a href="/posts/e37d66ea1146/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539454069" data-df="ll" > Oct 14, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS UITextView Text Wrapping Editor (Swift)</h4><div class="text-muted small"><p> iOS UITextView Text Wrapping Editor (Swift) Practical Route Target Functionality: The app has a discussion area where users can post articles. The interface for posting articles needs to support...</p></div></div></a></div><div class="col"> <a href="/posts/cb6eba52a342/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539618241" data-df="ll" > Oct 15, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS ≥ 10 Notification Service Extension Application (Swift)</h4><div class="text-muted small"><p> iOS ≥ 10 Notification Service Extension Application (Swift) Image push notifications, push notification display statistics, pre-processing before push notification display Regarding the basics of...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/2e4429f410d6/" class="btn btn-outline-primary" prompt="Older" ><p>Easily Create a 'Fake' Transparent Perspective Wallpaper Using iPhone</p></a> <a href="/posts/724a7fb9a364/" class="btn btn-outline-primary" prompt="Newer" ><p>Is it Still Up-to-Date to Build a Personal Website Using Google Site?</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
