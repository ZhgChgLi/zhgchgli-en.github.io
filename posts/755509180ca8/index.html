<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Vision framework review &amp; trying out new Swift API in iOS 18" /><meta property="og:description" content="Vision framework review &amp; trying out new Swift API in iOS 18" /><link rel="canonical" href="https://en.zhgchg.li/posts/755509180ca8/" /><meta property="og:url" content="https://en.zhgchg.li/posts/755509180ca8/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-08-13T16:10:37+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.jpeg" /><meta property="twitter:title" content="iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-08-14T20:07:49+08:00","datePublished":"2024-08-13T16:10:37+08:00","description":"Vision framework review &amp; trying out new Swift API in iOS 18","headline":"iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session","image":"https://en.zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/755509180ca8/"},"url":"https://en.zhgchg.li/posts/755509180ca8/"}</script><title>iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1723536637" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 13, 2024 </em> </span> <span> Updated <em class="" data-ts="1723637269" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 14, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.jpeg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.jpeg" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4548 words" > <em>25 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session"><span class="me-2">iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</span><a href="#ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Vision framework review &amp; trying out new Swift API in iOS 18</p><p><a href="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.jpeg" class="popup img-link "><img data-src="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.jpeg" alt="Photo by [BoliviaInteligente](https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p>Photo by <a href="https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">BoliviaInteligente</a></p><h4 id="topic"><span class="me-2">Topic</span><a href="#topic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*ebqm2jzCK1GSrDDY0XtrUA.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*ebqm2jzCK1GSrDDY0XtrUA.png" alt="The relationship with Vision Pro is like the relationship between hot dogs and dogs, completely unrelated." class="lazyload" data-proofer-ignore></a></p><p>The relationship with Vision Pro is like the relationship between hot dogs and dogs, completely unrelated.</p><h3 id="vision-framework"><span class="me-2">Vision framework</span><a href="#vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The Vision framework is Apple’s integrated image recognition framework for machine learning, allowing developers to easily and quickly implement common image recognition functions. The Vision framework was introduced as early as iOS 11.0+ (2017/iPhone 8) and has been continuously iterated and optimized. It enhances performance by integrating features with Swift Concurrency and provides a new Swift Vision framework API from iOS 18.0 to maximize the benefits of Swift Concurrency.</p><p><strong>Features of Vision framework</strong></p><ul><li>Built-in numerous image recognition and motion tracking methods (up to 31 as of iOS 18)<li>On-Device computation using only the phone’s chip, independent of cloud services, fast and secure<li>Simple and easy-to-use API<li>Apple supports all platforms: iOS 11.0+, iPadOS 11.0+, Mac Catalyst 13.0+, macOS 10.13+, tvOS 11.0+, visionOS 1.0+<li>Released for multiple years (2017-present) and continuously updated<li>Enhances computational performance by integrating Swift language features</ul><blockquote><p><strong><em>Played around 6 years ago: <a href="../9a9aa892f9a9/">Exploring Vision - Automatically Recognizing Faces for App Avatar Cropping (Swift)</a></em></strong></p></blockquote><blockquote><p><em>This time, in conjunction with <a href="https://developer.apple.com/videos/play/wwdc2024/10163/" target="_blank">WWDC 24 Discover Swift enhancements in the Vision framework Session</a>, revisiting and combining new Swift features to play again.</em></p></blockquote><h4 id="coreml"><span class="me-2">CoreML</span><a href="#coreml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Apple also has another framework called <a href="https://developer.apple.com/documentation/coreml" target="_blank">CoreML</a>, which is a machine learning framework based on On-Device chips. It allows you to train models for objects or documents you want to recognize and use the models directly in the app. Interested friends can also give it a try. (e.g. <a href="../793bf2cdda0f/">Real-time article classification</a>, real-time <a href="https://apps.apple.com/tw/app/%E7%86%8A%E7%8C%AB%E5%90%83%E7%9F%AD%E4%BF%A1-%E5%9E%83%E5%9C%BE%E7%9F%AD%E4%BF%A1%E8%BF%87%E6%BB%A4/id1319191852" target="_blank">spam message detection</a> …)</p><h4 id="ps"><span class="me-2">p.s.</span><a href="#ps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>Vision</strong> v.s. <strong>VisionKit</strong>:</p><blockquote><p><strong><em>Vision</em></strong>: Mainly used for image analysis tasks such as face recognition, barcode detection, text recognition, etc. It provides powerful APIs to handle and analyze visual content in static images or videos.</p></blockquote><blockquote><p><strong><em>VisionKit</em></strong>: Specifically designed for tasks related to document scanning. It offers a scanner view controller that can be used to scan documents and generate high-quality PDFs or images.</p></blockquote><p>The Vision framework cannot run on the M1 model in the simulator, it can only be tested on a physical device; running in a simulator environment will throw a <code class="language-plaintext highlighter-rouge">Could not create Espresso context</code> error, no solution found in the <a href="https://forums.developer.apple.com/forums/thread/675806">official forum discussion</a>.</p><blockquote><p><em>Since I don’t have a physical iOS 18 device for testing, all the execution results in this article are based on the old (pre-iOS 18) syntax; <strong>please leave a comment if there are errors with the new syntax</strong>.</em></p></blockquote><h3 id="wwdc-2024--discover-swift-enhancements-in-the-vision-framework"><span class="me-2">WWDC 2024 — Discover Swift enhancements in the Vision framework</span><a href="#wwdc-2024--discover-swift-enhancements-in-the-vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*8N5GtY1uqxP-4iAAAticOA.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*8N5GtY1uqxP-4iAAAticOA.png" alt="Discover Swift enhancements in the Vision framework" class="lazyload" data-proofer-ignore></a></p><p><a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=45">Discover Swift enhancements in the Vision framework</a></p><blockquote><p><em>This article is a sharing note for WWDC 24 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=45">Discover Swift enhancements in the Vision framework</a> session, along with some experimental insights.</em></p></blockquote><h3 id="introduction--vision-framework-features"><span class="me-2">Introduction — Vision framework Features</span><a href="#introduction--vision-framework-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="face-recognition-contour-recognition"><span class="me-2">Face recognition, contour recognition</span><a href="#face-recognition-contour-recognition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*RNGfE_EeaQhiKAPdJeFYQw.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*RNGfE_EeaQhiKAPdJeFYQw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/755509180ca8/1*iMdzeLm2aWjATVV6_Kvrjg.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*iMdzeLm2aWjATVV6_Kvrjg.png" alt="" class="lazyload" data-proofer-ignore></a></p><h4 id="text-recognition-in-image-content"><span class="me-2">Text recognition in image content</span><a href="#text-recognition-in-image-content" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>As of iOS 18, it supports 18 languages.</p><p><a href="/assets/755509180ca8/1*kU_OYn5w368h-ahDYU4lDw.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*kU_OYn5w368h-ahDYU4lDw.png" alt="" class="lazyload" data-proofer-ignore></a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// Supported language list</span>
<span class="k">if</span> <span class="kd">#available(iOS 18.0, *)</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="kt">RecognizeTextRequest</span><span class="p">()</span><span class="o">.</span><span class="n">supportedRecognitionLanguages</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="nv">$0</span><span class="o">.</span><span class="n">languageCode</span><span class="o">!</span><span class="se">)</span><span class="s">-</span><span class="se">\(</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">region</span><span class="p">?</span><span class="o">.</span><span class="n">identifier</span> <span class="p">??</span> <span class="nv">$0</span><span class="o">.</span><span class="n">script</span><span class="p">?</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span><span class="o">!</span><span class="se">)</span><span class="s">"</span> <span class="p">})</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="k">try!</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">()</span><span class="o">.</span><span class="nf">supportedRecognitionLanguages</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// The actual available recognition languages are based on this.</span>
<span class="c1">// Tested on iOS 18, the output is as follows:</span>
<span class="c1">// ["en-US", "fr-FR", "it-IT", "de-DE", "es-ES", "pt-BR", "zh-Hans", "zh-Hant", "yue-Hans", "yue-Hant", "ko-KR", "ja-JP", "ru-RU", "uk-UA", "th-TH", "vi-VT", "ar-SA", "ars-SA"]</span>
<span class="c1">// Swedish language mentioned in WWDC was not seen, unsure if it has not been released yet or is related to device region and language settings</span>
</pre></table></code></div></div><h4 id="dynamic-motion-capture"><span class="me-2">Dynamic motion capture</span><a href="#dynamic-motion-capture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Can achieve dynamic capture of people and objects<li>Gesture capture implements air signature function</ul><h4 id="whats-new-in-vision-ios-18-image-rating-feature-quality-key-points"><span class="me-2">What’s new in Vision? (iOS 18)— Image rating feature (quality, key points)</span><a href="#whats-new-in-vision-ios-18-image-rating-feature-quality-key-points" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Calculate scores for input images to easily filter out high-quality photos<li>The scoring method includes multiple dimensions, not just image quality, but also lighting, angles, shooting subjects, <strong>whether there are memorable points</strong> … and so on</ul><p>WWDC provided the above three images for explanation (under the same image quality), which are:</p><ul><li>High-scoring image: composition, lighting, memorable points<li>Low-scoring image: no main subject, looks like taken casually or accidentally<li>Utility image: technically well-taken but lacks memorable points, like images used for stock photo libraries</ul><p><strong>iOS ≥ 18 New API: <a href="https://developer.apple.com/documentation/vision/calculateimageaestheticsscoresrequest" target="_blank">CalculateImageAestheticsScoresRequest</a></strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">CalculateImageAestheticsScoresRequest</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>

<span class="c1">// Photo score</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">overallScore</span><span class="p">)</span>

<span class="c1">// Whether it is judged as a utility image</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">isUtility</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="whats-new-in-vision-ios-18--simultaneous-detection-of-body-and-gesture-poses"><span class="me-2">What’s new in Vision? (iOS 18) — Simultaneous detection of body and gesture poses</span><a href="#whats-new-in-vision-ios-18--simultaneous-detection-of-body-and-gesture-poses" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>In the past, only body pose and hand pose could be detected separately.</p><p>With this update, developers can detect both body and hand poses simultaneously, combining them into a single request and result, making it more convenient for further feature development.</p><p><strong>iOS ≥ 18 New API: <a href="https://developer.apple.com/documentation/vision/detecthumanbodyposerequest" target="_blank">DetectHumanBodyPoseRequest</a></strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectHumanBodyPoseRequest</span><span class="p">()</span>
<span class="c1">// Detect hand pose together</span>
<span class="n">request</span><span class="o">.</span><span class="n">detectsHands</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">bodyPose</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">image</span><span class="p">)</span><span class="o">.</span> <span class="n">first</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

<span class="c1">// Body Pose Joints</span>
<span class="k">let</span> <span class="nv">bodyJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
<span class="c1">// Left hand Pose Joints</span>
<span class="k">let</span> <span class="nv">leftHandJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="n">leftHand</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
<span class="c1">// Right hand Pose Joints</span>
<span class="k">let</span> <span class="nv">rightHandJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="n">rightHand</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="new-vision-api"><span class="me-2">New Vision API</span><a href="#new-vision-api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Apple provides new Swift Vision API wrappers for developers in this update, in addition to basic support for existing functionalities, mainly focusing on enhancing Swift 6 / Swift Concurrency features, providing more efficient and Swift-like API operation methods.</p><h3 id="get-started-with-vision"><span class="me-2">Get started with Vision</span><a href="#get-started-with-vision" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The speaker here reintroduced the basic usage of the Vision framework. Apple has encapsulated <a href="https://developer.apple.com/documentation/vision/visionrequest" target="_blank">31 types</a> of common image recognition requests and their corresponding “Observation” objects (as of iOS 18).</p><ol><li><p><strong>Request:</strong> DetectFaceRectanglesRequest - Face area recognition request <strong>Result:</strong> FaceObservation The previous article “<a href="../9a9aa892f9a9/">Exploring Vision - Automatically Identify Faces for Avatar Upload in Apps (Swift)</a>” used this pair of requests.</p><li><p><strong>Request:</strong> RecognizeTextRequest - Text recognition request <strong>Result:</strong> RecognizedTextObservation</p><li><p><strong>Request:</strong> GenerateObjectnessBasedSaliencyImageRequest - Objectness-based object recognition request <strong>Result:</strong> SaliencyImageObservation</p></ol><h3 id="all-31-types-of-requests"><span class="me-2">All 31 types of requests:</span><a href="#all-31-types-of-requests" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://developer.apple.com/documentation/vision/visionrequest" target="_blank">VisionRequest</a>.</p><div class="table-wrapper"><table><thead><tr><th>Request Purpose<th>Observation Description<tbody><tr><td>CalculateImageAestheticsScoresRequest<br />Calculate the aesthetic score of the image.<td>AestheticsObservation<br />Returns the aesthetic score of the image, considering factors like composition and color.<tr><td>ClassifyImageRequest<br />Classify the content of the image.<td>ClassificationObservation<br />Returns the classification labels and confidence of objects or scenes in the image.<tr><td>CoreMLRequest<br />Analyze images using Core ML models.<td>CoreMLFeatureValueObservation<br />Generates observations based on the output of Core ML models.<tr><td>DetectAnimalBodyPoseRequest<br />Detect animal poses in images.<td>RecognizedPointsObservation<br />Returns the skeleton points and their positions of animals.<tr><td>DetectBarcodesRequest<br />Detect barcodes in images.<td>BarcodeObservation<br />Returns barcode data and types (e.g., QR code).<tr><td>DetectContoursRequest<br />Detect contours in images.<td>ContoursObservation<br />Returns detected contour lines in the image.<tr><td>DetectDocumentSegmentationRequest<br />Detect and segment documents in images.<td>RectangleObservation<br />Returns the rectangular boundary positions of documents.<tr><td>DetectFaceCaptureQualityRequest<br />Evaluate the quality of face captures.<td>FaceObservation<br />Returns quality assessment scores for facial images.<tr><td>DetectFaceLandmarksRequest<br />Detect facial landmarks.<td>FaceObservation<br />Returns detailed positions of facial landmarks (e.g., eyes, nose).<tr><td>DetectFaceRectanglesRequest<br />Detect faces in images.<td>FaceObservation<br />Returns the bounding box positions of faces.<tr><td>DetectHorizonRequest<br />Detect horizons in images.<td>HorizonObservation<br />Returns the angle and position of the horizon.<tr><td>DetectHumanBodyPose3DRequest<br />Detect 3D human body poses in images.<td>RecognizedPointsObservation<br />Returns 3D human skeleton points and their spatial coordinates.<tr><td>DetectHumanBodyPoseRequest<br />Detect human body poses in images.<td>RecognizedPointsObservation<br />Returns human skeleton points and their coordinates.<tr><td>DetectHumanHandPoseRequest<br />Detect hand poses in images.<td>RecognizedPointsObservation<br />Returns hand skeleton points and their positions.<tr><td>DetectHumanRectanglesRequest<br />Detect humans in images.<td>HumanObservation<br />Returns the bounding box positions of humans.<tr><td>DetectRectanglesRequest<br />Detect rectangles in images.<td>RectangleObservation<br />Returns the coordinates of the four vertices of rectangles.<tr><td>DetectTextRectanglesRequest<br />Detect text regions in images.<td>TextObservation<br />Returns the positions and bounding boxes of text regions.<tr><td>DetectTrajectoriesRequest<br />Detect and analyze object motion trajectories.<td>TrajectoryObservation<br />Returns motion trajectory points and their time series.<tr><td>GenerateAttentionBasedSaliencyImageRequest<br />Generate attention-based saliency images.<td>SaliencyImageObservation<br />Returns saliency maps of the most attractive areas in the image.<tr><td>GenerateForegroundInstanceMaskRequest<br />Generate foreground instance mask images.<td>InstanceMaskObservation<br />Returns masks of foreground objects.<tr><td>GenerateImageFeaturePrintRequest<br />Generate image feature prints for comparison.<td>FeaturePrintObservation<br />Returns feature fingerprint data of images for similarity comparison.<tr><td>GenerateObjectnessBasedSaliencyImageRequest<br />Generate objectness-based saliency images.<td>SaliencyImageObservation<br />Returns saliency maps of object saliency areas.<tr><td>GeneratePersonInstanceMaskRequest<br />Generate person instance mask images.<td>InstanceMaskObservation<br />Returns masks of person instances.<tr><td>GeneratePersonSegmentationRequest<br />Generate person segmentation images.<td>SegmentationObservation<br />Returns binary images of person segmentation.<tr><td>RecognizeAnimalsRequest<br />Detect and identify animals in images.<td>RecognizedObjectObservation<br />Returns animal types and their confidence levels.<tr><td>RecognizeTextRequest<br />Detect and identify text in images.<td>RecognizedTextObservation<br />Returns detected text content and its spatial positions.<tr><td>TrackHomographicImageRegistrationRequest<br />Track homographic image registration.<td>ImageAlignmentObservation<br />Returns homographic transformation matrices between images for image registration.<tr><td>TrackObjectRequest<br />Track objects in images.<td>DetectedObjectObservation<br />Returns the positions and velocity information of objects in images.<tr><td>TrackOpticalFlowRequest<br />Track optical flow in images.<td>OpticalFlowObservation<br />Returns optical flow vector fields describing pixel movements.<tr><td>TrackRectangleRequest<br />Track rectangles in images.<td>RectangleObservation<br />Returns the positions, sizes, and rotation angles of rectangles in images.<tr><td>TrackTranslationalImageRegistrationRequest<br />Track translational image registration.<td>ImageAlignmentObservation<br />Returns translational transformation matrices between images for image registration.</table></div><ul><li>Prefixing VN in front is the old API writing method (before iOS 18)</ul><p>The speaker mentioned several commonly used Requests as follows.</p><h4 id="classifyimagerequest"><span class="me-2">ClassifyImageRequest</span><a href="#classifyimagerequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Recognize the input image, obtain label classification and confidence.</p><p><a href="/assets/755509180ca8/1*8NSQEjxGejujKLbXcILmxQ.jpeg" class="popup img-link "><img data-src="/assets/755509180ca8/1*8NSQEjxGejujKLbXcILmxQ.jpeg" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/755509180ca8/1*f1rNoOIQbE33M9F9NmoTXg.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*f1rNoOIQbE33M9F9NmoTXg.png" alt="[Travelogue] 2024 Second Visit to Kyushu 9-Day Free and Easy Trip, Entering Fukuoka by Busan→Hakata Cruise" class="lazyload" data-proofer-ignore></a></p><p>[Travelogue] 2024 Second Visit to Kyushu 9-Day Free and Easy Trip, Entering Fukuoka by Busan→Hakata Cruise</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="kd">#available(iOS 18.0, *)</span> <span class="p">{</span>
    <span class="c1">// New API using Swift features</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">ClassifyImageRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Old method</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNClassificationObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNClassifyImageRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*3_jdrLurFuUfNdW4BJaRww.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Analysis Results:</strong></p><div class="language-r highlighter-rouge"><div class="code-header"> <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">outdoor</span><span class="o">:</span><span class="w"> </span><span class="m">0.75392926</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">sky</span><span class="o">:</span><span class="w"> </span><span class="m">0.75392926</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">blue_sky</span><span class="o">:</span><span class="w"> </span><span class="m">0.7519531</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">machine</span><span class="o">:</span><span class="w"> </span><span class="m">0.6958008</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">cloudy</span><span class="o">:</span><span class="w"> </span><span class="m">0.26538086</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">structure</span><span class="o">:</span><span class="w"> </span><span class="m">0.15728651</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">sign</span><span class="o">:</span><span class="w"> </span><span class="m">0.14224191</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">fence</span><span class="o">:</span><span class="w"> </span><span class="m">0.118652344</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">banner</span><span class="o">:</span><span class="w"> </span><span class="m">0.0793457</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">material</span><span class="o">:</span><span class="w"> </span><span class="m">0.075975396</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">plant</span><span class="o">:</span><span class="w"> </span><span class="m">0.054406323</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">foliage</span><span class="o">:</span><span class="w"> </span><span class="m">0.05029297</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">light</span><span class="o">:</span><span class="w"> </span><span class="m">0.048126098</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">lamppost</span><span class="o">:</span><span class="w"> </span><span class="m">0.048095703</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">billboards</span><span class="o">:</span><span class="w"> </span><span class="m">0.040039062</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">art</span><span class="o">:</span><span class="w"> </span><span class="m">0.03977703</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">branch</span><span class="o">:</span><span class="w"> </span><span class="m">0.03930664</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">decoration</span><span class="o">:</span><span class="w"> </span><span class="m">0.036868922</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">flag</span><span class="o">:</span><span class="w"> </span><span class="m">0.036865234</span><span class="w">
</span><span class="n">....etc</span><span class="w">
</span></pre></table></code></div></div><h4 id="recognizetextrequest"><span class="me-2">RecognizeTextRequest</span><a href="#recognizetextrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Recognize the text content in the image (a.k.a OCR)</p><p><a href="../9da2c51fa4f2/" class="popup img-link "><img data-src="../9da2c51fa4f2/" alt="[Travelogue] 2023 Tokyo 5-day free trip" class="lazyload" data-proofer-ignore></a></p><p>[Travelogue] 2023 Tokyo 5-day free trip](../9da2c51fa4f2/)</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="kd">#available(iOS 18.0, *)</span> <span class="p">{</span>
    <span class="c1">// New API using Swift features</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"ja-JP"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span> <span class="c1">// Specify language code, e.g., Traditional Chinese</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Old way</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedTextObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="s">"ja-JP"</span><span class="p">,</span> <span class="s">"en-US"</span><span class="p">]</span> <span class="c1">// Specify language code, e.g., Traditional Chinese</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Analysis Result:</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="err">LE</span> <span class="err">LABO</span> <span class="err">Aoyama</span> <span class="err">Store</span>
<span class="nl">TEL</span><span class="o">:</span><span class="nf">03-6419-7167</span>
<span class="err">*Thank</span> <span class="err">you</span> <span class="err">for</span> <span class="err">your</span> <span class="err">purchase*</span>
<span class="nl">No</span><span class="o">:</span> <span class="nf">21347</span>
<span class="nl">Date</span><span class="o">:</span> <span class="nf">2023/06/10 14.14.57</span>
<span class="nl">Responsible</span><span class="o">:</span>
<span class="err">1690370</span>
<span class="nl">Register</span><span class="o">:</span> <span class="nf">008A 1</span>
<span class="err">Product</span> <span class="err">Name</span>
<span class="err">Tax-inclusive</span> <span class="err">Price</span> <span class="err">Quantity</span> <span class="err">Tax-inclusive</span> <span class="err">Total</span>
<span class="err">Kaiak</span> <span class="err">10</span> <span class="err">EDP</span> <span class="err">FB</span> <span class="err">15ML</span>
<span class="err">J1P7010000S</span>
<span class="err">16,800</span>
<span class="err">16,800</span>
<span class="err">Another</span> <span class="err">13</span> <span class="err">EDP</span> <span class="err">FB</span> <span class="err">15ML</span>
<span class="err">J1PJ010000S</span>
<span class="err">10,700</span>
<span class="err">10,700</span>
<span class="err">Lip</span> <span class="err">Balm</span> <span class="err">15ML</span>
<span class="err">JOWC010000S</span>
<span class="err">2,000</span>
<span class="err">1</span>
<span class="err">Total</span> <span class="err">Amount</span>
<span class="err">(Tax</span> <span class="err">Included)</span>
<span class="err">CARD</span>
<span class="err">2,000</span>
<span class="err">3</span> <span class="err">items</span> <span class="err">purchased</span>
<span class="err">29,500</span>
<span class="err">0</span>
<span class="err">29,500</span>
<span class="err">29,500</span>
</pre></table></code></div></div><h4 id="detectbarcodesrequest"><span class="me-2">DetectBarcodesRequest</span><a href="#detectbarcodesrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Detect barcode and QR code data in the image.</p><p><a href="/assets/755509180ca8/1*Z72y9rIwIKQCmnnuwsq0uQ.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*Z72y9rIwIKQCmnnuwsq0uQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/755509180ca8/1*s3V1UQRIqto-iG1e30PK7Q.jpeg" class="popup img-link "><img data-src="/assets/755509180ca8/1*s3V1UQRIqto-iG1e30PK7Q.jpeg" alt="Thai locals recommend Goose Brand Cooling Gel" class="lazyload" data-proofer-ignore></a></p><p>Thai locals recommend Goose Brand Cooling Gel</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_6777"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// Local test image</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="kd">#available(iOS 18.0, *)</span> <span class="p">{</span>
    <span class="c1">// New API using Swift features</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Old way</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Analysis Results:</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nl">Payload</span><span class="o">:</span> <span class="nf">8859126000911</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyEAN13</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">https://lin.ee/hGynbVM</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">http://www.hongthaipanich.com/</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">https://www.facebook.com/qr?id=100063856061714</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
</pre></table></code></div></div><h4 id="recognizeanimalsrequest"><span class="me-2">RecognizeAnimalsRequest</span><a href="#recognizeanimalsrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Recognize animals in the image with confidence.</p><p><a href="/assets/755509180ca8/1*5zF3gA3WB1Q0-_cgt6mTCw.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*5zF3gA3WB1Q0-_cgt6mTCw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/755509180ca8/1*KZ7mdE8fobP-_oj7tJf_Ww.jpeg" class="popup img-link "><img data-src="/assets/755509180ca8/1*KZ7mdE8fobP-_oj7tJf_Ww.jpeg" alt="[meme Source](https://www.redbubble.com/i/canvas-print/Funny-AI-Woman-yelling-at-a-cat-meme-design-Machine-learning-by-omolog/43039298.5Y5V7){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p><a href="https://www.redbubble.com/i/canvas-print/Funny-AI-Woman-yelling-at-a-cat-meme-design-Machine-learning-by-omolog/43039298.5Y5V7" target="_blank">meme Source</a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_5026"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// Local test image</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="kd">#available(iOS 18.0, *)</span> <span class="p">{</span>
    <span class="c1">// New API using Swift features</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">RecognizeAnimalsRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">labels</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">labels</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                    <span class="n">label</span> <span class="k">in</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Detected animal: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s"> with confidence: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Old way</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedObjectObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">labels</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">labels</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">label</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Detected animal: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s"> with confidence: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNRecognizeAnimalsRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Analysis Results:</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Detected</span> <span class="n">animal</span><span class="p">:</span> <span class="n">Cat</span> <span class="n">with</span> <span class="n">confidence</span><span class="p">:</span> <span class="m">0.77245045</span>
</pre></table></code></div></div><h4 id="others"><span class="me-2">Others:</span><a href="#others" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Detecting human body in images: DetectHumanRectanglesRequest<li>Detecting poses of animals and humans (3D or 2D): DetectAnimalBodyPoseRequest, DetectHumanBodyPose3DRequest, DetectHumanBodyPoseRequest, DetectHumanHandPoseRequest<li>Detecting and tracking object trajectories (in different frames of videos, animations): DetectTrajectoriesRequest, TrackObjectRequest, TrackRectangleRequest</ul><h4 id="ios--18-update-highlight"><span class="me-2"><strong>iOS ≥ 18 Update Highlight:</strong></span><a href="#ios--18-update-highlight" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">VN</span><span class="o">*</span><span class="n">Request</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="nf">Request</span> <span class="p">(</span><span class="n">e</span><span class="py">.g. VNDetectBarcodesRequest</span> <span class="k">-&gt;</span> <span class="n">DetectBarcodesRequest</span><span class="p">)</span>
<span class="n">VN</span><span class="o">*</span><span class="n">Observation</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="nf">Observation</span> <span class="p">(</span><span class="n">e</span><span class="py">.g. VNRecognizedObjectObservation</span> <span class="k">-&gt;</span> <span class="n">RecognizedObjectObservation</span><span class="p">)</span>
<span class="n">VNRequestCompletionHandler</span> <span class="k">-&gt;</span> <span class="k">async</span><span class="o">/</span><span class="k">await</span>
<span class="n">VNImageRequestHandler</span><span class="nf">.perform</span><span class="p">([</span><span class="n">VN</span><span class="o">*</span><span class="n">Request</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="n">Request</span><span class="nf">.perform</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="wwdc-example"><span class="me-2">WWDC Example</span><a href="#wwdc-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The official WWDC video uses a supermarket product scanner as an example.</p><h4 id="most-products-have-a-barcode-that-can-be-scanned"><span class="me-2">Most products have a Barcode that can be scanned</span><a href="#most-products-have-a-barcode-that-can-be-scanned" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*YT_Uf8eEi36Iv7zcOrmP4A.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*YT_Uf8eEi36Iv7zcOrmP4A.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/755509180ca8/1*J9uIwRKubLoJoC7i096AdQ.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*J9uIwRKubLoJoC7i096AdQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/755509180ca8/1*gKg-NfHYqy7uBqe5hxzBSw.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*gKg-NfHYqy7uBqe5hxzBSw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>We can obtain the location of the Barcode from <code class="language-plaintext highlighter-rouge">observation.boundingBox</code>, but unlike the common UIView coordinate system, the <code class="language-plaintext highlighter-rouge">BoundingBox</code>’s relative position starts from the lower left corner, with values ranging from 0 to 1.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_6785"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// Local test image</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="kd">#available(iOS 18.0, *)</span> <span class="p">{</span>
    <span class="c1">// New API using Swift features</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// If only scanning EAN13 Barcode is needed, it can be specified directly to improve performance</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                    <span class="c1">// Color layer marking</span>
                    <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                    <span class="c1">// iOS &gt;=18 new coordinate transformation API toImageCoordinates</span>
                    <span class="c1">// Not tested, may need to calculate the offset for ContentMode = AspectFit:</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Old approach</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span>
                <span class="c1">// Color layer marking</span>
                <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="p">)</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// If only scanning EAN13 Barcode is needed, it can be specified directly to improve performance</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>iOS ≥ 18 Update Highlight:</strong></p><pre><code class="language-less">// iOS ≥18 New Coordinate Transformation API toImageCoordinates
observation.boundingBox.toImageCoordinates(CGSize, origin: .upperLeft)
// https://developer.apple.com/documentation/vision/normalizedpoint/toimagecoordinates(from:imagesize:origin:)
</code></pre><p><strong>Helper:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">// Generated by ChatGPT 4o</span>
<span class="c1">// Since the photo in the ImageView is set with ContentMode = AspectFit</span>
<span class="c1">// Extra calculation is needed for the top and bottom offset caused by Fit</span>
<span class="kd">func</span> <span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">_</span> <span class="nv">boundingBox</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">,</span> <span class="n">to</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">UIImageView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">CGRect</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">.</span><span class="n">zero</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">imageSize</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>
    <span class="k">let</span> <span class="nv">viewSize</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span>
    <span class="k">let</span> <span class="nv">imageRatio</span> <span class="o">=</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span>
    <span class="k">let</span> <span class="nv">viewRatio</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">height</span>
    <span class="k">var</span> <span class="nv">scaleFactor</span><span class="p">:</span> <span class="kt">CGFloat</span>
    <span class="k">var</span> <span class="nv">offsetX</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">var</span> <span class="nv">offsetY</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">imageRatio</span> <span class="o">&gt;</span> <span class="n">viewRatio</span> <span class="p">{</span>
        <span class="c1">// Image fits in the width direction</span>
        <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span>
        <span class="n">offsetY</span> <span class="o">=</span> <span class="p">(</span><span class="n">viewSize</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Image fits in the height direction</span>
        <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span>
        <span class="n">offsetX</span> <span class="o">=</span> <span class="p">(</span><span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">minX</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span> <span class="o">+</span> <span class="n">offsetX</span>
    <span class="k">let</span> <span class="nv">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">maxY</span><span class="p">)</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span> <span class="o">+</span> <span class="n">offsetY</span>
    <span class="k">let</span> <span class="nv">width</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span>
    <span class="k">let</span> <span class="nv">height</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span>
    <span class="k">return</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">height</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Output:</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nl">BoundingBox</span><span class="o">:</span> <span class="nf">(0.5295758928571429</span><span class="p">,</span><span class="nf"> 0.21408638121589782</span><span class="p">,</span><span class="nf"> 0.0943080357142857</span><span class="p">,</span><span class="nf"> 0.21254415360708087)</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">4710018183805</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyEAN13</span>
</pre></table></code></div></div><h4 id="some-products-do-not-have-a-barcode-such-as-loose-fruits-with-only-product-labels"><span class="me-2">Some products do not have a barcode, such as loose fruits with only product labels</span><a href="#some-products-do-not-have-a-barcode-such-as-loose-fruits-with-only-product-labels" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*jeZhLtg9j11kgOAvKZmevg.jpeg" class="popup img-link "><img data-src="/assets/755509180ca8/1*jeZhLtg9j11kgOAvKZmevg.jpeg" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/755509180ca8/1*YNokMMUewMA2kzjoGmMJPw.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*YNokMMUewMA2kzjoGmMJPw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Therefore, our scanner also needs to support scanning pure text labels simultaneously.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"apple"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"jpg"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// Local test image</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="kd">#available(iOS 18.0, *)</span> <span class="p">{</span>
    <span class="c1">// New API using Swift features</span>
    <span class="k">var</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// If only scanning EAN13 Barcode is needed, it can be specified directly to improve performance</span>
    <span class="k">var</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"zh-Hnat"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
            <span class="c1">// parameter pack syntax and we must wait for all requests to finish before we can use their results.</span>
            <span class="c1">// let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...)</span>
            <span class="k">let</span> <span class="p">(</span><span class="nv">barcodesObservation</span><span class="p">,</span> <span class="nv">textObservation</span><span class="p">)</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">)</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">barcodesObservation</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                    <span class="c1">// Color layer</span>
                    <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                    <span class="c1">// New Coordinate Transformation API toImageCoordinates for iOS &gt;=18</span>
                    <span class="c1">// Not tested, may need to consider the offset of ContentMode = AspectFit:</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">textObservation</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Old approach</span>
    <span class="k">let</span> <span class="nv">barcodesCompletionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span>
                <span class="c1">// Color layer</span>
                <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="p">)</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">textCompletionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedTextObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">barcodesCompletionHandler</span><span class="p">)</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// If only scanning EAN13 Barcode is needed, it can be specified directly to improve performance</span>
    <span class="k">let</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">textCompletionHandler</span><span class="p">)</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="s">"en-US"</span><span class="p">]</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Output:</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>94128s
ORGANIC
Pink Lady®
Produce of USh
</pre></table></code></div></div><p><strong>iOS ≥ 18 Update Highlight:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
<span class="c1">// parameter pack syntax and we must wait for all requests to finish before we can use their results.</span>
<span class="c1">// let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...)</span>
<span class="k">let</span> <span class="p">(</span><span class="nv">barcodesObservation</span><span class="p">,</span> <span class="nv">textObservation</span><span class="p">)</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="ios--18-performall--method"><span class="me-2">iOS ≥ 18 <a href="https://developer.apple.com/documentation/vision/imagerequesthandler/performall(_:)?changes=latest_minor" target="_blank">performAll( )</a> method</span><a href="#ios--18-performall--method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*z0364eYD4F4On194EgQ1kQ.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*z0364eYD4F4On194EgQ1kQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>The previous <code class="language-plaintext highlighter-rouge">perform(barcodesRequest, textRequest)</code> method for handling Barcode scanning and text recognition required both requests to be completed before continuing execution; starting from iOS 18, a new <code class="language-plaintext highlighter-rouge">performAll()</code> method is provided, changing the response method to streaming, allowing corresponding processing as soon as one of the requests is received, such as responding directly when a Barcode is scanned.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="kd">#available(iOS 18.0, *)</span> <span class="p">{</span>
    <span class="c1">// New API using Swift features</span>
    <span class="k">var</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// If only scanning EAN13 Barcodes is needed, it can be specified directly to improve performance</span>
    <span class="k">var</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"zh-Hnat"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="nf">performAll</span><span class="p">([</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">]</span> <span class="k">as</span> <span class="p">[</span><span class="n">any</span> <span class="kt">VisionRequest</span><span class="p">])</span>
        <span class="k">for</span> <span class="k">try</span> <span class="k">await</span> <span class="n">result</span> <span class="k">in</span> <span class="n">observation</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">detectBarcodes</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">let</span> <span class="nv">barcodesObservation</span><span class="p">):</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">barcodesObservation</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                        <span class="c1">// Color layer marking</span>
                        <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                        <span class="c1">// iOS &gt;=18 new coordinate transformation API toImageCoordinates</span>
                        <span class="c1">// Not tested, may still need to calculate the offset for ContentMode = AspectFit:</span>
                        <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                        <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">recognizeText</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">let</span> <span class="nv">textObservation</span><span class="p">):</span>
                <span class="n">textObservation</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                    <span class="n">observation</span> <span class="k">in</span>
                    <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                    <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">default</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Unrecognized result: </span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="optimize-with-swift-concurrency"><span class="me-2">Optimize with Swift Concurrency</span><a href="#optimize-with-swift-concurrency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Assuming we have a list of image wall, and each image needs to automatically crop out the main object; this is where we can leverage Swift Concurrency to improve loading efficiency.</p><h4 id="original-implementation"><span class="me-2"><strong>Original Implementation</strong></span><a href="#original-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="k">async</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">UIImage</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">GenerateAttentionBasedSaliencyImageRequest</span><span class="p">()</span>
  <span class="k">let</span> <span class="nv">saliencyObservation</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
  <span class="k">return</span> <span class="nf">cropImage</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">saliencyObservation</span><span class="o">.</span><span class="n">salientObjects</span><span class="p">)</span>
<span class="p">}</span>
    
<span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">image</span> <span class="k">in</span> <span class="n">images</span> <span class="p">{</span>
    <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Executing one at a time, slow efficiency and performance.</p><h4 id="optimization-1--taskgroup-concurrency"><span class="me-2"><strong>Optimization (1) — TaskGroup Concurrency</strong></span><a href="#optimization-1--taskgroup-concurrency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">try</span> <span class="k">await</span> <span class="n">withThrowingDiscardingTaskGroup</span> <span class="p">{</span> <span class="n">taskGroup</span> <span class="k">in</span>
    <span class="k">for</span> <span class="n">image</span> <span class="k">in</span> <span class="n">images</span> <span class="p">{</span>
      <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Adding each Task to TaskGroup Concurrency for execution.</p><blockquote><p><strong><em>Issue: Image recognition and cropping operations are memory-intensive. Unrestrained parallel tasks may cause user lagging and OOM crashes.</em></strong></p></blockquote><h4 id="optimization-2--taskgroup-concurrency--limiting-parallelism"><span class="me-2">Optimization (2) — TaskGroup Concurrency + Limiting Parallelism</span><a href="#optimization-2--taskgroup-concurrency--limiting-parallelism" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">try</span> <span class="k">await</span> <span class="n">withThrowingDiscardingTaskGroup</span> <span class="p">{</span>
        <span class="n">taskGroup</span> <span class="k">in</span>
        <span class="c1">// Maximum execution not to exceed 5</span>
        <span class="k">let</span> <span class="nv">maxImageTasks</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">images</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="c1">// Fill in 5 tasks first</span>
        <span class="k">for</span> <span class="n">index</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">maxImageTasks</span> <span class="p">{</span>
            <span class="n">taskGroup</span><span class="o">.</span><span class="n">addTask</span> <span class="p">{</span>
                <span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nv">nextIndex</span> <span class="o">=</span> <span class="n">maxImageTasks</span>
        <span class="k">for</span> <span class="k">try</span> <span class="k">await</span> <span class="n">_</span> <span class="k">in</span> <span class="n">taskGroup</span> <span class="p">{</span>
            <span class="c1">// When a Task in taskGroup completes await...</span>
            <span class="c1">// Check if the Index reaches the end</span>
            <span class="k">if</span> <span class="n">nextIndex</span> <span class="o">&lt;</span> <span class="n">images</span><span class="o">.</span><span class="n">count</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">nextIndex</span><span class="p">]</span>
                <span class="c1">// Continue filling tasks one by one (maintaining at most 5)</span>
                <span class="n">taskGroup</span><span class="o">.</span><span class="n">addTask</span> <span class="p">{</span>
                    <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">nextIndex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="update-an-existing-vision-app"><span class="me-2">Update an existing Vision app</span><a href="#update-an-existing-vision-app" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>Vision will remove CPU and GPU support for some requests on devices with a neural engine. On these devices, the neural engine is the best choice for performance. You can check using the <code class="language-plaintext highlighter-rouge">supportedComputeDevices()</code> API.<li>Remove all VN prefixes <code class="language-plaintext highlighter-rouge">VNXXRequest</code>, <code class="language-plaintext highlighter-rouge">VNXXXObservation</code> -&gt; <code class="language-plaintext highlighter-rouge">Request</code>, <code class="language-plaintext highlighter-rouge">Observation</code><li>Replace the original VNRequestCompletionHandler with async/await.<li>Use <code class="language-plaintext highlighter-rouge">*Request.perform()</code> directly instead of <code class="language-plaintext highlighter-rouge">VNImageRequestHandler.perform([VN*Request])</code>.</ol><h3 id="wrap-up"><span class="me-2">Wrap-up</span><a href="#wrap-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>API designed for Swift language features<li>New features and methods are Swift Only, available for iOS ≥ 18<li>New image scoring feature, body + hand movement tracking</ul><h3 id="thanks"><span class="me-2">Thanks!</span><a href="#thanks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*BK_5eH1i4-drOUOGnuQRSg.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*BK_5eH1i4-drOUOGnuQRSg.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="kkday-business-recruitment"><span class="me-2">KKday Business Recruitment</span><a href="#kkday-business-recruitment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*kjcldhvCP1cM-QqDfRFaYg.png" class="popup img-link "><img data-src="/assets/755509180ca8/1*kjcldhvCP1cM-QqDfRFaYg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>👉👉👉This book club sharing is derived from the weekly technical sharing activities within the KKday App Team. <strong>The team is currently enthusiastically recruiting <a href="https://kkday.bamboohr.com/careers/25?source=aWQ9Mjk%3D" target="_blank">Senior iOS Engineer</a> , interested friends are welcome to submit resumes</strong>.👈👈👈</p><h4 id="reference"><span class="me-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h4 id="discover-swift-enhancements-in-the-vision-framework"><span class="me-2"><a href="https://developer.apple.com/videos/play/wwdc2024/10163/" target="_blank">Discover Swift enhancements in the Vision framework</a></span><a href="#discover-swift-enhancements-in-the-vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The Vision Framework API has been redesigned to leverage modern Swift features like concurrency, making it easier and faster to integrate a wide array of Vision algorithms into your app. We’ll tour the updated API and share sample code, along with best practices, to help you get the benefits of this framework with less coding effort. We’ll also demonstrate two new features: image aesthetics and holistic body pose.</p><h3 id="chapters"><span class="me-2">Chapters</span><a href="#chapters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>0:00 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=0" target="_blank">Introduction</a><li>1:07 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=67" target="_blank">New Vision API</a><li>1:47 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=107" target="_blank">Get started with Vision</a><li>8:59 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=539" target="_blank">Optimize with Swift Concurrency</a><li>11:05 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=665" target="_blank">Update an existing Vision app</a><li>13:46 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=826" target="_blank">What’s new in Vision?</a></ul><h4 id="vision-framework-apple-developer-documentation"><span class="me-2"><a href="https://developer.apple.com/documentation/vision/" target="_blank">Vision framework Apple Developer Documentation</a></span><a href="#vision-framework-apple-developer-documentation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>-</p><p>Feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a> for any questions or feedback.</p><p>===</p><p><a href="https://zhgchg.li/posts/755509180ca8/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/755509180ca8" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/kkday/'>KKday</a>, <a href='/categories/tech/'>Tech</a>, <a href='/categories/blog/'>Blog</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/vision-framework/" class="post-tag no-text-decoration" >vision-framework</a> <a href="/tags/apple-intelligence/" class="post-tag no-text-decoration" >apple-intelligence</a> <a href="/tags/ai/" class="post-tag no-text-decoration" >ai</a> <a href="/tags/machine-learning/" class="post-tag no-text-decoration" >machine-learning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20Vision%20framework%20x%20WWDC%2024%20Discover%20Swift%20enhancements%20in%20the%20Vision%20framework%20Session%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F755509180ca8%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20Vision%20framework%20x%20WWDC%2024%20Discover%20Swift%20enhancements%20in%20the%20Vision%20framework%20Session%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F755509180ca8%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F755509180ca8%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/9a9aa892f9a9/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539705684" data-df="ll" > Oct 17, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift)</h4><div class="text-muted small"><p> Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift) Practical Application of Vision [2024/08/13 Update] Refer to the new article and API: “iOS Vision framewor...</p></div></div></a></div><div class="col"> <a href="/posts/793bf2cdda0f/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539789635" data-df="ll" > Oct 17, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>Exploring iOS 12 CoreML — Automatically Predict Article Categories Using Machine Learning, Even Train the Model Yourself!</h4><div class="text-muted small"><p> Exploring iOS 12 CoreML — Automatically Predict Article Categories Using Machine Learning, Even Train the Model Yourself! Explore CoreML 2.0, how to convert or train models and apply them in real ...</p></div></div></a></div><div class="col"> <a href="/posts/f4b02ee342a4/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1725601667" data-df="ll" > Sep 6, 2024 </em><h4 class="pt-0 my-2" data-toc-skip>Practical Application Record of Design Patterns—In WKWebView with Builder, Strategy & Chain of Responsibility Pattern</h4><div class="text-muted small"><p> Practical Application Record of Design Patterns—In WKWebView with Builder, Strategy &amp;amp; Chain of Responsibility Pattern Scenarios of using Design Patterns (Strategy, Chain of Responsibility, Bui...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cefdf4d41746/" class="btn btn-outline-primary" prompt="Older" ><p>Medium Partner Program is finally open to global (including Taiwan) writers!</p></a> <a href="/posts/309d0302877b/" class="btn btn-outline-primary" prompt="Newer" ><p>iOS Shortcut Automation Scenarios - Automatically Forwarding Text Messages and Creating Reminder Tasks</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
