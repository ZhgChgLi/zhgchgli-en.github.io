<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Revealing a Clever Website Vulnerability Discovered Years Ago" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Website security issues caused by multiple vulnerabilities combined" /><meta property="og:description" content="Website security issues caused by multiple vulnerabilities combined" /><link rel="canonical" href="https://en.zhgchg.li/posts/142244e5f07a/" /><meta property="og:url" content="https://en.zhgchg.li/posts/142244e5f07a/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-22T21:27:06+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg" /><meta property="twitter:title" content="Revealing a Clever Website Vulnerability Discovered Years Ago" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2023-08-06T00:45:45+08:00","datePublished":"2021-02-22T21:27:06+08:00","description":"Website security issues caused by multiple vulnerabilities combined","headline":"Revealing a Clever Website Vulnerability Discovered Years Ago","image":"https://en.zhgchg.li/assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/142244e5f07a/"},"url":"https://en.zhgchg.li/posts/142244e5f07a/"}</script><title>Revealing a Clever Website Vulnerability Discovered Years Ago | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Revealing a Clever Website Vulnerability Discovered Years Ago</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Revealing a Clever Website Vulnerability Discovered Years Ago</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1614000426" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 22, 2021 </em> </span> <span> Updated <em class="" data-ts="1691253945" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 5, 2023 </em> </span><div class="mt-3 mb-3"> <a href="/assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1084 words" > <em>6 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="revealing-a-clever-website-vulnerability-discovered-years-ago"><span class="me-2">Revealing a Clever Website Vulnerability Discovered Years Ago</span><a href="#revealing-a-clever-website-vulnerability-discovered-years-ago" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Website security issues caused by multiple vulnerabilities combined</p><p><a href="/assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg" class="popup img-link "><img data-src="/assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg" alt="Photo by [Tarik Haiga](https://unsplash.com/@tar1k?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p>Photo by <a href="https://unsplash.com/@tar1k?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">Tarik Haiga</a></p><h3 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A few years ago, while still supporting web development, I was assigned the task of organizing a CTF competition for the company’s internal engineering team. Initially, the idea was to have teams attack and defend each other’s products, but as the organizer, I wanted to first understand the level of expertise. So, I conducted penetration tests on various company products to see how many vulnerabilities I could find, ensuring the event would run smoothly.</p><blockquote><p><em>However, due to limited competition time and significant differences between engineering teams, the final questions were based on common engineering knowledge and interesting topics. Those interested can refer to my previous article, “ <a href="../729d7b6817a4/"><strong>How to Create an Interesting Engineering CTF Competition</strong></a> “, which contains many mind-blowing questions!</em></p></blockquote><h3 id="discovered-vulnerabilities"><span class="me-2">Discovered Vulnerabilities</span><a href="#discovered-vulnerabilities" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>I found a total of four vulnerabilities across three products. Besides the issue discussed in this article, I also discovered the following common website vulnerabilities:</p><ol><li><strong>Never Trust The Client!</strong> This is a basic issue where the frontend directly sends the ID to the backend, and the backend accepts it. This should be changed to token recognition.<li><strong>Password Reset Design Flaw</strong> I don’t remember the exact details, but there was a design flaw that allowed bypassing email verification during the password reset process.<li><strong>XSS Issue</strong><li><strong>The vulnerability discussed in this article</strong></ol><p>All vulnerabilities were found through black-box testing. Only the product with the XSS issue was one I had participated in developing; I had no prior knowledge of the others or their code.</p><h3 id="current-status-of-the-vulnerability"><span class="me-2">Current Status of the Vulnerability</span><a href="#current-status-of-the-vulnerability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As a white-hat hacker, I reported all discovered issues to the engineering team immediately, and they were fixed. It’s been two years now, and I think it’s time to disclose this. However, to respect my former company’s position, I won’t mention which product had this vulnerability. Just focus on the discovery process and reasons behind it!</p><h3 id="consequences-of-the-vulnerability"><span class="me-2">Consequences of the Vulnerability</span><a href="#consequences-of-the-vulnerability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This vulnerability allows an attacker to arbitrarily change the target user’s password, log in to the target user’s account with the new password, steal personal information, and perform illegal operations.</p><h3 id="main-cause-of-the-vulnerability"><span class="me-2">Main Cause of the Vulnerability</span><a href="#main-cause-of-the-vulnerability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As the title suggests, this vulnerability was triggered by a combination of multiple factors, including:</p><ul><li>Account login not supporting two-factor authentication or device binding<li>Password reset verification using a serial number<li>Decryption vulnerability in the website’s data encryption function<li>Misuse of encryption and decryption functions<li>Design flaws in the verification token<li>Backend not re-validating field correctness<li>User email being public information on the platform</ul><h3 id="reproducing-the-vulnerability"><span class="me-2">Reproducing the Vulnerability</span><a href="#reproducing-the-vulnerability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/142244e5f07a/1*ILb0VdnkAvgH5aW7qos_lg.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*ILb0VdnkAvgH5aW7qos_lg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Since user emails are public information on the platform, we first browse the platform to find the target account’s email. After knowing the email, go to the password reset page.</p><ul><li>First, enter your own email to initiate the password reset process.<li>Then, enter the email of the account you want to hack and initiate the password reset process again.</ul><p>Both actions will send out password reset verification emails.</p><p><a href="/assets/142244e5f07a/1*sPNp2NfoykG8-m3vWociQQ.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*sPNp2NfoykG8-m3vWociQQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Go to your email to receive your password reset verification email.</p><p><strong>The change password link has the following URL format:</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://zhgchg.li/resetPassword.php?auth=PvrrbQWBGDQ3LeSBByd
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">PvrrbQWBGDQ3LeSBByd</code> is the verification token for this password reset operation.</p><p>However, while observing the verification code image on the website, I noticed that the link format for the verification code image is also similar:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://zhgchg.li/captchaImage.php?auth=6EqfSZLqDc
</pre></table></code></div></div><p><a href="/assets/142244e5f07a/1*nfAhh3QasOLCDxdxH5jEQg.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*nfAhh3QasOLCDxdxH5jEQg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><code class="language-plaintext highlighter-rouge">6EqfSZLqDc</code> shows <code class="language-plaintext highlighter-rouge">5136</code>.</p><p>What happens if we put our password reset token in? Who cares! <strong>Let’s try it!</strong></p><p><a href="/assets/142244e5f07a/1*9BccKKQMxdqgtqlad13Ghg.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*9BccKKQMxdqgtqlad13Ghg.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote><p>Bingo!</p></blockquote><p>But the captcha image is too small to get complete information.</p><p><strong>Let’s keep looking for exploitable points…</strong></p><p>The website, to prevent web scraping, displays users’ public profile email addresses as <strong>images</strong>. Keyword: <strong>images! images! images!</strong></p><p>Let’s open it up and take a look:</p><p><a href="/assets/142244e5f07a/1*VLoCTluycBbW70QplV50Lw.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*VLoCTluycBbW70QplV50Lw.png" alt="Profile Page" class="lazyload" data-proofer-ignore></a></p><p>Profile Page</p><p><a href="/assets/142244e5f07a/1*cb0Rpz_Zuto5e6WTPsA_Tw.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*cb0Rpz_Zuto5e6WTPsA_Tw.png" alt="Part of the Webpage Source Code" class="lazyload" data-proofer-ignore></a></p><p>Part of the Webpage Source Code</p><p>We also got a similar URL format result:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://zhgchg.li/mailImage.php?mail=V3sDblZgDGdUOOBlBjpRblMTDGwMbwFmUT10bFN6DDlVbAVt
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">V3sDblZgDGdUOOBlBjpRblMTDGwMbwFmUT10bFN6DDlVbAVt</code> shows <code class="language-plaintext highlighter-rouge">zhgchgli@gmail.com</code></p><p><strong>Same thing, let’s stuff it in!</strong></p><p><a href="/assets/142244e5f07a/1*mQVMT-D8avyeYSYp5VBU8w.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*mQVMT-D8avyeYSYp5VBU8w.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote><p>Bingo!🥳🥳🥳</p></blockquote><blockquote><p><code class="language-plaintext highlighter-rouge">PvrrbQWBGDQ3LeSBByd</code> <em>= <code class="language-plaintext highlighter-rouge">2395656</code></em></p></blockquote><h4 id="after-reversing-the-password-reset-token-and-finding-out-its-a-number"><span class="me-2"><strong>After reversing the password reset token and finding out it’s a number</strong></span><a href="#after-reversing-the-password-reset-token-and-finding-out-its-a-number" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>I thought, could it be a serial number…</p><p>So I entered the email again to request a password reset, decoded the new token from the received email, and got <code class="language-plaintext highlighter-rouge">2395657</code>… what the fxck… it really is.</p><p>Knowing it’s a serial number makes things easier, so the initial operation was to request a password reset email for my account first, then request it for the target to be hacked; because we can already predict the next password request ID.</p><blockquote><p><strong><em>Next, we just need to find a way to convert <code class="language-plaintext highlighter-rouge">2395657</code> back to a token!</em></strong></p></blockquote><h4 id="coincidentally-we-found-another-issue"><span class="me-2">Coincidentally, we found another issue</span><a href="#coincidentally-we-found-another-issue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><strong><em>The website only validates the email format on the frontend when editing data, without re-validating the format on the backend…</em></strong></p></blockquote><p>Bypassing the frontend validation, we change the email to the next target.</p><p><a href="/assets/142244e5f07a/1*tdqRy5N0k8WS85l8u8CbKw.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*tdqRy5N0k8WS85l8u8CbKw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/142244e5f07a/1*PRTZJZuv7DG11CoUn5OHQg.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*PRTZJZuv7DG11CoUn5OHQg.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote><p>Fire in the hole!</p></blockquote><p><strong>We got:</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://zhgchg.li/mailImage.php?mail=UTVRZwZuDjMNPLZhBGI
</pre></table></code></div></div><p><strong>Now, take this password reset token back to the password reset page:</strong></p><p><a href="/assets/142244e5f07a/1*1kZp5LQ1yT6m7IBJLoYj9Q.png" class="popup img-link "><img data-src="/assets/142244e5f07a/1*1kZp5LQ1yT6m7IBJLoYj9Q.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote><p>Success! Bypassed verification to reset someone else’s password!</p></blockquote><p>Finally, because there is no two-factor authentication or device binding feature; once the password is overwritten, you can log in directly and impersonate the user.</p><h3 id="reason-for-the-incident"><span class="me-2">Reason for the Incident</span><a href="#reason-for-the-incident" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s review the whole process.</p><ul><li>Initially, we wanted to reset the password but found that the reset token was actually a serial number, not a truly unique identifier.<li>The website abused encryption and decryption functions without distinguishing their usage; almost the entire site used the same set.<li>The website had an online arbitrary encryption and decryption entry (equivalent to the key being compromised).<li>The backend did not re-validate user input.<li>There was no two-factor authentication or device binding feature.</ul><h4 id="fixes"><span class="me-2">Fixes</span><a href="#fixes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Fundamentally, the password reset token should be a randomly generated unique identifier.<li>The website’s encryption and decryption parts should use different keys for different functions.<li>Avoid allowing external arbitrary data encryption and decryption.<li>The backend should validate user input.<li>To be safe, add two-factor authentication and device binding features.</ul><h3 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The whole vulnerability discovery process surprised me because many issues were basic design problems; although the functionality seemed to work individually, and small holes seemed safe, combining multiple holes can create a big one. It’s really important to be cautious in development.</p><h3 id="further-reading"><span class="me-2">Further Reading</span><a href="#further-reading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="../729d7b6817a4/">How to Create an Interesting Engineering CTF Competition</a><li><a href="../46410aaada00/">The App Uses HTTPS, But Data Was Still Stolen</a><li><a href="../99a6cef90190/">Security Issues with SMS Verification Code for Password Recovery</a></ul><p>If you have any questions or comments, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/142244e5f07a/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/142244e5f07a" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/hacker/" class="post-tag no-text-decoration" >hacker</a> <a href="/tags/web-security/" class="post-tag no-text-decoration" >web-security</a> <a href="/tags/website-security-test/" class="post-tag no-text-decoration" >website-security-test</a> <a href="/tags/capture-the-flag/" class="post-tag no-text-decoration" >capture-the-flag</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Revealing%20a%20Clever%20Website%20Vulnerability%20Discovered%20Years%20Ago%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F142244e5f07a%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Revealing%20a%20Clever%20Website%20Vulnerability%20Discovered%20Years%20Ago%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F142244e5f07a%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F142244e5f07a%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/99a6cef90190/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1615737458" data-df="ll" > Mar 14, 2021 </em><h4 class="pt-0 my-2" data-toc-skip>Password Recovery SMS Verification Code Security Issue</h4><div class="text-muted small"><p> Password Recovery SMS Verification Code Security Issue Demonstrating the severity of brute force attacks using Python Photo by Matt Artz Introduction This article doesn’t contain much technica...</p></div></div></a></div><div class="col"> <a href="/posts/729d7b6817a4/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1563978754" data-df="ll" > Jul 24, 2019 </em><h4 class="pt-0 my-2" data-toc-skip>How to Create an Engaging Engineering CTF Competition</h4><div class="text-muted small"><p> How to Create an Engaging Engineering CTF Competition Building and brainstorming for Capture The Flag competitions About CTF Capture The Flag, abbreviated as CTF, is a game originating from the ...</p></div></div></a></div><div class="col"> <a href="/posts/e37d66ea1146/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539454069" data-df="ll" > Oct 14, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS UITextView Text Wrapping Editor (Swift)</h4><div class="text-muted small"><p> iOS UITextView Text Wrapping Editor (Swift) Practical Route Target Functionality: The app has a discussion area where users can post articles. The interface for posting articles needs to support...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/70a1409b149a/" class="btn btn-outline-primary" prompt="Older" ><p>Using Python+Google Cloud Platform+Line Bot to Automate Routine Tasks</p></a> <a href="/posts/d9a95d4224ea/" class="btn btn-outline-primary" prompt="Newer" ><p>Medium Custom Domain Feature Returns</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
