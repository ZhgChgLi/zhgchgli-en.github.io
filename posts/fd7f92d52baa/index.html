<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Handling Push Notification Permission Status from iOS 9 to iOS 12 (Swift)" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Solution for handling notification permission status and requesting permissions from iOS 9 to iOS 12" /><meta property="og:description" content="Solution for handling notification permission status and requesting permissions from iOS 9 to iOS 12" /><link rel="canonical" href="https://en.zhgchg.li/posts/fd7f92d52baa/" /><meta property="og:url" content="https://en.zhgchg.li/posts/fd7f92d52baa/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-11-02T23:23:44+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg" /><meta property="twitter:title" content="Handling Push Notification Permission Status from iOS 9 to iOS 12 (Swift)" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-04-13T15:25:31+08:00","datePublished":"2018-11-02T23:23:44+08:00","description":"Solution for handling notification permission status and requesting permissions from iOS 9 to iOS 12","headline":"Handling Push Notification Permission Status from iOS 9 to iOS 12 (Swift)","image":"https://en.zhgchg.li/assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/fd7f92d52baa/"},"url":"https://en.zhgchg.li/posts/fd7f92d52baa/"}</script><title>Handling Push Notification Permission Status from iOS 9 to iOS 12 (Swift) | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Handling Push Notification Permission Status from iOS 9 to iOS 12 (Swift)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Handling Push Notification Permission Status from iOS 9 to iOS 12 (Swift)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1541172224" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 2, 2018 </em> </span> <span> Updated <em class="" data-ts="1712993131" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1232 words" > <em>6 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="handling-push-notification-permission-status-from-ios-9-to-ios-12-swift"><span class="me-2">Handling Push Notification Permission Status from iOS 9 to iOS 12 (Swift)</span><a href="#handling-push-notification-permission-status-from-ios-9-to-ios-12-swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Solution for handling notification permission status and requesting permissions from iOS 9 to iOS 12</p><h3 id="what-to-do"><span class="me-2">What to do?</span><a href="#what-to-do" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Following the previous article “<a href="https://medium.com/@zhgchgli/%E4%BB%80%E9%BA%BC-ios-12-%E4%B8%8D%E9%9C%80%E4%BD%BF%E7%94%A8%E8%80%85%E6%8E%88%E6%AC%8A%E5%B0%B1%E8%83%BD%E6%94%B6%E5%88%B0%E6%8E%A8%E6%92%AD%E9%80%9A%E7%9F%A5-swift-ade9e745a4bf?fbclid=IwAR1AKi3io4Jt-rFFgrLWEFsmA0lKYVFUD7Dw9n9LpMa2zAzJCHeGGGgn9Vs" target="_blank">What? iOS 12 can send push notifications without user authorization (Swift)</a>” which mentioned the optimization of the push notification permission acquisition process, after the optimization written in the previous Murmur part, new requirements were encountered:</p><p><a href="/assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg" class="popup img-link "><img data-src="/assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg" alt="" class="lazyload" data-proofer-ignore></a></p><ol><li>If the user turns off the notification function, we can prompt them to go to settings to turn it on in a specific function page.<li>After jumping to the settings page, if there is an operation to turn on/off notifications, the app should be able to follow and change the status.<li>If the push notification permission has not been asked before, ask for permission; if it has been asked but not allowed, show a prompt; if it has been asked and allowed, continue to operate.<li>Support iOS 9 to iOS 12.</ol><p>Items 1 to 3 are fine, using the iOS 10 and later Framework UserNotifications can almost solve them properly. The troublesome part is item 4, which needs to support iOS 9. Handling iOS 9 using the old method registerUserNotificationSettings is not easy; let’s do it step by step!</p><h3 id="thought-process-and-structure"><span class="me-2">Thought Process and Structure:</span><a href="#thought-process-and-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, declare a global notificationStatus object to store the notification permission status and add property monitoring to the pages that need to handle it (here I use <a href="https://github.com/slazyk/Observable-Swift" target="_blank">Observable</a> to subscribe to property changes, you can find suitable KVO or use Rx, ReactiveCocoa).</p><p>In appDelegate, handle the check of push notification permission status and change the value of notificationStatus in didFinishLaunchingWithOptions (when the app initially opens), applicationDidBecomeActive (when returning from the background state), and didRegisterUserNotificationSettings (≤iOS 9 push notification inquiry handling).</p><p>The pages that need to handle it will trigger and perform corresponding processing (e.g., pop up a notification closed prompt).</p><h4 id="1-first-declare-the-global-notificationstatus-object"><span class="me-2">1. First, declare the global notificationStatus object</span><a href="#1-first-declare-the-global-notificationstatus-object" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="kt">NotificationStatusType</span> <span class="p">{</span>
     <span class="k">case</span> <span class="n">authorized</span>
     <span class="k">case</span> <span class="n">denied</span>
     <span class="k">case</span> <span class="n">notDetermined</span>
<span class="p">}</span>
<span class="k">var</span> <span class="nv">notificationStatus</span><span class="p">:</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="kt">NotificationStatusType</span><span class="p">?</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">Observable</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
</pre></table></code></div></div><p>The four states of notificationStatus/NotificationStatusType correspond to:</p><ul><li>nil = Object initialization…checking…<li>notDetermined = User has not been asked whether to receive notifications<li>authorized = User has been asked whether to receive notifications and clicked “Allow”<li>denied = User has been asked whether to receive notifications and clicked “Don’t Allow”</ul><h4 id="2-construct-the-method-to-check-the-notification-permission-status"><span class="me-2">2. Construct the method to check the notification permission status:</span><a href="#2-construct-the-method-to-check-the-notification-permission-status" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">checkNotificationPermissionStatus</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="kd">#available(iOS 10.0, *)</span> <span class="p">{</span>
        <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span><span class="o">.</span><span class="n">getNotificationSettings</span> <span class="p">{</span> <span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="k">in</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="c1">// Note! Switch back to the main thread</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">authorizationStatus</span> <span class="o">==</span> <span class="o">.</span><span class="n">authorized</span> <span class="p">{</span>
                    <span class="c1">// Allowed</span>
                    <span class="n">notificationStatus</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kt">NotificationStatusType</span><span class="o">.</span><span class="n">authorized</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">authorizationStatus</span> <span class="o">==</span> <span class="o">.</span><span class="n">denied</span> <span class="p">{</span>
                    <span class="c1">// Not allowed</span>
                    <span class="n">notificationStatus</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kt">NotificationStatusType</span><span class="o">.</span><span class="n">denied</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// Not asked</span>
                    <span class="n">notificationStatus</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kt">NotificationStatusType</span><span class="o">.</span><span class="n">notDetermined</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">currentUserNotificationSettings</span><span class="p">?</span><span class="o">.</span><span class="n">types</span> <span class="o">==</span> <span class="p">[]</span>  <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">iOS9NotificationIsDetermined</span> <span class="o">=</span> <span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"iOS9NotificationIsDetermined"</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">Bool</span><span class="p">,</span> <span class="n">iOS9NotificationIsDetermined</span> <span class="o">==</span> <span class="kc">true</span> <span class="p">{</span>
                <span class="c1">// Not asked</span>
                <span class="n">notificationStatus</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kt">NotificationStatusType</span><span class="o">.</span><span class="n">notDetermined</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// Not allowed</span>
                <span class="n">notificationStatus</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kt">NotificationStatusType</span><span class="o">.</span><span class="n">denied</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Allowed</span>
            <span class="n">notificationStatus</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kt">NotificationStatusType</span><span class="o">.</span><span class="n">authorized</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>That’s not all!</strong> Sharp-eyed friends should have noticed the custom UserDefaults “iOS9NotificationIsDetermined” in the ≤ iOS 9 judgment. What is it used for?</p><p>The main reason is that the method for detecting push notification permissions in ≤ iOS 9 can only use the current permissions as a judgment. If it is empty, it means no permission, but it will also be empty if the permission has not been asked. This is troublesome because it is unclear whether the user has never been asked or has denied the permission.</p><p>Here, I use a custom UserDefaults “iOS9NotificationIsDetermined” as a judgment switch and add it in the appDelegate’s didRegisterUserNotificationSettings:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">//appdelegate.swift:</span>
<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didRegister</span> <span class="nv">notificationSettings</span><span class="p">:</span> <span class="kt">UIUserNotificationSettings</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// For iOS 9 and below, this method is triggered after the permission prompt is shown and the user either allows or denies the notification.</span>
    <span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="s">"iOS9NotificationIsDetermined"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="nf">checkNotificationPermissionStatus</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>After constructing the object and method for checking notification permission status, we need to add the following in appDelegate…</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">//appdelegate.swift</span>
<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>  
  <span class="nf">checkNotificationPermissionStatus</span><span class="p">()</span>
  <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">applicationDidBecomeActive</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">checkNotificationPermissionStatus</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The app needs to check the push notification status both at launch and when returning from the background.</p><p>This covers the detection part. Next, let’s see how to handle the request for notification permissions if it has not been asked.</p><h4 id="3-request-notification-permission"><span class="me-2">3. Request Notification Permission:</span><a href="#3-request-notification-permission" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">requestNotificationPermission</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="kd">#available(iOS 10.0, *)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">permissions</span><span class="p">:</span> <span class="kt">UNAuthorizationOptions</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">badge</span><span class="p">,</span> <span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">]</span>
        <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span><span class="o">.</span><span class="nf">requestAuthorization</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="n">permissions</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">granted</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="nf">checkNotificationPermissionStatus</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">application</span><span class="o">.</span><span class="nf">registerUserNotificationSettings</span><span class="p">(</span><span class="kt">UIUserNotificationSettings</span><span class="p">(</span><span class="nv">types</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">badge</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">],</span> <span class="nv">categories</span><span class="p">:</span> <span class="kc">nil</span><span class="p">))</span>
        <span class="c1">// The didRegisterUserNotificationSettings in appdelegate.swift will handle the subsequent callback</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>After handling detection and requests, let’s see how to apply it.</p><h4 id="4-application-static"><span class="me-2">4. Application (Static)</span><a href="#4-application-static" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="n">notificationStatus</span><span class="mf">.</span><span class="n">value</span> <span class="o">==</span> <span class="nc">NotificationStatusType</span><span class="mf">.</span><span class="n">authorized</span> <span class="p">{</span>
    <span class="c1">// OK!</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">notificationStatus</span><span class="mf">.</span><span class="n">value</span> <span class="o">==</span> <span class="nc">NotificationStatusType</span><span class="mf">.</span><span class="n">denied</span> <span class="p">{</span>
    <span class="c1">// Not allowed</span>
    <span class="c1">// This example shows a UIAlertController prompt and redirects to the settings page upon clicking</span>
    <span class="n">let</span> <span class="n">alertController</span> <span class="o">=</span> <span class="nf">UIAlertController</span><span class="p">(</span>
        <span class="n">title</span><span class="o">:</span> <span class="s2">"Dear, you are currently unable to receive notifications"</span><span class="p">,</span>
        <span class="n">message</span><span class="o">:</span> <span class="s2">"Please enable notification permissions for the app."</span><span class="p">,</span>
        <span class="n">preferredStyle</span><span class="o">:</span> <span class="mf">.</span><span class="n">alert</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">settingAction</span> <span class="o">=</span> <span class="nf">UIAlertAction</span><span class="p">(</span>
        <span class="n">title</span><span class="o">:</span> <span class="s2">"Go to Settings"</span><span class="p">,</span>
        <span class="n">style</span><span class="o">:</span> <span class="mf">.</span><span class="n">destructive</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">:</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">action</span><span class="o">:</span> <span class="nc">UIAlertAction</span><span class="o">!</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Void</span> <span class="n">in</span>
            <span class="k">if</span> <span class="n">let</span> <span class="n">bundleID</span> <span class="o">=</span> <span class="nc">Bundle</span><span class="mf">.</span><span class="n">main</span><span class="mf">.</span><span class="n">bundleIdentifier</span><span class="p">,</span> <span class="n">let</span> <span class="n">url</span> <span class="o">=</span> <span class="nf">URL</span><span class="p">(</span><span class="n">string</span><span class="o">:</span> <span class="nc">UIApplicationOpenSettingsURLString</span> <span class="o">+</span> <span class="n">bundleID</span><span class="p">)</span> <span class="p">{</span>
                <span class="nc">UIApplication</span><span class="mf">.</span><span class="n">shared</span><span class="mf">.</span><span class="nf">openURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="p">}</span>
    <span class="p">})</span>
    <span class="n">let</span> <span class="n">okAction</span> <span class="o">=</span> <span class="nf">UIAlertAction</span><span class="p">(</span>
        <span class="n">title</span><span class="o">:</span> <span class="s2">"Cancel"</span><span class="p">,</span>
        <span class="n">style</span><span class="o">:</span> <span class="mf">.</span><span class="k">default</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">:</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">action</span><span class="o">:</span> <span class="nc">UIAlertAction</span><span class="o">!</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nc">Void</span> <span class="n">in</span>
            <span class="c1">// well....</span>
    <span class="p">})</span>
    <span class="n">alertController</span><span class="mf">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">okAction</span><span class="p">)</span>
    <span class="n">alertController</span><span class="mf">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">settingAction</span><span class="p">)</span>
    <span class="k">self</span><span class="mf">.</span><span class="nf">present</span><span class="p">(</span><span class="n">alertController</span><span class="p">,</span> <span class="n">animated</span><span class="o">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">notificationStatus</span><span class="mf">.</span><span class="n">value</span> <span class="o">==</span> <span class="nc">NotificationStatusType</span><span class="mf">.</span><span class="n">notDetermined</span> <span class="p">{</span>
    <span class="c1">// Not asked</span>
    <span class="nf">requestNotificationPermission</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><strong>Note!! When jumping to the “Settings” page of the APP, do not use</strong></p></blockquote><blockquote><p>UIApplication.shared.openURL(URL(string:”App-Prefs:root=\ (bundleID)”) )</p></blockquote><blockquote><p>method to jump, <strong>it will be rejected! It will be rejected! It will be rejected! (personal experience)</strong></p></blockquote><blockquote><p>This is a Private API</p></blockquote><h4 id="5-application-dynamic"><span class="me-2">5. Application (Dynamic)</span><a href="#5-application-dynamic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>For dynamically changing the status, since we use the Observable object for notificationStatus, we can add a listener in viewDidLoad where we need to monitor the status in real-time:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
   <span class="n">notificationStatus</span><span class="o">.</span><span class="n">afterChange</span> <span class="o">+=</span> <span class="p">{</span> <span class="n">oldStatus</span><span class="p">,</span><span class="n">newStatus</span> <span class="k">in</span>
      <span class="k">if</span> <span class="n">newStatus</span> <span class="o">==</span> <span class="kt">NotificationStatusType</span><span class="o">.</span><span class="n">authorized</span> <span class="p">{</span>
       <span class="c1">//print("❤️Thank you for enabling notifications") </span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">newStatus</span> <span class="o">==</span> <span class="kt">NotificationStatusType</span><span class="o">.</span><span class="n">denied</span> <span class="p">{</span>
       <span class="c1">//print("😭Oh no")</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>The above is just sample code. You can adjust the actual application and triggers as needed.</p></blockquote><blockquote><p><strong>*When using Observable for notificationStatus, please pay attention to memory management. It should be released when necessary (to prevent memory leaks) and retained when not (to avoid listener failure).</strong></p></blockquote><h3 id="finally-here-is-the-complete-demo-product"><span class="me-2">Finally, here is the complete demo product:</span><a href="#finally-here-is-the-complete-demo-product" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/fd7f92d52baa/1*_iVzlJLNQ7f0hO7IWxg1Zg.gif" class="popup img-link "><img data-src="/assets/fd7f92d52baa/1*_iVzlJLNQ7f0hO7IWxg1Zg.gif" alt="[Wedding App](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&amp;mt=8){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p><a href="https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&amp;mt=8" target="_blank">Wedding App</a></p><p><em>*Since our project supports iOS 9 to iOS 12, iOS 8 has not been tested and the support level is uncertain.</em></p><p>If you have any questions or comments, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/fd7f92d52baa/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/fd7f92d52baa" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/push-notification/" class="post-tag no-text-decoration" >push-notification</a> <a href="/tags/observables/" class="post-tag no-text-decoration" >observables</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Handling%20Push%20Notification%20Permission%20Status%20from%20iOS%209%20to%20iOS%2012%20(Swift)%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Ffd7f92d52baa%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Handling%20Push%20Notification%20Permission%20Status%20from%20iOS%209%20to%20iOS%2012%20(Swift)%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Ffd7f92d52baa%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Ffd7f92d52baa%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/cb6eba52a342/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539618241" data-df="ll" > Oct 15, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS ≥ 10 Notification Service Extension Application (Swift)</h4><div class="text-muted small"><p> iOS ≥ 10 Notification Service Extension Application (Swift) Image push notifications, push notification display statistics, pre-processing before push notification display Regarding the basics of...</p></div></div></a></div><div class="col"> <a href="/posts/ade9e745a4bf/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1541086502" data-df="ll" > Nov 1, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>What? iOS 12 Can Receive Push Notifications Without User Authorization (Swift)</h4><div class="text-muted small"><p> What? iOS 12 Can Send Push Notifications Without User Authorization (Swift) — (Updated 2019-02-06) Introduction to UserNotifications Provisional Authorization and iOS 12 Silent Notifications MurM...</p></div></div></a></div><div class="col"> <a href="/posts/f644db1bb8bf/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1542033522" data-df="ll" > Nov 12, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>Add 'App Notification Settings Page' Shortcut in User's 'Settings' on iOS ≥ 12 (Swift)</h4><div class="text-muted small"><p> Add ‘App Notification Settings Page’ Shortcut in User’s ‘Settings’ on iOS ≥ 12 (Swift) Besides turning off notifications from the system, give users other options Following the previous three art...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ade9e745a4bf/" class="btn btn-outline-primary" prompt="Older" ><p>What? iOS 12 Can Receive Push Notifications Without User Authorization (Swift)</p></a> <a href="/posts/8d863bcd1c55/" class="btn btn-outline-primary" prompt="Newer" ><p>Always Keep the Enthusiasm for Exploring New Things</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
