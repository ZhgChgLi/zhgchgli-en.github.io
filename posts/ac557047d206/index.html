<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Identify Your Own Calls (Swift)" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="iOS DIY Whoscall Call Identification and Phone Number Tagging Features" /><meta property="og:description" content="iOS DIY Whoscall Call Identification and Phone Number Tagging Features" /><link rel="canonical" href="https://en.zhgchg.li/posts/ac557047d206/" /><meta property="og:url" content="https://en.zhgchg.li/posts/ac557047d206/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-04-28T00:07:27+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg" /><meta property="twitter:title" content="Identify Your Own Calls (Swift)" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-04-13T15:40:07+08:00","datePublished":"2019-04-28T00:07:27+08:00","description":"iOS DIY Whoscall Call Identification and Phone Number Tagging Features","headline":"Identify Your Own Calls (Swift)","image":"https://en.zhgchg.li/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/ac557047d206/"},"url":"https://en.zhgchg.li/posts/ac557047d206/"}</script><title>Identify Your Own Calls (Swift) | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Identify Your Own Calls (Swift)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Identify Your Own Calls (Swift)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1556381247" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 28, 2019 </em> </span> <span> Updated <em class="" data-ts="1712994007" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2063 words" > <em>11 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="identify-your-own-calls-swift"><span class="me-2">Identify Your Own Calls (Swift)</span><a href="#identify-your-own-calls-swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS DIY Whoscall Call Identification and Phone Number Tagging Features</p><h4 id="origin"><span class="me-2">Origin</span><a href="#origin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>I have always been a loyal user of Whoscall. I used it when I originally had an Android phone, and it could display unknown caller information very promptly, allowing me to decide whether to answer the call immediately. Later, I switched to the Apple camp, and my first Apple phone was the iPhone 6 (iOS 9). At that time, using Whoscall was very awkward; it couldn’t identify calls in real-time, and I had to copy the phone number to the app for inquiry. Later, Whoscall provided a service to install the unknown phone number database locally on the phone, which solved the real-time identification problem but easily messed up my phone contacts!</p><p>Until iOS 10+ when Apple opened the call identification feature (Call Directory Extension) permissions to developers, Whoscall’s experience at least matched the Android version, if not surpassed it (the Android version has a lot of ads, but from a developer’s standpoint, it’s understandable).</p><h4 id="purpose"><span class="me-2">Purpose?</span><a href="#purpose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://developer.apple.com/documentation/callkit/cxcalldirectoryextensioncontext" target="_blank">Call Directory Extension</a> can do what?</p><ol><li>Phone <strong>outgoing</strong> call identification and tagging<li>Phone <strong>incoming</strong> call identification and tagging<li><strong>Call history</strong> identification and tagging<li>Phone <strong>blocking</strong> blacklist setup</ol><h4 id="limitations"><span class="me-2">Limitations?</span><a href="#limitations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>Users need to manually go to “Settings” -&gt; “Phone” -&gt; “Call Blocking &amp; Identification” to enable your app.<li>Can only identify calls using an offline database (cannot obtain incoming call information in real-time and then call an API for inquiry, can only pre-write number &lt;-&gt; name mappings in the phone database). <em>*Therefore, Whoscall periodically pushes notifications asking users to open the app to update the call identification database.</em><li>Quantity limit? No data found so far, it should depend on the user’s phone capacity with no special limit; however, a large number of identification lists and blocking lists need to be processed in batches!<li>Software limitation: iOS version must be ≥ 10</ol><p><a href="/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg" class="popup img-link "><img data-src="/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg" alt="“Settings” -&gt; “Phone” -&gt; “Call Blocking &amp; Identification”" class="lazyload" data-proofer-ignore></a></p><p>“Settings” -&gt; “Phone” -&gt; “Call Blocking &amp; Identification”</p><h4 id="application-scenarios"><span class="me-2">Application Scenarios?</span><a href="#application-scenarios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>Communication software, office communication software; in the app, you may have the contact of the other party but have not actually added the phone number to the phone contacts. This feature can avoid missing calls from colleagues or even the boss by treating them as unknown calls.<li>Our site (<a href="https://www.marry.com.tw" target="_blank">Marry</a>) or our private (<a href="https://www.591.com.tw/" target="_blank">591 Real Estate</a>), when users contact stores or landlords, the calls are made through our transfer numbers, routed through the transfer center to the target phone. The general process is as follows:</ol><p><a href="/assets/ac557047d206/1*BXrzNfimPVPCQ0_XsY5HRg.png" class="popup img-link "><img data-src="/assets/ac557047d206/1*BXrzNfimPVPCQ0_XsY5HRg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>The calls made by users are all representative numbers of the transfer center (#extension), and they will not know the real phone number; on one hand, it protects personal privacy, and on the other hand, it allows us to know how many people contacted the store (evaluate effectiveness) and even know where they saw it before calling (e.g., webpage shows #1234, app shows #5678). It also allows us to offer free services by absorbing the phone communication costs.</p><p>However, this approach brings an unavoidable problem: messy phone numbers. It is impossible to identify who the call is for or when the store calls back, the user does not know who the caller is. Using the call identification feature can greatly solve this problem and improve the user experience!</p><h4 id="heres-a-finished-product-screenshot"><span class="me-2">Here’s a finished product screenshot:</span><a href="#heres-a-finished-product-screenshot" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/ac557047d206/1*WEUjz38cymEtywWDvm86vg.jpeg" class="popup img-link "><img data-src="/assets/ac557047d206/1*WEUjz38cymEtywWDvm86vg.jpeg" alt="[Marry APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329?mt=8){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p><a href="https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329?mt=8" target="_blank">結婚吧 APP</a></p><p>You can see that when entering the phone number, the recognition result can be directly displayed during the call, and the call history list is no longer messy and can display the recognition result at the bottom.</p><h3 id="call-directory-extension-call-recognition-function-workflow"><span class="me-2">Call Directory Extension Call Recognition Function Workflow:</span><a href="#call-directory-extension-call-recognition-function-workflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/ac557047d206/1*f0vCDqocPfZkoPJW7w3vBg.png" class="popup img-link "><img data-src="/assets/ac557047d206/1*f0vCDqocPfZkoPJW7w3vBg.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="lets-get-started"><span class="me-2">Let’s Get Started:</span><a href="#lets-get-started" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s start working!</p><h4 id="1-add-call-directory-extension-to-the-ios-project"><span class="me-2">1. Add Call Directory Extension to the iOS project</span><a href="#1-add-call-directory-extension-to-the-ios-project" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/ac557047d206/1*k7RnXKeXW2uZPawkYQfIDg.png" class="popup img-link "><img data-src="/assets/ac557047d206/1*k7RnXKeXW2uZPawkYQfIDg.png" alt="Xcode -&gt; File -&gt; New -&gt; Target" class="lazyload" data-proofer-ignore></a></p><p>Xcode -&gt; File -&gt; New -&gt; Target</p><p><a href="/assets/ac557047d206/1*w5sK8DfqYOTUTPDJVYFyLg.png" class="popup img-link "><img data-src="/assets/ac557047d206/1*w5sK8DfqYOTUTPDJVYFyLg.png" alt="Select Call Directory Extension" class="lazyload" data-proofer-ignore></a></p><p>Select Call Directory Extension</p><p><a href="/assets/ac557047d206/1*EqazaGGWvgLSQa0gQMYF7Q.png" class="popup img-link "><img data-src="/assets/ac557047d206/1*EqazaGGWvgLSQa0gQMYF7Q.png" alt="Enter Extension Name" class="lazyload" data-proofer-ignore></a></p><p>Enter Extension Name</p><p><a href="/assets/ac557047d206/1*WklbrBGAppM2leAsCuuKLg.png" class="popup img-link "><img data-src="/assets/ac557047d206/1*WklbrBGAppM2leAsCuuKLg.png" alt="Optionally add Scheme for easier Debugging" class="lazyload" data-proofer-ignore></a></p><p>Optionally add Scheme for easier Debugging</p><p><a href="/assets/ac557047d206/1*8SfvjnXa2be6C8mdLk3Wwg.png" class="popup img-link "><img data-src="/assets/ac557047d206/1*8SfvjnXa2be6C8mdLk3Wwg.png" alt="A folder and program for Call Directory Extension will appear under the directory" class="lazyload" data-proofer-ignore></a></p><p>A folder and program for Call Directory Extension will appear under the directory</p><h4 id="2-start-writing-call-directory-extension-related-programs"><span class="me-2">2. Start Writing Call Directory Extension Related Programs</span><a href="#2-start-writing-call-directory-extension-related-programs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>First, return to the main iOS project</p><p><strong>The first question is how do we determine if the user’s device supports Call Directory Extension or if the “Call Blocking &amp; Identification” in the settings is turned on:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">CallKit</span>
<span class="c1">//</span>
<span class="c1">//......</span>
<span class="c1">//</span>
<span class="k">if</span> <span class="kd">#available(iOS 10.0, *)</span> <span class="p">{</span>
    <span class="kt">CXCallDirectoryManager</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="nf">getEnabledStatusForExtension</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="s">"Enter the bundle identifier of the call directory extension here"</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">.</span><span class="n">enabled</span> <span class="p">{</span>
          <span class="c1">//Enabled</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">.</span><span class="n">disabled</span> <span class="p">{</span>
          <span class="c1">//Disabled</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">//Unknown, not supported</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>As mentioned earlier, the way call recognition works is to maintain a local recognition database; so how do we achieve this function?</strong></p><p>Unfortunately, you cannot directly call and write data to the Call Directory Extension, so you need to maintain an additional corresponding structure, and then the Call Directory Extension will read your structure and write it into the recognition database. The process is as follows:</p><p><a href="/assets/ac557047d206/1*Fn8KAsdfolQ7ADigii9aHA.png" class="popup img-link "><img data-src="/assets/ac557047d206/1*Fn8KAsdfolQ7ADigii9aHA.png" alt="This means we need to maintain our own database file, and then let the Extension read and write it into the phone" class="lazyload" data-proofer-ignore></a></p><p>This means we need to maintain our own database file, and then let the Extension read and write it into the phone</p><p><strong>So what should the recognition data/file look like?</strong></p><blockquote><p>It is actually a Dictionary structure, such as: [“Phone”:”Wang Da Ming”]</p></blockquote><blockquote><p>The local file can use some Local DB (but the Extension must also be able to install and use it). Here, a .json file is directly stored on the phone; <strong>It is not recommended to store it directly in UserDefaults. If it is for testing or very little data, it is okay, but it is strongly not recommended for actual applications!</strong></p></blockquote><p><strong>Okay, let’s start:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="kd">#available(iOS 10.0, *)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">dir</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">containerURL</span><span class="p">(</span><span class="nv">forSecurityApplicationGroupIdentifier</span><span class="p">:</span> <span class="s">"Your cross-Extension, Group Identifier name"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"phoneIdentity.json"</span><span class="p">)</span>
        <span class="k">var</span> <span class="nv">datas</span><span class="p">:[</span><span class="kt">String</span><span class="p">:</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"8869190001234"</span><span class="p">:</span><span class="s">"Mr. Li"</span><span class="p">,</span><span class="s">"886912002456"</span><span class="p">:</span><span class="s">"Handsome"</span><span class="p">]</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span><span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span><span class="k">let</span> <span class="nv">json2</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">mutableContainers</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">Dictionary</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span><span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="n">json2</span> <span class="p">{</span>
            <span class="n">datas</span> <span class="o">=</span> <span class="n">json</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="nf">jsonToData</span><span class="p">(</span><span class="nv">jsonDic</span><span class="p">:</span> <span class="n">datas</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"phoneIdentity"</span><span class="p">)</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">data</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">//Writing json file completed</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Just general local file maintenance, note that the directory needs to be readable by the Extension as well.</p><h4 id="supplement--phone-number-format"><span class="me-2">Supplement — Phone Number Format:</span><a href="#supplement--phone-number-format" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>For landline and mobile numbers in Taiwan, remove the 0 and replace it with 886: e.g., 0255667788 -&gt; 886255667788<li>The phone number format should be a string of pure numbers, do not mix in symbols like “-“, “,”, “#”, etc.<li>If the landline phone number includes an extension, append it directly without any symbols: e.g., 0255667788,0718 -&gt; 8862556677880718<li>To convert the general iOS phone format into a format recognizable by the database, you can refer to the following two replacement methods:</ol><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">newNumber</span> <span class="o">=</span> <span class="s">"0255667788,0718"</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="s">"^0{1}"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">newNumber</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="nf">stringByReplacingMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">newNumber</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="n">newNumber</span><span class="o">.</span><span class="n">count</span><span class="p">),</span> <span class="nv">withTemplate</span><span class="p">:</span> <span class="s">"886"</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="s">","</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">newNumber</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="nf">stringByReplacingMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">newNumber</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="n">newNumber</span><span class="o">.</span><span class="n">count</span><span class="p">),</span> <span class="nv">withTemplate</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Next, as per the process, once the identification data is maintained, you need to notify the Call Directory Extension to refresh the data on the phone:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="kd">#available(iOS 10.0, *)</span> <span class="p">{</span>
    <span class="kt">CXCallDirectoryManager</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="nf">reloadExtension</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="s">"tw.com.marry.MarryiOS.CallDirectory"</span><span class="p">)</span> <span class="p">{</span> <span class="n">errorOrNil</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">errorOrNil</span> <span class="k">as?</span> <span class="kt">CXErrorCodeCallDirectoryManagerError</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"reload failed"</span><span class="p">)</span>
            
            <span class="k">switch</span> <span class="n">error</span><span class="o">.</span><span class="n">code</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">unknown</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is unknown"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">noExtensionFound</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is noExtensionFound"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">loadingInterrupted</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is loadingInterrupted"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">entriesOutOfOrder</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is entriesOutOfOrder"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">duplicateEntries</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is duplicateEntries"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">maximumEntriesExceeded</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"maximumEntriesExceeded"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">extensionDisabled</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"extensionDisabled"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">currentlyLoading</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"currentlyLoading"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">unexpectedIncrementalRemoval</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"unexpectedIncrementalRemoval"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">errorOrNil</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"reload error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"reload succeeded"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Use the above method to notify the Extension to refresh and obtain the execution result. (At this time, the beginRequest in the Call Directory Extension will be called, please continue reading)</p><p>The main iOS project code ends here!</p><h4 id="3-start-modifying-the-call-directory-extension-code"><span class="me-2">3. Start modifying the Call Directory Extension code</span><a href="#3-start-modifying-the-call-directory-extension-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Open the Call Directory Extension directory and find the file CallDirectoryHandler.swift that has been created for you.</p><p>The only method that can be implemented is <strong>beginRequest</strong> for handling actions when processing phone data. The default examples are already set up for us, so there’s not much need to change them:</p><ol><li><strong>addAllBlockingPhoneNumbers</strong>: Handles adding blacklist numbers (all at once)<li><strong>addOrRemoveIncrementalBlockingPhoneNumbers</strong>: Handles adding blacklist numbers (incrementally)<li><strong>addAllIdentificationPhoneNumbers</strong>: Handles adding caller identification numbers (all at once)<li><strong>addOrRemoveIncrementalIdentificationPhoneNumbers</strong>: Handles adding caller identification numbers (incrementally)</ol><p>We just need to complete the implementation of the above functions. The principles for blacklist functionality and caller identification are the same, so they won’t be introduced in detail here.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">func</span> <span class="nf">fetchAll</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">CXCallDirectoryExtensionContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">dir</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">containerURL</span><span class="p">(</span><span class="nv">forSecurityApplicationGroupIdentifier</span><span class="p">:</span> <span class="s">"Your App Group Identifier"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"phoneIdentity.json"</span><span class="p">)</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span> <span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span> <span class="k">let</span> <span class="nv">numbers</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">mutableContainers</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">Dictionary</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="n">numbers</span><span class="p">?</span><span class="o">.</span><span class="nf">sorted</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="kt">Int</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="p">??</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="kt">Int</span><span class="p">(</span><span class="nv">$1</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="p">??</span> <span class="mi">0</span> <span class="p">})</span><span class="o">.</span><span class="nf">forEach</span><span class="p">({</span> <span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="kt">CXCallDirectoryPhoneNumber</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">autoreleasepool</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">isIncremental</span> <span class="p">{</span>
                            <span class="n">context</span><span class="o">.</span><span class="nf">removeIdentificationEntry</span><span class="p">(</span><span class="nv">withPhoneNumber</span><span class="p">:</span> <span class="n">number</span><span class="p">)</span>
                        <span class="p">}</span>
                        <span class="n">context</span><span class="o">.</span><span class="nf">addIdentificationEntry</span><span class="p">(</span><span class="nv">withNextSequentialPhoneNumber</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span> <span class="nv">label</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">func</span> <span class="nf">addAllIdentificationPhoneNumbers</span><span class="p">(</span><span class="n">to</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">CXCallDirectoryExtensionContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Retrieve phone numbers to identify and their identification labels from data store. For optimal performance and memory usage when there are many phone numbers,</span>
    <span class="c1">// consider only loading a subset of numbers at a given time and using autorelease pool(s) to release objects allocated during each batch of numbers which are loaded.</span>
    <span class="c1">//</span>
    <span class="c1">// Numbers must be provided in numerically ascending order.</span>
    <span class="c1">//        let allPhoneNumbers: [CXCallDirectoryPhoneNumber] = [ 1_877_555_5555, 1_888_555_5555 ]</span>
    <span class="c1">//        let labels = [ "Telemarketer", "Local business" ]</span>
    <span class="c1">//</span>
    <span class="c1">//        for (phoneNumber, label) in zip(allPhoneNumbers, labels) {</span>
    <span class="c1">//            context.addIdentificationEntry(withNextSequentialPhoneNumber: phoneNumber, label: label)</span>
    <span class="c1">//        }</span>
    <span class="nf">fetchAll</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">func</span> <span class="nf">addOrRemoveIncrementalIdentificationPhoneNumbers</span><span class="p">(</span><span class="n">to</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">CXCallDirectoryExtensionContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Retrieve any changes to the set of phone numbers to identify (and their identification labels) from data store. For optimal performance and memory usage when there are many phone numbers,</span>
    <span class="c1">// consider only loading a subset of numbers at a given time and using autorelease pool(s) to release objects allocated during each batch of numbers which are loaded.</span>
    <span class="c1">//        let phoneNumbersToAdd: [CXCallDirectoryPhoneNumber] = [ 1_408_555_5678 ]</span>
    <span class="c1">//        let labelsToAdd = [ "New local business" ]</span>
    <span class="c1">//</span>
    <span class="c1">//        for (phoneNumber, label) in zip(phoneNumbersToAdd, labelsToAdd) {</span>
    <span class="c1">//            context.addIdentificationEntry(withNextSequentialPhoneNumber: phoneNumber, label: label)</span>
    <span class="c1">//        }</span>
    <span class="c1">//</span>
    <span class="c1">//        let phoneNumbersToRemove: [CXCallDirectoryPhoneNumber] = [ 1_888_555_5555 ]</span>
    <span class="c1">//</span>
    <span class="c1">//        for phoneNumber in phoneNumbersToRemove {</span>
    <span class="c1">//            context.removeIdentificationEntry(withPhoneNumber: phoneNumber)</span>
    <span class="c1">//        }</span>
    
    <span class="c1">//context.removeIdentificationEntry(withPhoneNumber: CXCallDirectoryPhoneNumber("886277283610")!)</span>
    <span class="c1">//context.addIdentificationEntry(withNextSequentialPhoneNumber: CXCallDirectoryPhoneNumber("886277283610")!, label: "TEST")</span>
    
    <span class="nf">fetchAll</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
    <span class="c1">// Record the most-recently loaded set of identification entries in data store for the next incremental load...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Because the data on my site is not too much and my local data structure is quite simple, it is not possible to do incremental updates; therefore, <strong>we will use the method of completely adding new data. If using the incremental method, you must delete the old data first (this step is very important, otherwise reloading the extension will fail!).</strong></p><h4 id="done"><span class="me-2">Done!</span><a href="#done" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>That’s it! The implementation is very simple!</p><h3 id="tips"><span class="me-2">Tips:</span><a href="#tips" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>If the app keeps spinning when you open it in “Settings” &gt; “Phone” &gt; “Call Blocking &amp; Identification” or if it cannot recognize numbers after opening, first check if the number is correct, if the local maintained .json data is correct, and if the extension reload was successful; or try rebooting. If you still can’t figure it out, you can select the Scheme Build of the call directory extension to see the error message.<li>The <strong>most difficult part of this feature is not the programming aspect but guiding the user to manually set it up and turn it on</strong>. For specific methods and guidance, you can refer to Whoscall:</ol><p><a href="/assets/ac557047d206/1*L0EKptoSnE88lB8uEN7H3A.jpeg" class="popup img-link "><img data-src="/assets/ac557047d206/1*L0EKptoSnE88lB8uEN7H3A.jpeg" alt="[Whoscall](https://whoscall.com/zh-TW/){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p><a href="https://whoscall.com/zh-TW/" target="_blank">Whoscall</a></p><p>If you have any questions or comments, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/ac557047d206/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/ac557047d206" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/whoscall/" class="post-tag no-text-decoration" >whoscall</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/ios-apps/" class="post-tag no-text-decoration" >ios-apps</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Identify%20Your%20Own%20Calls%20(Swift)%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Fac557047d206%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Identify%20Your%20Own%20Calls%20(Swift)%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Fac557047d206%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2Fac557047d206%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/e37d66ea1146/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539454069" data-df="ll" > Oct 14, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS UITextView Text Wrapping Editor (Swift)</h4><div class="text-muted small"><p> iOS UITextView Text Wrapping Editor (Swift) Practical Route Target Functionality: The app has a discussion area where users can post articles. The interface for posting articles needs to support...</p></div></div></a></div><div class="col"> <a href="/posts/cb6eba52a342/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539618241" data-df="ll" > Oct 15, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS ≥ 10 Notification Service Extension Application (Swift)</h4><div class="text-muted small"><p> iOS ≥ 10 Notification Service Extension Application (Swift) Image push notifications, push notification display statistics, pre-processing before push notification display Regarding the basics of...</p></div></div></a></div><div class="col"> <a href="/posts/9a9aa892f9a9/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539705684" data-df="ll" > Oct 17, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift)</h4><div class="text-muted small"><p> Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift) Practical Application of Vision [2024/08/13 Update] Refer to the new article and API: “iOS Vision framewor...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/6012b7b4f612/" class="btn btn-outline-primary" prompt="Older" ><p>iOS tintAdjustmentMode Property</p></a> <a href="/posts/c5e7e580c341/" class="btn btn-outline-primary" prompt="Newer" ><p>Perfect Implementation of One-Time Offers or Trials in iOS (Swift)</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
