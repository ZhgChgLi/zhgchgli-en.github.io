<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift)" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Practical Application of Vision" /><meta property="og:description" content="Practical Application of Vision" /><link rel="canonical" href="https://en.zhgchg.li/posts/9a9aa892f9a9/" /><meta property="og:url" content="https://en.zhgchg.li/posts/9a9aa892f9a9/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-10-17T00:01:24+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.png" /><meta property="twitter:title" content="Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift)" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-08-13T16:17:24+08:00","datePublished":"2018-10-17T00:01:24+08:00","description":"Practical Application of Vision","headline":"Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift)","image":"https://en.zhgchg.li/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/9a9aa892f9a9/"},"url":"https://en.zhgchg.li/posts/9a9aa892f9a9/"}</script><title>Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift) | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1539705684" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 17, 2018 </em> </span> <span> Updated <em class="" data-ts="1723537044" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 13, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.png" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1178 words" > <em>6 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="exploring-visionautomatic-face-detection-and-cropping-for-profile-pictures-swift"><span class="me-2">Exploring Vision — Automatic Face Detection and Cropping for Profile Pictures (Swift)</span><a href="#exploring-visionautomatic-face-detection-and-cropping-for-profile-pictures-swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Practical Application of Vision</p><h3 id="20240813-update"><span class="me-2">[2024/08/13 Update]</span><a href="#20240813-update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Refer to the new article and API: “<a href="../755509180ca8/">iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</a>”</ul><h4 id="without-further-ado-here-is-a-comparison-image"><span class="me-2">Without further ado, here is a comparison image:</span><a href="#without-further-ado-here-is-a-comparison-image" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.png" class="popup img-link "><img data-src="/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.png" alt="Before Optimization V.S. After Optimization — [Marry Me APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&amp;mt=8){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p>Before Optimization V.S. After Optimization — <a href="https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&amp;mt=8" target="_blank">Marry Me APP</a></p><p>With the recent iOS 12 update, I noticed the new CoreML machine learning framework and found it quite interesting. I began to think about how to incorporate it into our current products.</p><blockquote><p><strong>The article on trying out CoreML is now available: <a href="../793bf2cdda0f/">Automatically Predict Article Categories Using Machine Learning, Even Train the Model Yourself</a></strong></p></blockquote><p>CoreML provides the ability to train and reference machine learning models for text and images in an app. Initially, I thought of using CoreML for face recognition to address the issue of cropping heads or faces in the app, as shown on the left in the image above. Faces can easily be cut off due to scaling and cropping if they appear at the edges.</p><p>After some online research, I realized my knowledge was limited, and this functionality was already available in iOS 11 through the “Vision” framework, which supports text detection, face detection, image comparison, QR code detection, object tracking, and more.</p><p>In this case, I utilized the face detection feature from Vision and optimized it as shown on the right in the image; finding faces and cropping around them.</p><h3 id="lets-get-started-with-the-practical-implementation"><span class="me-2">Let’s get started with the practical implementation:</span><a href="#lets-get-started-with-the-practical-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="first-lets-create-a-feature-that-can-mark-the-position-of-faces-and-get-familiar-with-how-to-use-vision"><span class="me-2">First, let’s create a feature that can mark the position of faces and get familiar with how to use Vision.</span><a href="#first-lets-create-a-feature-that-can-mark-the-position-of-faces-and-get-familiar-with-how-to-use-vision" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/9a9aa892f9a9/1*cpGgpXsBhuiJoZI03WAGUw.png" class="popup img-link "><img data-src="/assets/9a9aa892f9a9/1*cpGgpXsBhuiJoZI03WAGUw.png" alt="Demo APP" class="lazyload" data-proofer-ignore></a></p><p>Demo APP</p><p>As shown in the completed image above, it can mark the positions of faces in the photo.</p><p>P.S. It can only mark “faces,” not the entire head including hair 😅</p><p>This program mainly consists of two parts. The first part addresses the issue of white space when resizing the original image to fit into an ImageView. In simple terms, we want the ImageView size to match the image size. Directly inserting the image can cause misalignment as shown below.</p><p><a href="/assets/9a9aa892f9a9/1*Mb70Ed6pALO-8sllCpb7Qg.png" class="popup img-link "><img data-src="/assets/9a9aa892f9a9/1*Mb70Ed6pALO-8sllCpb7Qg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>You might consider changing the ContentMode to fill, fit, or redraw, but this may cause distortion or cropping of the image.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">ratio</span> <span class="o">=</span> <span class="kt">UIScreen</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span>
<span class="c1">// Here, I set the alignment of my UIImageView to 0 on both sides, with an aspect ratio of 1:1</span>

<span class="k">let</span> <span class="nv">sourceImage</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"Demo2"</span><span class="p">)?</span><span class="o">.</span><span class="n">kf</span><span class="o">.</span><span class="nf">resize</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGSize</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">ratio</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="kt">CGFloat</span><span class="o">.</span><span class="n">leastNonzeroMagnitude</span><span class="p">),</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">aspectFill</span><span class="p">)</span>
<span class="c1">// Using KingFisher's image resizing feature, based on width, with flexible height</span>

<span class="n">imageView</span><span class="o">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="o">.</span><span class="n">redraw</span>
<span class="c1">// Using redraw to fill the contentMode</span>

<span class="n">imageView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">sourceImage</span>
<span class="c1">// Assigning the image</span>

<span class="n">imageViewConstraints</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">-</span> <span class="p">(</span><span class="n">sourceImage</span><span class="p">?</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="p">??</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">imageView</span><span class="o">.</span><span class="nf">layoutIfNeeded</span><span class="p">()</span>
<span class="n">imageView</span><span class="o">.</span><span class="nf">sizeToFit</span><span class="p">()</span>
<span class="c1">// Here, I adjust the constraints of the imageView. For more details, refer to the complete example at the end of the document</span>
</pre></table></code></div></div><p>Here is the translated content:</p><p>The above is the processing for images.</p><p><em>The cropping part uses Kingfisher to assist us, and can also be replaced with other libraries or custom methods.</em></p><p>Next, let’s focus on the code directly.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="kd">#available(iOS 11.0, *)</span> <span class="p">{</span>
    <span class="c1">// Supported after iOS 11</span>
    <span class="k">let</span> <span class="nv">completionHandle</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">faceObservations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNFaceObservation</span><span class="p">]</span> <span class="p">{</span>
            <span class="c1">// Recognized faces</span>
            
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="c1">// Operate on UIView, switch back to the main thread</span>
                <span class="k">let</span> <span class="nv">size</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">imageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span>
                
                <span class="n">faceObservations</span><span class="o">.</span><span class="nf">forEach</span><span class="p">({</span> <span class="p">(</span><span class="n">faceObservation</span><span class="p">)</span> <span class="k">in</span>
                    <span class="c1">// Coordinate system conversion</span>
                    <span class="k">let</span> <span class="nv">translate</span> <span class="o">=</span> <span class="kt">CGAffineTransform</span><span class="o">.</span><span class="n">identity</span><span class="o">.</span><span class="nf">scaledBy</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                    <span class="k">let</span> <span class="nv">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransform</span><span class="p">(</span><span class="nv">scaleX</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nf">translatedBy</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="o">-</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                    <span class="k">let</span> <span class="nv">transRect</span> <span class="o">=</span>  <span class="n">faceObservation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">applying</span><span class="p">(</span><span class="n">translate</span><span class="p">)</span><span class="o">.</span><span class="nf">applying</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
                    
                    <span class="k">let</span> <span class="nv">markerView</span> <span class="o">=</span> <span class="kt">UIView</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="n">transRect</span><span class="p">)</span>
                    <span class="n">markerView</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">)</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">imageView</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">markerView</span><span class="p">)</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"No faces detected"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// Recognition request</span>
    <span class="k">let</span> <span class="nv">baseRequest</span> <span class="o">=</span> <span class="kt">VNDetectFaceRectanglesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandle</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">faceHandle</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">ciImage</span><span class="p">:</span> <span class="n">ciImage</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="c1">// Recognition takes time, so it is executed in the background thread to avoid freezing the current screen</span>
        <span class="k">do</span><span class="p">{</span>
            <span class="k">try</span> <span class="n">faceHandle</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">baseRequest</span><span class="p">])</span>
        <span class="p">}</span><span class="k">catch</span><span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Throws: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
  
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Not supported"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The main thing to note is the coordinate system conversion part; the results recognized are in the original coordinates of the image; we need to convert it to the actual coordinates of the ImageView outside to use it correctly.</p><h4 id="next-lets-focus-on-todays-highlight---cropping-the-correct-position-of-the-avatar-according-to-the-position-of-the-face"><span class="me-2">Next, let’s focus on today’s highlight - cropping the correct position of the avatar according to the position of the face.</span><a href="#next-lets-focus-on-todays-highlight---cropping-the-correct-position-of-the-avatar-according-to-the-position-of-the-face" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="n">let</span> <span class="n">ratio</span> <span class="o">=</span> <span class="nc">UIScreen</span><span class="mf">.</span><span class="n">main</span><span class="mf">.</span><span class="n">bounds</span><span class="mf">.</span><span class="n">size</span><span class="mf">.</span><span class="n">width</span>
<span class="c1">// Here, because I set the left and right alignment of my UIImageView to 0, with a ratio of 1:1, details can be found in the complete example at the end</span>

<span class="n">let</span> <span class="n">sourceImage</span> <span class="o">=</span> <span class="nf">UIImage</span><span class="p">(</span><span class="n">named</span><span class="o">:</span> <span class="s2">"Demo"</span><span class="p">)</span>

<span class="n">imageView</span><span class="mf">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="mf">.</span><span class="n">scaleAspectFill</span>
<span class="c1">// Use scaleAspectFill mode to fill</span>

<span class="n">imageView</span><span class="mf">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">sourceImage</span>
<span class="c1">// Assign the original image, we will operate on it later</span>

<span class="k">if</span> <span class="n">let</span> <span class="n">image</span> <span class="o">=</span> <span class="n">sourceImage</span><span class="p">,</span> <span class="c1">#available(iOS 11.0, *), let ciImage = CIImage(image: image) {</span>
    <span class="n">let</span> <span class="n">completionHandle</span><span class="o">:</span> <span class="nc">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="n">in</span>
        <span class="k">if</span> <span class="n">request</span><span class="mf">.</span><span class="n">results</span><span class="o">?</span><span class="mf">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">let</span> <span class="n">faceObservation</span> <span class="o">=</span> <span class="n">request</span><span class="mf">.</span><span class="n">results</span><span class="o">?</span><span class="mf">.</span><span class="n">first</span> <span class="k">as</span><span class="o">?</span> <span class="nc">VNFaceObservation</span> <span class="p">{</span>
            <span class="c1">// One face</span>
            <span class="n">let</span> <span class="n">size</span> <span class="o">=</span> <span class="nf">CGSize</span><span class="p">(</span><span class="n">width</span><span class="o">:</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">height</span><span class="o">:</span> <span class="n">ratio</span><span class="p">)</span>
            
            <span class="n">let</span> <span class="n">translate</span> <span class="o">=</span> <span class="nc">CGAffineTransform</span><span class="mf">.</span><span class="n">identity</span><span class="mf">.</span><span class="nf">scaledBy</span><span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="n">size</span><span class="mf">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="o">:</span> <span class="n">size</span><span class="mf">.</span><span class="n">height</span><span class="p">)</span>
            <span class="n">let</span> <span class="n">transform</span> <span class="o">=</span> <span class="nf">CGAffineTransform</span><span class="p">(</span><span class="n">scaleX</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="mf">.</span><span class="nf">translatedBy</span><span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">:</span> <span class="o">-</span><span class="n">size</span><span class="mf">.</span><span class="n">height</span><span class="p">)</span>
            <span class="n">let</span> <span class="n">finalRect</span> <span class="o">=</span>  <span class="n">faceObservation</span><span class="mf">.</span><span class="n">boundingBox</span><span class="mf">.</span><span class="nf">applying</span><span class="p">(</span><span class="n">translate</span><span class="p">)</span><span class="mf">.</span><span class="nf">applying</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
            
            <span class="n">let</span> <span class="n">center</span> <span class="o">=</span> <span class="nf">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="p">(</span><span class="n">finalRect</span><span class="mf">.</span><span class="n">origin</span><span class="mf">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">finalRect</span><span class="mf">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">size</span><span class="mf">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">y</span><span class="o">:</span> <span class="p">(</span><span class="n">finalRect</span><span class="mf">.</span><span class="n">origin</span><span class="mf">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">finalRect</span><span class="mf">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">size</span><span class="mf">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
            <span class="c1">// Here is the calculation of the middle point position of the face range</span>
            
            <span class="n">let</span> <span class="n">newImage</span> <span class="o">=</span> <span class="n">image</span><span class="mf">.</span><span class="n">kf</span><span class="mf">.</span><span class="nf">resize</span><span class="p">(</span><span class="n">to</span><span class="o">:</span> <span class="n">size</span><span class="p">,</span> <span class="k">for</span><span class="o">:</span> <span class="mf">.</span><span class="n">aspectFill</span><span class="p">)</span><span class="mf">.</span><span class="n">kf</span><span class="mf">.</span><span class="nf">crop</span><span class="p">(</span><span class="n">to</span><span class="o">:</span> <span class="n">size</span><span class="p">,</span> <span class="n">anchorOn</span><span class="o">:</span> <span class="n">center</span><span class="p">)</span>
            <span class="c1">// Crop the image according to the center point</span>
            
            <span class="nc">DispatchQueue</span><span class="mf">.</span><span class="n">main</span><span class="mf">.</span><span class="n">async</span> <span class="p">{</span>
                <span class="c1">// Operate on UIView, switch back to the main thread</span>
                <span class="k">self</span><span class="mf">.</span><span class="n">imageView</span><span class="mf">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">newImage</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Detected multiple faces or no faces detected"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">let</span> <span class="n">baseRequest</span> <span class="o">=</span> <span class="nf">VNDetectFaceRectanglesRequest</span><span class="p">(</span><span class="n">completionHandler</span><span class="o">:</span> <span class="n">completionHandle</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">faceHandle</span> <span class="o">=</span> <span class="nf">VNImageRequestHandler</span><span class="p">(</span><span class="n">ciImage</span><span class="o">:</span> <span class="n">ciImage</span><span class="p">,</span> <span class="n">options</span><span class="o">:</span> <span class="p">[</span><span class="o">:</span><span class="p">])</span>
    <span class="nc">DispatchQueue</span><span class="mf">.</span><span class="k">global</span><span class="p">()</span><span class="mf">.</span><span class="n">async</span> <span class="p">{</span>
        <span class="k">do</span><span class="p">{</span>
            <span class="k">try</span> <span class="n">faceHandle</span><span class="mf">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">baseRequest</span><span class="p">])</span>
        <span class="p">}</span><span class="k">catch</span><span class="p">{</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Throws: \(error)"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"Not supported"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The logic is similar to marking the position of a face, the difference is that the avatar part has a fixed size (e.g. 300x300), so we skip the first part that requires the Image to fit the ImageView.</p><p>Another difference is that we need to calculate the center point of the face area and use this center point as the reference for cropping the image.</p><p><a href="/assets/9a9aa892f9a9/1*civytcKOguHfVFHYPVWecA.png" class="popup img-link "><img data-src="/assets/9a9aa892f9a9/1*civytcKOguHfVFHYPVWecA.png" alt="The red dot is the center point of the face area" class="lazyload" data-proofer-ignore></a></p><p>The red dot is the center point of the face area.</p><h4 id="final-effect-image"><span class="me-2">Final effect image:</span><a href="#final-effect-image" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/9a9aa892f9a9/1*WocYjt0xLkqtGVilxfT2LA.gif" class="popup img-link "><img data-src="/assets/9a9aa892f9a9/1*WocYjt0xLkqtGVilxfT2LA.gif" alt="The second before the blink is the original image position" class="lazyload" data-proofer-ignore></a></p><p>The second before the blink is the original image position.</p><h3 id="complete-app-example"><span class="me-2">Complete app example:</span><a href="#complete-app-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/9a9aa892f9a9/1*J8oByw8gBCamIac2TkT1SA.gif" class="popup img-link "><img data-src="/assets/9a9aa892f9a9/1*J8oByw8gBCamIac2TkT1SA.gif" alt="" class="lazyload" data-proofer-ignore></a></p><p>The code has been uploaded to Github: <a href="https://github.com/zhgchgli0718/VisionDemo" target="_blank">Click here</a></p><p>For any questions or suggestions, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/9a9aa892f9a9/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/9a9aa892f9a9" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/machine-learning/" class="post-tag no-text-decoration" >machine-learning</a> <a href="/tags/facedetection/" class="post-tag no-text-decoration" >facedetection</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Exploring%20Vision%E2%80%8A%E2%80%94%E2%80%8AAutomatic%20Face%20Detection%20and%20Cropping%20for%20Profile%20Pictures%20(Swift)%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F9a9aa892f9a9%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Exploring%20Vision%E2%80%8A%E2%80%94%E2%80%8AAutomatic%20Face%20Detection%20and%20Cropping%20for%20Profile%20Pictures%20(Swift)%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F9a9aa892f9a9%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F9a9aa892f9a9%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/793bf2cdda0f/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539789635" data-df="ll" > Oct 17, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>Exploring iOS 12 CoreML — Automatically Predict Article Categories Using Machine Learning, Even Train the Model Yourself!</h4><div class="text-muted small"><p> Exploring iOS 12 CoreML — Automatically Predict Article Categories Using Machine Learning, Even Train the Model Yourself! Explore CoreML 2.0, how to convert or train models and apply them in real ...</p></div></div></a></div><div class="col"> <a href="/posts/e37d66ea1146/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539454069" data-df="ll" > Oct 14, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS UITextView Text Wrapping Editor (Swift)</h4><div class="text-muted small"><p> iOS UITextView Text Wrapping Editor (Swift) Practical Route Target Functionality: The app has a discussion area where users can post articles. The interface for posting articles needs to support...</p></div></div></a></div><div class="col"> <a href="/posts/cb6eba52a342/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539618241" data-df="ll" > Oct 15, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS ≥ 10 Notification Service Extension Application (Swift)</h4><div class="text-muted small"><p> iOS ≥ 10 Notification Service Extension Application (Swift) Image push notifications, push notification display statistics, pre-processing before push notification display Regarding the basics of...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cb6eba52a342/" class="btn btn-outline-primary" prompt="Older" ><p>iOS ≥ 10 Notification Service Extension Application (Swift)</p></a> <a href="/posts/793bf2cdda0f/" class="btn btn-outline-primary" prompt="Newer" ><p>Exploring iOS 12 CoreML — Automatically Predict Article Categories Using Machine Learning, Even Train the Model Yourself!</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
