<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="The APP uses HTTPS for transmission, but the data was still stolen." /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Using mitmproxy on iOS+MacOS to perform a Man-in-the-middle attack to sniff API transmission data" /><meta property="og:description" content="Using mitmproxy on iOS+MacOS to perform a Man-in-the-middle attack to sniff API transmission data" /><link rel="canonical" href="https://en.zhgchg.li/posts/46410aaada00/" /><meta property="og:url" content="https://en.zhgchg.li/posts/46410aaada00/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-09-20T18:01:01+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png" /><meta property="twitter:title" content="The APP uses HTTPS for transmission, but the data was still stolen." /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-04-13T15:56:08+08:00","datePublished":"2019-09-20T18:01:01+08:00","description":"Using mitmproxy on iOS+MacOS to perform a Man-in-the-middle attack to sniff API transmission data","headline":"The APP uses HTTPS for transmission, but the data was still stolen.","image":"https://en.zhgchg.li/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/46410aaada00/"},"url":"https://en.zhgchg.li/posts/46410aaada00/"}</script><title>The APP uses HTTPS for transmission, but the data was still stolen. | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>The APP uses HTTPS for transmission, but the data was still stolen.</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>The APP uses HTTPS for transmission, but the data was still stolen.</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1568973661" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 20, 2019 </em> </span> <span> Updated <em class="" data-ts="1712994968" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1889 words" > <em>10 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="the-app-uses-https-for-transmission-but-the-data-was-still-stolen"><span class="me-2">The APP uses HTTPS for transmission, but the data was still stolen.</span><a href="#the-app-uses-https-for-transmission-but-the-data-was-still-stolen" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Using mitmproxy on iOS+MacOS to perform a Man-in-the-middle attack to sniff API transmission data and how to prevent it?</p><h3 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Recently, we just held an internal <a href="../729d7b6817a4/">CTF competition</a> at the company. While brainstorming for topics, I recalled a project from my university days when I was working on backend (PHP) development. It was a point collection APP with a task list, and upon completing the trigger conditions, it would call an API to earn points. The boss thought that calling the API with HTTPS encrypted transmission was very secure — until I demonstrated a Man-in-the-middle attack, directly sniffing the transmission data and forging API calls to earn points…</p><p>In recent years, with the rise of big data, web crawlers are everywhere; the battle between crawlers and anti-crawlers is becoming increasingly intense, <a href="https://coolcao.com/2018/06/09/tips-of-anti-spider-in-fe/" target="_blank">with various tricks being used</a>. It’s a constant game of cat and mouse!</p><p>Another target for crawlers is the APP’s API. If there are no defenses, it’s almost like leaving the door wide open; it’s not only easy to operate but also clean in format, making it harder to identify and block. So if you’ve exhausted all efforts to block on the web end and data is still being crawled, you might want to check if the APP’s API has any vulnerabilities.</p><p>Since I didn’t know how to incorporate this topic into the CTF competition, I decided to write a separate article as a record. This article is just to give a basic concept — <a href="http://www.aqee.net/post/man-in-the-middle-attack.html" target="_blank">HTTPS can be decrypted through certificate replacement</a> and how to enhance security to prevent it. The actual network theory is not my strong suit and has been forgotten, so if you already have a concept of this, you don’t need to spend time reading this article, or just scroll to the bottom to see how to protect your APP!</p><h3 id="practical-operation"><span class="me-2">Practical Operation</span><a href="#practical-operation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Environment: MacOS + iOS</p><blockquote><p><em>Android users can directly download <a href="https://play.google.com/store/apps/details?id=app.greyshirts.sslcapture&amp;hl=en" target="_blank">Packet Capture</a> (free), iOS users can use <a href="https://apps.apple.com/us/app/surge-3/id1442620678" target="_blank">Surge 4</a> (paid) to unlock the Man-in-the-middle attack feature, and MacOS users can also use another paid software, Charles.</em></p></blockquote><blockquote><p><em>This article mainly explains how to use the <strong>free</strong> mitmproxy on iOS. If you have the above environment, you don’t need to go through this trouble. Just open the APP on your phone, mount the VPN, and replace the certificate to perform a Man-in-the-middle attack! (Again, please scroll to the bottom to see how to protect your APP!)</em></p></blockquote><p><strong>[2021/02/25 Update]:</strong> Mac has a new free graphical interface program (<a href="https://proxyman.io/" target="_blank">Proxyman</a>) that can be used, which can be paired with <a href="../70a1409b149a/">this article</a> for reference in the first part.</p><h4 id="install-mitmproxy"><span class="me-2">Install <a href="https://mitmproxy.org" target="_blank">mitmproxy</a></span><a href="#install-mitmproxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>Directly use brew to install</strong>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>brew <span class="nb">install </span>mitmproxy
</pre></table></code></div></div><p><strong>Installation complete!</strong></p><p><em>p.s. If you encounter brew: command not found, please first install the <a href="https://brew.sh/index_zh-tw" target="_blank">brew</a> package management tool</em>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/ruby <span class="nt">-e</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/master/install<span class="si">)</span><span class="s2">"</span>
</pre></table></code></div></div><h4 id="using-mitmproxy"><span class="me-2">Using mitmproxy</span><a href="#using-mitmproxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After installation, enter the following command in Terminal to activate:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmproxy
</pre></table></code></div></div><p><a href="/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png" alt="Startup Successful" class="lazyload" data-proofer-ignore></a></p><p>Startup Successful</p><h4 id="ensure-the-phone-and-mac-are-on-the-same-local-network--obtain-the-macs-ip-address"><span class="me-2">Ensure the phone and Mac are on the same local network &amp; obtain the Mac’s IP address</span><a href="#ensure-the-phone-and-mac-are-on-the-same-local-network--obtain-the-macs-ip-address" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Method (1) Mac connects to WiFi, and the phone uses the same WiFi <strong>Mac’s IP address =</strong> “System Preferences” -&gt; “Network” -&gt; “Wi-Fi” -&gt; “IP Address”</p><p>Method (2) Mac uses a wired network, enables Internet Sharing; phone connects to the hotspot network:</p><p><a href="/assets/46410aaada00/1*R9fthpHlrWzTh4R3fEwO5Q.gif" class="popup img-link "><img data-src="/assets/46410aaada00/1*R9fthpHlrWzTh4R3fEwO5Q.gif" alt="System Preferences -&gt; Sharing -&gt; Select &quot;Ethernet&quot; -&gt; Check &quot;Wi-Fi&quot; -&gt; Enable &quot;Internet Sharing&quot;" class="lazyload" data-proofer-ignore></a></p><p>System Preferences -&gt; Sharing -&gt; Select “Ethernet” -&gt; Check “Wi-Fi” -&gt; Enable “Internet Sharing”</p><p><strong>Mac’s IP address = 192.168.2.1</strong> (Note ⚠️ This is not the Ethernet IP, but the IP used by the Mac as a network sharing base station)</p><h4 id="phone-network-settings-wifi--proxy-server-information"><span class="me-2">Phone network settings WiFi — Proxy server information</span><a href="#phone-network-settings-wifi--proxy-server-information" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/46410aaada00/1*ziIFrGQaMr2kYrQHwLYNJg.jpeg" class="popup img-link "><img data-src="/assets/46410aaada00/1*ziIFrGQaMr2kYrQHwLYNJg.jpeg" alt="Settings -&gt; WiFi -&gt; HTTP Proxy -&gt; Manual -&gt; Enter **Mac's IP address** in Server -&gt; Enter **8080** in Port -&gt; Save" class="lazyload" data-proofer-ignore></a></p><p>Settings -&gt; WiFi -&gt; HTTP Proxy -&gt; Manual -&gt; Enter <strong>Mac’s IP address</strong> in Server -&gt; Enter <strong>8080</strong> in Port -&gt; Save</p><blockquote><p><em>At this point, it is normal for web pages not to open and for certificate errors to appear; let’s continue…</em></p></blockquote><h4 id="install-mitmproxy-custom-https-certificate"><span class="me-2">Install mitmproxy custom https certificate</span><a href="#install-mitmproxy-custom-https-certificate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>As mentioned above, the way a man-in-the-middle attack works is by using its own certificate to decrypt and encrypt data during communication; so we also need to install this custom certificate on the phone.</p><p><strong>1. Open <a href="http://mitm.it" target="_blank">http://mitm.it</a> on the phone’s Safari</strong></p><p><a href="/assets/46410aaada00/1*BuvCYx9WRzG0ECO3H_BS0A.jpeg" class="popup img-link "><img data-src="/assets/46410aaada00/1*BuvCYx9WRzG0ECO3H_BS0A.jpeg" alt="Left side appears -&gt; Proxy settings ✅ Right side appears -&gt; Proxy settings error 🚫" class="lazyload" data-proofer-ignore></a></p><p>Left side appears -&gt; Proxy settings ✅ / Right side appears -&gt; Proxy settings error 🚫</p><p><a href="/assets/46410aaada00/1*qKDHxi9HxUP41oDJahBfBA.jpeg" class="popup img-link "><img data-src="/assets/46410aaada00/1*qKDHxi9HxUP41oDJahBfBA.jpeg" alt="Apple -&gt; Install Profile -&gt; Install" class="lazyload" data-proofer-ignore></a></p><p>Apple -&gt; Install Profile -&gt; Install</p><blockquote><p><em>⚠️ It’s not over yet, we need to enable the profile in the About section</em></p></blockquote><p><a href="/assets/46410aaada00/1*mOijblpQepazFPIwob4r8Q.jpeg" class="popup img-link "><img data-src="/assets/46410aaada00/1*mOijblpQepazFPIwob4r8Q.jpeg" alt="General -&gt; About -&gt; Certificate Trust Settings -&gt; Enable mitmproxy" class="lazyload" data-proofer-ignore></a></p><p>General -&gt; About -&gt; Certificate Trust Settings -&gt; Enable mitmproxy</p><p><strong>Done! Now we can go back to the browser and browse web pages normally.</strong></p><h4 id="back-to-mac-to-operate-mitmproxy"><span class="me-2">Back to Mac to operate mitmproxy</span><a href="#back-to-mac-to-operate-mitmproxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/46410aaada00/1*kiEPaTm5bhnFLBfQngQPgA.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*kiEPaTm5bhnFLBfQngQPgA.png" alt="You can see the data transfer records from the phone on the mitmproxy Terminal" class="lazyload" data-proofer-ignore></a></p><p>You can see the data transfer records from the phone on the mitmproxy Terminal</p><p><a href="/assets/46410aaada00/1*5I6l9cO3LeXfcwGLpWGKPQ.gif" class="popup img-link "><img data-src="/assets/46410aaada00/1*5I6l9cO3LeXfcwGLpWGKPQ.gif" alt="Find the record you want to sniff and view the Request (what parameters were sent) Response (what content was returned)" class="lazyload" data-proofer-ignore></a></p><p>Find the record you want to sniff and view the Request (what parameters were sent) / Response (what content was returned)</p><h4 id="common-operation-keys"><span class="me-2">Common operation keys:</span><a href="#common-operation-keys" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>" ? " = View key operation documentation
" k " / "⬆" = Up 
" j " / "⬇" = Down 
" h " / "⬅" = Left 
" l " / "➡️" = Right 
" space " = Next page
" enter " = View details
" q " = Go back to the previous page/exit
" b " = Export response body to a specified path text file 
" f " = Filter records
" z " = Clear all records
" e " = Edit Request (cookie, headers, params...)
" r " = Resend Request
</pre></table></code></div></div><h4 id="not-comfortable-with-cli-no-worries-you-can-switch-to-web-gui"><span class="me-2">Not comfortable with CLI? No worries, you can switch to Web GUI!</span><a href="#not-comfortable-with-cli-no-worries-you-can-switch-to-web-gui" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Besides the mitmproxy activation method, we can change to:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmweb
</pre></table></code></div></div><p>to use the new Web GUI for operation and observation.</p><p><a href="/assets/46410aaada00/1*Stbf8gUk8iXwNkozOKyOjA.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*Stbf8gUk8iXwNkozOKyOjA.png" alt="mitmweb" class="lazyload" data-proofer-ignore></a></p><p>mitmweb</p><h4 id="the-main-event-sniffing-app-data"><span class="me-2">The main event, sniffing APP data:</span><a href="#the-main-event-sniffing-app-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After setting up and familiarizing yourself with the above environment, you can proceed to our main event; sniffing the data transmission content of the APP API!</p><blockquote><p><em>Here we use a certain real estate APP as an example, purely for academic exchange with no malicious intent!</em></p></blockquote><blockquote><p><em>We want to know how the API for the object list is requested and what content is returned!</em></p></blockquote><p><a href="/assets/46410aaada00/1*HKppSomeMK5U3Z0kbaRvkQ.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*HKppSomeMK5U3Z0kbaRvkQ.png" alt="First press &quot;z&quot; to clear all records (to avoid confusion)" class="lazyload" data-proofer-ignore></a></p><p>First press “z” to clear all records (to avoid confusion)</p><p><a href="/assets/46410aaada00/1*mpNLXzUwb7-jiikrHkoTcA.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*mpNLXzUwb7-jiikrHkoTcA.png" alt="Open the target APP" class="lazyload" data-proofer-ignore></a></p><p>Open the target APP</p><p>Open the target APP and try “pull to refresh” or trigger the “load next page” action.</p><blockquote><p><strong><em>🛑If your target APP cannot be opened or connected; sorry, it means the APP has protection measures and cannot be sniffed using this method. Please scroll down to the section on how to protect it🛑</em></strong></p></blockquote><p><a href="/assets/46410aaada00/1*KOkJugn95bcUCPl-dZEaRA.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*KOkJugn95bcUCPl-dZEaRA.png" alt="mitmproxy records" class="lazyload" data-proofer-ignore></a></p><p>mitmproxy records</p><p>Go back to mitmproxy to check the records, use your detective skills to guess which API request record is the one we want and enter to view the details!</p><p><a href="/assets/46410aaada00/1*n6mUgej-2_U8PRUbQo_j1g.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*n6mUgej-2_U8PRUbQo_j1g.png" alt="Request" class="lazyload" data-proofer-ignore></a></p><p>Request</p><p>In the Request section, you can see what parameters were passed in the request.</p><p>With “e” to edit and “r” to resend, and observing the Response, you can guess the purpose of each parameter!</p><p><a href="/assets/46410aaada00/1*zxdLiXMP-KapoEYou_TlZg.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*zxdLiXMP-KapoEYou_TlZg.png" alt="Response" class="lazyload" data-proofer-ignore></a></p><p>Response</p><p>The Response section also directly provides the original returned content.</p><blockquote><p><strong><em>🛑If the Response content is a bunch of codes; sorry, it means the APP might have its own encryption and decryption, making it impossible to sniff using this method. Please scroll down to the section on how to protect it🛑</em></strong></p></blockquote><p>Hard to read? Chinese garbled text? No problem, you can use “b” to export it as a text file to the desktop, then copy the content to <a href="https://jsoneditoronline.org/" target="_blank">Json Editor Online</a> for parsing!</p><p><a href="/assets/46410aaada00/1*7qOTLAIQHH6V782OnvFVFQ.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*7qOTLAIQHH6V782OnvFVFQ.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote><p><strong><em>Or directly use mitmweb to browse and operate using the web GUI</em></strong></p></blockquote><p><a href="/assets/46410aaada00/1*ujOlDBdjp8tECeAwRzWRPw.png" class="popup img-link "><img data-src="/assets/46410aaada00/1*ujOlDBdjp8tECeAwRzWRPw.png" alt="mitmweb" class="lazyload" data-proofer-ignore></a></p><p>mitmweb</p><p>After sniffing, observing, filtering, and testing, you can understand how the APP API works, and thus use it to scrape data.</p><blockquote><p><em>After collecting the required information, remember to turn off mitmproxy and change the mobile network proxy server back to automatic to use the internet normally.</em></p></blockquote><h3 id="how-should-the-app-protect-itself"><span class="me-2">How should the APP protect itself?</span><a href="#how-should-the-app-protect-itself" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If after setting up mitmproxy, you find that the APP cannot be used or the returned content is encoded, it means the APP has protection.</p><p><strong>Method (1):</strong></p><p>Generally, it involves placing a copy of the certificate information in the APP. If the current HTTPS certificate does not match the information in the APP, access is denied. For details, you can <a href="https://www.anquanke.com/post/id/147090" target="_blank">see this</a> or find related resources on <a href="https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc" target="_blank">SSL Pinning</a>. The downside might be the need to pay attention to the certificate’s validity period!</p><p><a href="/assets/46410aaada00/1*31rODDIlYPidTP3L8W_C7A.jpeg" class="popup img-link "><img data-src="/assets/46410aaada00/1*31rODDIlYPidTP3L8W_C7A.jpeg" alt="[https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc](https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p><a href="https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc" target="_blank">https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc</a></p><p><strong>Method (2):</strong></p><p>The APP encodes and encrypts the data before transmission. The API backend decrypts it to obtain the original request content. The API response is also encoded and encrypted before being sent back. The APP decrypts the received data to get the response content. This method is cumbersome and inefficient, but it is indeed a way to protect data. As far as I know, some digital banks use this method for protection!</p><h4 id="however"><span class="me-2">However…</span><a href="#however" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Method 1 still has a way to be cracked: <a href="https://www.anquanke.com/post/id/179514" target="_blank">How to Bypass SSL Pinning on iOS 12</a></p><p>Method 2 can also be compromised through reverse engineering to obtain the encryption keys.</p><p><strong>⚠️There is no 100% security⚠️</strong></p><p><code class="language-plaintext highlighter-rouge">Or simply create a trap to collect evidence and solve it legally (？</code></p><h4 id="as-always"><span class="me-2">As always:</span><a href="#as-always" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p>“NEVER TRUST THE CLIENT”</p></blockquote><h3 id="more-uses-of-mitmproxy"><span class="me-2">More uses of mitmproxy:</span><a href="#more-uses-of-mitmproxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>1. Using mitmdump</strong></p><p>Besides <code class="language-plaintext highlighter-rouge">mitmproxy</code> and <code class="language-plaintext highlighter-rouge">mitmweb</code>, <code class="language-plaintext highlighter-rouge">mitmdump</code> can directly export all records to a text file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-w</span> /log.txt
</pre></table></code></div></div><p>You can also use <strong>Method (2)</strong> with a Python script to set and filter traffic:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-ns</span> examples/filter.py <span class="nt">-r</span> /log.txt <span class="nt">-w</span> /result.txt
</pre></table></code></div></div><p><strong>2. Use a Python script for request parameter settings, access control, and redirection:</strong></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">mitmproxy</span> <span class="kn">import</span> <span class="n">http</span>

<span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">flow</span><span class="p">:</span> <span class="n">http</span><span class="p">.</span><span class="n">HTTPFlow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="c1"># pretty_host takes the "Host" header of the request into account,
</span>    <span class="c1"># which is useful in transparent mode where we usually only have the IP
</span>    <span class="c1"># otherwise.
</span>    
    <span class="c1"># Request parameter setting Example:
</span>    <span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'User-Agent'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'MitmProxy'</span>
    
    <span class="k">if</span> <span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">pretty_host</span> <span class="o">==</span> <span class="s">"123.com.tw"</span><span class="p">:</span>
        <span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">host</span> <span class="o">=</span> <span class="s">"456.com.tw"</span>
    <span class="c1"># Redirect all access from 123.com.tw to 456.com.tw
</span></pre></table></code></div></div><p>Redirection example</p><p>When starting mitmproxy, add the parameter:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>mitmproxy -s /redirect.py
or
mitmweb -s /redirect.py
or
mitmdump -s /redirect.py
</pre></table></code></div></div><h3 id="filling-a-gap"><span class="me-2">Filling a gap</span><a href="#filling-a-gap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When using mitmproxy to observe requests using HTTP 1.1 and Accept-Ranges: bytes, Content-Range for long connection segment continuous resource fetching, it will wait until the entire response is received before displaying, rather than showing segments and using persistent connections to continue downloading!</p><p><a href="../ee47f8f1e2d2/">Details here</a>.</p><h3 id="further-reading"><span class="me-2">Further Reading</span><a href="#further-reading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="../70a1409b149a/">Creating a Daily Auto Check-in Script with a Reward App</a><li><a href="../729d7b6817a4/">How to Create an Interesting Engineering CTF Competition</a><li><a href="../142244e5f07a/">Revealing a Clever Website Vulnerability Discovered Years Ago</a><li><a href="https://medium.com/zrealm-ios-dev/ios-15-macos-monterey-safari-%E5%B0%87%E8%83%BD%E9%9A%B1%E8%97%8F%E7%9C%9F%E5%AF%A6-ip-755a8b6acc35" target="_blank">iOS 15 / MacOS Monterey Safari Will Be Able to Hide Real IP</a></ul><h3 id="postscript"><span class="me-2">Postscript</span><a href="#postscript" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Since I don’t have domain permissions, I can’t obtain SSL certificate information, so I can’t implement it. The code doesn’t seem difficult, and although there’s no 100% secure method, adding an extra layer of protection can make it safer. Further attacks would require a lot of time to research, which should deter 90% of crawlers!</p><p>This article might be a bit low in value. I’ve neglected Medium for a while (playing with a DSLR). Mainly, this is to warm up for <a href="https://iplayground.io/2019/" target="_blank">iPlayground 2019</a> this weekend (2019/09/21–2019/09/22). Looking forward to this year’s sessions 🤩, and hope to produce more quality articles after returning!</p><blockquote><p><strong><em>[Updated on 2019/02/22] <a href="../4079036c85c2/">What is the Experience of iPlayground 2019?</a></em></strong></p></blockquote><p>If you have any questions or feedback, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/46410aaada00/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/46410aaada00" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/mitmproxy/" class="post-tag no-text-decoration" >mitmproxy</a> <a href="/tags/man-in-the-middle/" class="post-tag no-text-decoration" >man-in-the-middle</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/hacking/" class="post-tag no-text-decoration" >hacking</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The%20APP%20uses%20HTTPS%20for%20transmission,%20but%20the%20data%20was%20still%20stolen.%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F46410aaada00%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The%20APP%20uses%20HTTPS%20for%20transmission,%20but%20the%20data%20was%20still%20stolen.%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F46410aaada00%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F46410aaada00%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/7498e1ff93ce/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1585391080" data-df="ll" > Mar 28, 2020 </em><h4 class="pt-0 my-2" data-toc-skip>First Experience with iOS Reverse Engineering</h4><div class="text-muted small"><p> First Experience with iOS Reverse Engineering Exploring the process from jailbreaking, extracting iPA files, shelling, to UI analysis, injection, and decompilation About Security The only thing ...</p></div></div></a></div><div class="col"> <a href="/posts/8a04443024e2/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1593697896" data-df="ll" > Jul 2, 2020 </em><h4 class="pt-0 my-2" data-toc-skip>iOS 14 Clipboard Data Theft Panic: The Dilemma of Privacy and Convenience</h4><div class="text-muted small"><p> iOS 14 Clipboard Data Theft Panic: The Dilemma of Privacy and Convenience Why do so many iOS apps read your clipboard? Photo by Clint Patterson ⚠️ 2022/07/22 Update: iOS 16 Upcoming Changes St...</p></div></div></a></div><div class="col"> <a href="/posts/e37d66ea1146/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539454069" data-df="ll" > Oct 14, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS UITextView Text Wrapping Editor (Swift)</h4><div class="text-muted small"><p> iOS UITextView Text Wrapping Editor (Swift) Practical Route Target Functionality: The app has a discussion area where users can post articles. The interface for posting articles needs to support...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/729d7b6817a4/" class="btn btn-outline-primary" prompt="Older" ><p>How to Create an Engaging Engineering CTF Competition</p></a> <a href="/posts/4079036c85c2/" class="btn btn-outline-primary" prompt="Newer" ><p>What was the experience of iPlayground 2019 like?</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
