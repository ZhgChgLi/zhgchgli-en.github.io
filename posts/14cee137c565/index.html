<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="iOS UIViewController Transition Techniques" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Complete guide to pull-down to close, pull-up to appear, and full-page right swipe back effects in UIViewController" /><meta property="og:description" content="Complete guide to pull-down to close, pull-up to appear, and full-page right swipe back effects in UIViewController" /><link rel="canonical" href="https://en.zhgchg.li/posts/14cee137c565/" /><meta property="og:url" content="https://en.zhgchg.li/posts/14cee137c565/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-01-12T02:41:06+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" /><meta property="twitter:title" content="iOS UIViewController Transition Techniques" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-04-13T16:06:12+08:00","datePublished":"2020-01-12T02:41:06+08:00","description":"Complete guide to pull-down to close, pull-up to appear, and full-page right swipe back effects in UIViewController","headline":"iOS UIViewController Transition Techniques","image":"https://en.zhgchg.li/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/14cee137c565/"},"url":"https://en.zhgchg.li/posts/14cee137c565/"}</script><title>iOS UIViewController Transition Techniques | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>iOS UIViewController Transition Techniques</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>iOS UIViewController Transition Techniques</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1578768066" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 12, 2020 </em> </span> <span> Updated <em class="" data-ts="1712995572" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4327 words" > <em>24 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="ios-uiviewcontroller-transition-techniques"><span class="me-2">iOS UIViewController Transition Techniques</span><a href="#ios-uiviewcontroller-transition-techniques" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Complete guide to pull-down to close, pull-up to appear, and full-page right swipe back effects in UIViewController</p><h3 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" class="popup img-link "><img data-src="/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" alt="" class="lazyload" data-proofer-ignore></a></p><p>I’ve always been curious about how commonly used apps like Facebook, Line, Spotify, etc., implement effects such as “pull-down to close a presented UIViewController,” “pull-up to gradually appear a UIViewController,” and “full-page support for right swipe back.”</p><p>These effects are not built-in, and the pull-down to close feature only has system card style support starting from iOS 13.</p><h4 id="exploration-journey"><span class="me-2">Exploration Journey</span><a href="#exploration-journey" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Whether it’s due to not knowing the right keywords or the difficulty in finding the information, I could never find a clear implementation method for these features. The information I found was always vague and scattered, requiring piecing together from various sources.</p><p>When I first researched the method, I found the <code class="language-plaintext highlighter-rouge">UIPresentationController</code> API. Without delving deeper into other resources, I used this method combined with <code class="language-plaintext highlighter-rouge">UIPanGestureRecognizer</code> to achieve the pull-down to close effect in a rather crude way. It always felt off, like there should be a better way.</p><p>Recently, while working on a new project, I came across <a href="https://imnotyourson.com/draggable-view-controller-interactive-view-controller/" target="_blank">this article</a> which broadened my horizons and revealed more elegant and flexible APIs.</p><blockquote><p><em>This post serves as both a personal record and a guide for those who share my confusion.</em></p></blockquote><blockquote><p><em>The content is quite extensive. If you’re in a hurry, you can skip to the end for examples or directly download the GitHub project for study!</em></p></blockquote><h3 id="ios-13-card-style-presentation"><span class="me-2">iOS 13 Card Style Presentation</span><a href="#ios-13-card-style-presentation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, let’s talk about the latest built-in effect. From iOS 13 onwards, <code class="language-plaintext highlighter-rouge">UIViewController.present(_:animated:completion:)</code> defaults to the <code class="language-plaintext highlighter-rouge">modalPresentationStyle</code> effect of <code class="language-plaintext highlighter-rouge">UIModalPresentationAutomatic</code> for card style presentation. If you want to maintain the previous full-page presentation, you need to specifically set it back to <code class="language-plaintext highlighter-rouge">UIModalPresentationFullScreen</code>.</p><p><a href="/assets/14cee137c565/1*j0NeJfAuR2fXP56KWglS7Q.gif" class="popup img-link "><img data-src="/assets/14cee137c565/1*j0NeJfAuR2fXP56KWglS7Q.gif" alt="Built-in Calendar Add Effect" class="lazyload" data-proofer-ignore></a></p><p>Built-in Calendar Add Effect</p><h4 id="how-to-disable-pull-down-to-close-confirmation-on-close"><span class="me-2">How to Disable Pull-Down to Close? Confirmation on Close?</span><a href="#how-to-disable-pull-down-to-close-confirmation-on-close" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>A better user experience should check for unsaved data when triggering the pull-down to close action, prompting the user whether to discard changes before leaving.</p><p>Apple has thought of this for us. Simply implement the methods in <code class="language-plaintext highlighter-rouge">UIAdaptivePresentationControllerDelegate</code>.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">DetailViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">onEdit</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        
        <span class="c1">// Set delegate</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presentationController</span><span class="p">?</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="c1">// if UIViewController is embedded in NavigationController:</span>
        <span class="c1">// self.navigationController?.presentationController?.delegate = self</span>
        
        <span class="c1">// Disable pull-down to close method (1):</span>
        <span class="k">self</span><span class="o">.</span><span class="n">isModalInPresentation</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="c1">// Delegate implementation</span>
<span class="kd">extension</span> <span class="kt">DetailViewController</span><span class="p">:</span> <span class="kt">UIAdaptivePresentationControllerDelegate</span> <span class="p">{</span>
    <span class="c1">// Disable pull-down to close method (2):</span>
    <span class="kd">func</span> <span class="nf">presentationControllerShouldDismiss</span><span class="p">(</span><span class="n">_</span> <span class="nv">presentationController</span><span class="p">:</span> <span class="kt">UIPresentationController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Triggered when pull-down to close is canceled</span>
    <span class="kd">func</span> <span class="nf">presentationControllerDidAttemptToDismiss</span><span class="p">(</span><span class="n">_</span> <span class="nv">presentationController</span><span class="p">:</span> <span class="kt">UIPresentationController</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">onEdit</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">let</span> <span class="nv">alert</span> <span class="o">=</span> <span class="kt">UIAlertController</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Unsaved Data"</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">preferredStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">actionSheet</span><span class="p">)</span>
          <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Discard and Leave"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
              <span class="k">self</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
          <span class="p">})</span>
          <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Continue Editing"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">cancel</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">))</span>
          <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">alert</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>      
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">self</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>To cancel the dismissal by swipe down, you can either set the <code class="language-plaintext highlighter-rouge">UIViewController</code> variable <code class="language-plaintext highlighter-rouge">isModalInPresentation</code> to false or implement the <code class="language-plaintext highlighter-rouge">UIAdaptivePresentationControllerDelegate</code> method <code class="language-plaintext highlighter-rouge">presentationControllerShouldDismiss</code> and return <code class="language-plaintext highlighter-rouge">true</code>.</p><p>The method <code class="language-plaintext highlighter-rouge">UIAdaptivePresentationControllerDelegate presentationControllerDidAttemptToDismiss</code> is only called when the <strong>dismissal by swipe down is canceled</strong>.</p><h4 id="by-the-way"><span class="me-2">By the way…</span><a href="#by-the-way" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>For the system, a card-style presentation page is considered a <code class="language-plaintext highlighter-rouge">Sheet</code>, which behaves differently from <code class="language-plaintext highlighter-rouge">FullScreen</code>.</p><blockquote><p><em>Assuming that <code class="language-plaintext highlighter-rouge">RootViewController</code> is <code class="language-plaintext highlighter-rouge">HomeViewController</code></em></p></blockquote><blockquote><p><em>In a card-style presentation (UIModalPresentationAutomatic):</em></p></blockquote><blockquote><p>When <code class="language-plaintext highlighter-rouge">HomeViewController</code> <em><code class="language-plaintext highlighter-rouge">Presents</code> <code class="language-plaintext highlighter-rouge">DetailViewController</code>…</em></p></blockquote><blockquote><p><code class="language-plaintext highlighter-rouge">HomeViewController</code> <strong><em><code class="language-plaintext highlighter-rouge">viewWillDisAppear</code> / <code class="language-plaintext highlighter-rouge">viewDidDisAppear</code> will not be triggered.</em></strong></p></blockquote><blockquote><p>When <code class="language-plaintext highlighter-rouge">DetailViewController</code> <em><code class="language-plaintext highlighter-rouge">Dismisses</code>…</em></p></blockquote><blockquote><p><code class="language-plaintext highlighter-rouge">HomeViewController</code> <strong><em><code class="language-plaintext highlighter-rouge">viewWillAppear</code> / <code class="language-plaintext highlighter-rouge">viewDidAppear</code> will not be triggered.</em></strong></p></blockquote><blockquote><p><em>⚠️ <strong>Since XCODE 11, iOS ≥ 13 apps packaged by default use the card style (UIModalPresentationAutomatic) for Presentations</strong></em></p></blockquote><blockquote><p><em><strong>If you previously placed some logic in viewWillAppear/viewWillDisappear/viewDidAppear/viewDidDisappear, be sure to check carefully!</strong> ⚠️</em></p></blockquote><blockquote><p>After looking at the built-in system, let’s get to the main point of this article! How to achieve these effects yourself?</p></blockquote><h3 id="where-can-you-perform-transition-animations"><span class="me-2">Where can you perform transition animations?</span><a href="#where-can-you-perform-transition-animations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, let’s organize where you can perform window transition animations.</p><p><a href="/assets/14cee137c565/1*G0us0AtYJCy3va1sh_bWhQ.gif" class="popup img-link "><img data-src="/assets/14cee137c565/1*G0us0AtYJCy3va1sh_bWhQ.gif" alt="UITabBarController/UIViewController/UINavigationController" class="lazyload" data-proofer-ignore></a></p><p>UITabBarController/UIViewController/UINavigationController</p><h4 id="when-switching-uitabbarcontroller"><span class="me-2">When switching UITabBarController</span><a href="#when-switching-uitabbarcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We can set the <code class="language-plaintext highlighter-rouge">delegate</code> for <code class="language-plaintext highlighter-rouge">UITabBarController</code> and implement the <code class="language-plaintext highlighter-rouge">animationControllerForTransitionFrom</code> method to apply custom transition effects when switching <code class="language-plaintext highlighter-rouge">UITabBarController</code>.</p><p>The system default has no animation. The above demonstration shows a fade-in fade-out transition effect.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">MainTabBarViewController</span><span class="p">:</span> <span class="kt">UITabBarController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">MainTabBarViewController</span><span class="p">:</span> <span class="kt">UITabBarControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">tabBarController</span><span class="p">(</span><span class="n">_</span> <span class="nv">tabBarController</span><span class="p">:</span> <span class="kt">UITabBarController</span><span class="p">,</span> <span class="n">animationControllerForTransitionFrom</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">to</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//return UIViewControllerAnimatedTransitioning</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="when-uiviewcontroller-presentsdismisses"><span class="me-2">When UIViewController Presents/Dismisses</span><a href="#when-uiviewcontroller-presentsdismisses" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Naturally, when <code class="language-plaintext highlighter-rouge">Presenting/Dismissing</code> a <code class="language-plaintext highlighter-rouge">UIViewController</code>, you can specify the animation effect to apply; otherwise, this article wouldn’t exist XD. However, it’s worth mentioning that if you only want to create a Present animation without gesture control, you can directly use <code class="language-plaintext highlighter-rouge">UIPresentationController</code> for convenience and speed (see references at the end of the article).</p><p>The system default is slide up to appear and slide down to disappear! If you customize it yourself, you can add effects such as fade-in, rounded corners, control of appearance position, etc.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">self</span><span class="o">.</span><span class="n">modalPresentationStyle</span> <span class="o">=</span> <span class="o">.</span><span class="n">custom</span>
        <span class="k">self</span><span class="o">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewControllerTransitioningDelegate</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forPresented</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">presenting</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">// Return nil to use the default animation</span>
        <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning Animation to apply when presenting</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forDismissed</span> <span class="nv">dismissed</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">// Return nil to use the default animation</span>
        <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning Animation to apply when dismissing</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><em>Any <code class="language-plaintext highlighter-rouge">UIViewController</code> can implement <code class="language-plaintext highlighter-rouge">transitioningDelegate</code> to specify <code class="language-plaintext highlighter-rouge">Present/Dismiss</code> animations; <code class="language-plaintext highlighter-rouge">UITabBarViewController</code>, <code class="language-plaintext highlighter-rouge">UINavigationController</code>, <code class="language-plaintext highlighter-rouge">UITableViewController</code>, etc. can all do this.</em></p></blockquote><h4 id="uinavigationcontroller-pushpop"><span class="me-2">UINavigationController Push/Pop</span><a href="#uinavigationcontroller-pushpop" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">UINavigationController</code> is probably the one that needs animation customization the least, because the system’s default left-slide to appear and right-slide to return animations are already the best effects. Customizing this part might be used to create seamless <code class="language-plaintext highlighter-rouge">UIViewController</code> left-right switching effects.</p><p>Since we want to enable full-page gesture returns, we need to implement a custom POP animation effect.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeNavigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeNavigationController</span><span class="p">:</span> <span class="kt">UINavigationControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">navigationController</span><span class="p">(</span><span class="n">_</span> <span class="nv">navigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="p">,</span> <span class="n">animationControllerFor</span> <span class="nv">operation</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="o">.</span><span class="kt">Operation</span><span class="p">,</span> <span class="n">from</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">to</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="o">.</span><span class="n">pop</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning Animation to apply when returning</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="o">.</span><span class="n">push</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning Animation to apply when pushing</span>
        <span class="p">}</span>
        
        <span class="c1">// Return nil to use the default animation</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="interactive-vs-non-interactive-animations"><span class="me-2">Interactive vs Non-interactive Animations?</span><a href="#interactive-vs-non-interactive-animations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Before discussing animation implementation and gesture control, let’s first talk about what interactive and non-interactive mean.</p><p><strong>Interactive Animation:</strong> Gesture-triggered animations, such as UIPanGestureRecognizer</p><p><strong>Non-interactive Animation:</strong> System-triggered animations, such as self.present( )</p><h3 id="how-to-implement-animation-effects"><span class="me-2">How to Implement Animation Effects?</span><a href="#how-to-implement-animation-effects" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After discussing where animations can be applied, let’s look at how to create animation effects.</p><p>We need to implement the <code class="language-plaintext highlighter-rouge">UIViewControllerAnimatedTransitioning</code> protocol and animate the view within it.</p><h4 id="general-transition-animation-uiviewanimate"><span class="me-2">General Transition Animation: UIView.animate</span><a href="#general-transition-animation-uiviewanimate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Directly use <code class="language-plaintext highlighter-rouge">UIView.animate</code> for animation handling. At this point, <code class="language-plaintext highlighter-rouge">UIViewControllerAnimatedTransitioning</code> needs to implement two methods: <code class="language-plaintext highlighter-rouge">transitionDuration</code> to specify the duration of the animation, and <code class="language-plaintext highlighter-rouge">animateTransition</code> to implement the animation content.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">SlideFromLeftToRightTransition</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UIViewControllerAnimatedTransitioning</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">TimeInterval</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mf">0.4</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animateTransition</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="c1">// Available parameters:</span>
        <span class="c1">// Get the view content of the target UIViewController to be displayed:</span>
        <span class="k">let</span> <span class="nv">toView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">view</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">to</span><span class="p">)</span>
        <span class="c1">// Get the target UIViewController to be displayed:</span>
        <span class="k">let</span> <span class="nv">toViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">viewController</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">to</span><span class="p">)</span>
        <span class="c1">// Get the initial frame information of the target UIViewController's view:</span>
        <span class="k">let</span> <span class="nv">toInitalFrame</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">initialFrame</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">toViewController</span><span class="o">!</span><span class="p">)</span>
        <span class="c1">// Get the final frame information of the target UIViewController's view:</span>
        <span class="k">let</span> <span class="nv">toFinalFrame</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">finalFrame</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">toViewController</span><span class="o">!</span><span class="p">)</span>
        
        <span class="c1">// Get the view content of the current UIViewController:</span>
        <span class="k">let</span> <span class="nv">fromView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">view</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">from</span><span class="p">)</span>
        <span class="c1">// Get the current UIViewController:</span>
        <span class="k">let</span> <span class="nv">fromViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">viewController</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">from</span><span class="p">)</span>
        <span class="c1">// Get the initial frame information of the current UIViewController's view:</span>
        <span class="k">let</span> <span class="nv">fromInitalFrame</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">initialFrame</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">fromViewController</span><span class="o">!</span><span class="p">)</span>
        <span class="c1">// Get the final frame information of the current UIViewController's view: (can get the final frame from the previous display animation when closing the animation)</span>
        <span class="k">let</span> <span class="nv">fromFinalFrame</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">finalFrame</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">fromViewController</span><span class="o">!</span><span class="p">)</span>
        
        <span class="c1">// toView.frame.origin.y = UIScreen.main.bounds.size.height</span>
        
        <span class="kt">UIView</span><span class="o">.</span><span class="nf">animate</span><span class="p">(</span><span class="nv">withDuration</span><span class="p">:</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">transitionContext</span><span class="p">),</span> <span class="nv">delay</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">curveLinear</span><span class="p">],</span> <span class="nv">animations</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// toView.frame.origin.y = 0</span>
        <span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">transitionContext</span><span class="o">.</span><span class="n">transitionWasCancelled</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Animation was not interrupted</span>
            <span class="p">}</span>
            
            <span class="c1">// Notify the system that the animation is complete</span>
            <span class="n">transitionContext</span><span class="o">.</span><span class="nf">completeTransition</span><span class="p">(</span><span class="o">!</span><span class="n">transitionContext</span><span class="o">.</span><span class="n">transitionWasCancelled</span><span class="p">)</span>
        <span class="p">}</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><strong><em>To and From:</em></strong></p></blockquote><blockquote><p><em>Assume today <code class="language-plaintext highlighter-rouge">HomeViewController</code> needs to <code class="language-plaintext highlighter-rouge">Present/Push</code> <code class="language-plaintext highlighter-rouge">DetailViewController</code>,</em></p></blockquote><blockquote><p><em>From = HomeViewController / To = DetailViewController</em></p></blockquote><blockquote><p><em>When <code class="language-plaintext highlighter-rouge">DetailViewController</code> needs to <code class="language-plaintext highlighter-rouge">Dismiss/Pop</code>,</em></p></blockquote><blockquote><p><em>From = DetailViewController / To = HomeViewController</em></p></blockquote><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><em>It is recommended by the official documentation to use the view from <code class="language-plaintext highlighter-rouge">transitionContext.view</code> rather than from <code class="language-plaintext highlighter-rouge">transitionContext.viewController.view</code>.</em></p></blockquote><blockquote><p><em>However, there is an issue when performing Present/Dismiss animations with <code class="language-plaintext highlighter-rouge">modalPresentationStyle = .custom</code>;</em></p></blockquote><blockquote><p><em>Using <code class="language-plaintext highlighter-rouge">transitionContext.view(forKey: .from)</code> during Present will be <strong>nil</strong>, and</em></p></blockquote><blockquote><p><em>Using <code class="language-plaintext highlighter-rouge">transitionContext.view(forKey: .to)</code> during Dismiss will also be <strong>nil</strong>;</em></p></blockquote><blockquote><p><em>You still need to get the value from viewController.view.</em></p></blockquote><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><code class="language-plaintext highlighter-rouge">transitionContext.completeTransition(!transitionContext.transitionWasCancelled)</code> <em>must be called when the animation is complete, otherwise <strong>the screen will freeze</strong>;</em></p></blockquote><blockquote><p><em>However, if <code class="language-plaintext highlighter-rouge">UIView.animate</code> has no executable animation, it will not call <code class="language-plaintext highlighter-rouge">completion</code>, causing the aforementioned method not to be called; so make sure the animation will execute (e.g., y from 100 to 0).</em></p></blockquote><p>ℹ️ℹ️ℹ️ℹ️ℹ️</p><blockquote><p><em>For <code class="language-plaintext highlighter-rouge">ToView/FromView</code> involved in the animation, if the view is more complex or there are some issues during the animation; you can use <code class="language-plaintext highlighter-rouge">snapshotView(afterScreenUpdates:)</code> to take a screenshot for the animation display. First, take a screenshot and then <code class="language-plaintext highlighter-rouge">transitionContext.containerView.addSubview(snapShotView)</code> to the layer, then hide the original <code class="language-plaintext highlighter-rouge">ToView/FromView (isHidden = true)</code>, and at the end of the animation, <code class="language-plaintext highlighter-rouge">snapShotView.removeFromSuperview()</code> and restore the original <code class="language-plaintext highlighter-rouge">ToView/FromView (isHidden = true)</code>.</em></p></blockquote><h4 id="interruptible-and-continuable-transition-animations-uiviewpropertyanimator"><span class="me-2">Interruptible and Continuable Transition Animations: UIViewPropertyAnimator</span><a href="#interruptible-and-continuable-transition-animations-uiviewpropertyanimator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>You can also use the new animation class introduced in <strong>iOS ≥ 10</strong> to implement animation effects. Choose based on personal preference or the level of detail required for the animation. Although the official recommendation is to use <code class="language-plaintext highlighter-rouge">UIViewPropertyAnimator</code> for interactive animations, <strong>generally, both interactive and non-interactive (gesture control) animations can be done using UIView.animate</strong>; <code class="language-plaintext highlighter-rouge">UIViewPropertyAnimator</code> allows for interruptible and continuable transition animations, though I’m not sure where it can be practically applied. Interested readers can refer to <a href="https://juejin.im/post/5c3aa7ff518825551e285b8d" target="_blank">this article</a>.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">FadeInFadeOutTransition</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UIViewControllerAnimatedTransitioning</span> <span class="p">{</span>
    
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">animatorForCurrentTransition</span><span class="p">:</span> <span class="kt">UIViewImplicitlyAnimating</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">interruptibleAnimator</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewImplicitlyAnimating</span> <span class="p">{</span>
        
        <span class="c1">// Return the current transition animator if it exists</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">animatorForCurrentTransition</span> <span class="o">=</span> <span class="n">animatorForCurrentTransition</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">animatorForCurrentTransition</span>
        <span class="p">}</span>
        
        <span class="c1">// Parameters as mentioned before</span>
        
        <span class="c1">// fromView.frame.origin.y = 100</span>
        
        <span class="k">let</span> <span class="nv">animator</span> <span class="o">=</span> <span class="kt">UIViewPropertyAnimator</span><span class="p">(</span><span class="nv">duration</span><span class="p">:</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">transitionContext</span><span class="p">),</span> <span class="nv">curve</span><span class="p">:</span> <span class="o">.</span><span class="n">linear</span><span class="p">)</span>
        
        <span class="n">animator</span><span class="o">.</span><span class="n">addAnimations</span> <span class="p">{</span>
            <span class="c1">// fromView.frame.origin.y = 0</span>
        <span class="p">}</span>
        
        <span class="n">animator</span><span class="o">.</span><span class="n">addCompletion</span> <span class="p">{</span> <span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="k">in</span>
            <span class="n">transitionContext</span><span class="o">.</span><span class="nf">completeTransition</span><span class="p">(</span><span class="o">!</span><span class="n">transitionContext</span><span class="o">.</span><span class="n">transitionWasCancelled</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// Hold onto the animator</span>
        <span class="k">self</span><span class="o">.</span><span class="n">animatorForCurrentTransition</span> <span class="o">=</span> <span class="n">animator</span>
        <span class="k">return</span> <span class="n">animator</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">TimeInterval</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mf">0.4</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animateTransition</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// For non-interactive transitions, use the interactive animator</span>
        <span class="k">let</span> <span class="nv">animator</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">interruptibleAnimator</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">transitionContext</span><span class="p">)</span>
        <span class="n">animator</span><span class="o">.</span><span class="nf">startAnimation</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationEnded</span><span class="p">(</span><span class="n">_</span> <span class="nv">transitionCompleted</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Clear the animator when the animation is complete</span>
        <span class="k">self</span><span class="o">.</span><span class="n">animatorForCurrentTransition</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><em>In interactive scenarios (detailed later in the control section), the <code class="language-plaintext highlighter-rouge">interruptibleAnimator</code> method is used for animations; in non-interactive scenarios, the <code class="language-plaintext highlighter-rouge">animateTransition</code> method is still used.</em></p></blockquote><blockquote><p><em>Due to its ability to continue and interrupt, the <code class="language-plaintext highlighter-rouge">interruptibleAnimator</code> method might be called repeatedly; hence, we need to use a global variable to store and access the return value.</em></p></blockquote><p><strong>Murmur…</strong> Actually, I initially wanted to switch entirely to the new <code class="language-plaintext highlighter-rouge">UIViewPropertyAnimator</code> and recommend everyone to use it, but I encountered a very strange issue. When performing a full-page gesture return Pop animation, if the gesture is released and the animation returns to its original position, the items on the Navigation Bar above will flicker with a fade-in and fade-out effect… I couldn’t find a solution, but reverting to <code class="language-plaintext highlighter-rouge">UIView.animate</code> resolved the issue. If there’s something I missed, please let me know &lt;( _ _ )&gt;.</p><p><a href="/assets/14cee137c565/1*cVg7iZ_rFC2nxm2H5ET1Gg.gif" class="popup img-link "><img data-src="/assets/14cee137c565/1*cVg7iZ_rFC2nxm2H5ET1Gg.gif" alt="Problem image; + button is from the previous page" class="lazyload" data-proofer-ignore></a></p><p>Problem image; + button is from the previous page</p><p>So, to be safe, let’s stick with the old method!</p><p>In practice, different animation effects will be created in separate classes. If you find the files too cluttered, you can refer to the packaged solution at the end of the article or group related (Present + Dismiss) animations together.</p><h4 id="transitioncoordinator"><span class="me-2">transitionCoordinator</span><a href="#transitioncoordinator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Additionally, if you need more precise control, such as having a specific component within the ViewController change along with the transition animation, you can use the <code class="language-plaintext highlighter-rouge">transitionCoordinator</code> in <code class="language-plaintext highlighter-rouge">UIViewController</code> for coordination. I didn’t use this part; if you’re interested, you can refer to <a href="https://kemchenj.github.io/2018-12-24/" target="_blank">this article</a>.</p><h3 id="how-to-control-the-animation"><span class="me-2">How to control the animation?</span><a href="#how-to-control-the-animation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This is the aforementioned “interactive” part, which is essentially gesture control. This is the most important section of this article because we aim to achieve the functionality of gesture operations linked with transition animations, enabling us to implement pull-to-close and full-page return features.</p><h4 id="control-delegate-setup"><span class="me-2">Control delegate setup:</span><a href="#control-delegate-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Similar to the <code class="language-plaintext highlighter-rouge">ViewController</code> delegate animation design mentioned earlier, the interactive handling class also needs to inform the <code class="language-plaintext highlighter-rouge">ViewController</code> in the delegate.</p><p><strong>UITabBarController: None</strong> <strong>UINavigationController (Push/Pop):</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeNavigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeNavigationController</span><span class="p">:</span> <span class="kt">UINavigationControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">navigationController</span><span class="p">(</span><span class="n">_</span> <span class="nv">navigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="p">,</span> <span class="n">animationControllerFor</span> <span class="nv">operation</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="o">.</span><span class="kt">Operation</span><span class="p">,</span> <span class="n">from</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">to</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="o">.</span><span class="n">pop</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning animation to apply when returning</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="o">.</span><span class="n">push</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning animation to apply when pushing</span>
        <span class="p">}</span>
        <span class="c1">//Returning nil will use the default animation</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    
    <span class="c1">//Add interactive delegate method:</span>
    <span class="kd">func</span> <span class="nf">navigationController</span><span class="p">(</span><span class="n">_</span> <span class="nv">navigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="p">,</span> <span class="n">interactionControllerFor</span> <span class="nv">animationController</span><span class="p">:</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerInteractiveTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//Cannot determine if it's Pop or Push here, can only judge from the animation itself</span>
        <span class="k">if</span> <span class="n">animationController</span> <span class="k">is</span> <span class="n">animation</span> <span class="n">applied</span> <span class="n">during</span> <span class="n">push</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIPercentDrivenInteractiveTransition interactive control method for push animation</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">animationController</span> <span class="k">is</span> <span class="n">animation</span> <span class="n">applied</span> <span class="n">during</span> <span class="k">return</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIPercentDrivenInteractiveTransition interactive control method for pop animation</span>
        <span class="p">}</span>
        <span class="c1">//Returning nil means no interactive handling</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>UIViewController (Present/Dismiss):</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">self</span><span class="o">.</span><span class="n">modalPresentationStyle</span> <span class="o">=</span> <span class="o">.</span><span class="n">custom</span>
        <span class="k">self</span><span class="o">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewControllerTransitioningDelegate</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">interactionControllerForDismissal</span><span class="p">(</span><span class="n">using</span> <span class="nv">animator</span><span class="p">:</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerInteractiveTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//return nil means no interactive handling</span>
        <span class="k">return</span> <span class="c1">//UIPercentDrivenInteractiveTransition method for interactive control during Dismiss</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">interactionControllerForPresentation</span><span class="p">(</span><span class="n">using</span> <span class="nv">animator</span><span class="p">:</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerInteractiveTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//return nil means no interactive handling</span>
        <span class="k">return</span> <span class="c1">//UIPercentDrivenInteractiveTransition method for interactive control during Present</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forPresented</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">presenting</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//return nil means using default animation</span>
        <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning animation to apply during Present</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forDismissed</span> <span class="nv">dismissed</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//return nil means using default animation</span>
        <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning animation to apply during Dismiss</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><em>If you implement interactionControllerFor… methods, even if the animation is non-interactive (e.g., self.present system call transition), these methods will still be called for handling; we need to control the <code class="language-plaintext highlighter-rouge">wantsInteractiveStart</code> parameter inside (introduced below).</em></p></blockquote><h4 id="animation-interactive-handling-class-uipercentdriveninteractivetransition"><span class="me-2">Animation Interactive Handling Class UIPercentDrivenInteractiveTransition:</span><a href="#animation-interactive-handling-class-uipercentdriveninteractivetransition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Next, let’s talk about the core implementation of <code class="language-plaintext highlighter-rouge">UIPercentDrivenInteractiveTransition</code>.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">PullToDismissInteractive</span><span class="p">:</span> <span class="kt">UIPercentDrivenInteractiveTransition</span> <span class="p">{</span>
    
    <span class="c1">//UIView to add gesture control interaction</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">interactiveView</span><span class="p">:</span> <span class="kt">UIView</span><span class="o">!</span>
    <span class="c1">//Current UIViewController</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="o">!</span>
    <span class="c1">//Threshold percentage to complete execution, otherwise revert</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">thredhold</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mf">0.4</span>
    
    <span class="c1">//Different transition effects may require different information, customizable</span>
    <span class="kd">convenience</span> <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">_</span> <span class="nv">interactiveView</span><span class="p">:</span> <span class="kt">UIView</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">interactiveView</span> <span class="o">=</span> <span class="n">interactiveView</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presented</span> <span class="o">=</span> <span class="n">presented</span>
        <span class="nf">setupPanGesture</span><span class="p">()</span>
        
        <span class="c1">//Default value, informs the system that the current animation is non-interactive</span>
        <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">setupPanGesture</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">panGesture</span> <span class="o">=</span> <span class="kt">UIPanGestureRecognizer</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="kd">#selector(</span><span class="nf">handlePan(_:)</span><span class="kd">)</span><span class="p">)</span>
        <span class="n">panGesture</span><span class="o">.</span><span class="n">maximumNumberOfTouches</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">panGesture</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">interactiveView</span><span class="o">.</span><span class="nf">addGestureRecognizer</span><span class="p">(</span><span class="n">panGesture</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">handlePan</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UIPanGestureRecognizer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">sender</span><span class="o">.</span><span class="n">state</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">began</span><span class="p">:</span>
            <span class="c1">//Reset gesture position</span>
            <span class="n">sender</span><span class="o">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
            <span class="c1">//Inform the system that the current animation is triggered by a gesture</span>
            <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">true</span>
            
            <span class="c1">//Call the transition effect to be performed during gesture began (won't execute directly, system will hold it)</span>
            <span class="c1">//Then the corresponding animation for the transition effect will jump to UIViewControllerAnimatedTransitioning for handling</span>
            <span class="c1">// animated must be true otherwise no animation</span>
            
            <span class="c1">//Dismiss:</span>
            <span class="k">self</span><span class="o">.</span><span class="n">presented</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="c1">//Present:</span>
            <span class="c1">//self.present(presenting,animated: true)</span>
            <span class="c1">//Push:</span>
            <span class="c1">//self.navigationController.push(presenting)</span>
            <span class="c1">//Pop:</span>
            <span class="c1">//self.navigationController.pop(animated: true)</span>
        
        <span class="k">case</span> <span class="o">.</span><span class="nv">changed</span><span class="p">:</span>
            <span class="c1">//Calculate the gesture sliding position corresponding to the animation completion percentage 0~1</span>
            <span class="c1">//Actual calculation method varies depending on the animation type</span>
            <span class="k">let</span> <span class="nv">translation</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="nf">translation</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
            <span class="k">guard</span> <span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">sender</span><span class="o">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>
            <span class="k">let</span> <span class="nv">percentage</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">interactiveView</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
            
            <span class="c1">//Update UIViewControllerAnimatedTransitioning animation percentage</span>
            <span class="nf">update</span><span class="p">(</span><span class="n">percentage</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">ended</span><span class="p">:</span>
            <span class="c1">//When the gesture is released, check if the completion percentage exceeds the threshold</span>
            <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="k">if</span> <span class="n">percentComplete</span> <span class="o">&gt;=</span> <span class="n">thredhold</span> <span class="p">{</span>
              <span class="c1">//Yes, inform the animation to complete</span>
              <span class="nf">finish</span><span class="p">()</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="c1">//No, inform the animation to revert</span>
              <span class="nf">cancel</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="o">.</span><span class="n">cancelled</span><span class="p">,</span> <span class="o">.</span><span class="nv">failed</span><span class="p">:</span>
          <span class="c1">//On cancel or error</span>
          <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
          <span class="nf">cancel</span><span class="p">()</span>
        <span class="k">default</span><span class="p">:</span>
          <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
          <span class="k">return</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//When there are UIScrollView components (UITableView/UICollectionView/WKWebView....) inside UIViewController, prevent gesture conflicts</span>
<span class="c1">//When the UIScrollView component inside has scrolled to the top, enable the gesture operation for interactive transition</span>
<span class="kd">extension</span> <span class="kt">PullToDismissInteractive</span><span class="p">:</span> <span class="kt">UIGestureRecognizerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">gestureRecognizer</span><span class="p">(</span><span class="n">_</span> <span class="nv">gestureRecognizer</span><span class="p">:</span> <span class="kt">UIGestureRecognizer</span><span class="p">,</span> <span class="n">shouldRecognizeSimultaneouslyWith</span> <span class="nv">otherGestureRecognizer</span><span class="p">:</span> <span class="kt">UIGestureRecognizer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">scrollView</span> <span class="o">=</span> <span class="n">otherGestureRecognizer</span><span class="o">.</span><span class="n">view</span> <span class="k">as?</span> <span class="kt">UIScrollView</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">scrollView</span><span class="o">.</span><span class="n">contentOffset</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p><a href="https://stackoverflow.com/questions/29558622/pan-gesture-why-need-settranslation-to-zero" target="_blank"><em>*About the reason for sender.setTranslation( .zero, in:interactiveView) supplement point I&lt;</em></a></p><p>We need to implement different Classes based on different gesture operation effects; if it is the same continuous (Present+Dismii) operation, it can also be wrapped together.</p><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><code class="language-plaintext highlighter-rouge">wantsInteractiveStart</code> <em><strong>must be in a compliant state</strong>. If <code class="language-plaintext highlighter-rouge">wantsInteractiveStart = false</code> is notified during interactive animation, it will also cause the screen to freeze;</em></p></blockquote><blockquote><p><em>You need to exit and re-enter the APP to restore it.</em></p></blockquote><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><em>interactiveView must also be <strong>isUserInteractionEnabled = true</strong></em></p></blockquote><blockquote><p><em>You can set it more to ensure it!</em></p></blockquote><h3 id="combination"><span class="me-2">Combination</span><a href="#combination" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When we set up this <code class="language-plaintext highlighter-rouge">Delegate</code> and build the <code class="language-plaintext highlighter-rouge">Class</code>, we can achieve the functionality we want. Let’s not waste any more time and go straight to the completed example.</p><h3 id="custom-pull-down-to-close-page-effect"><span class="me-2">Custom pull-down to close page effect</span><a href="#custom-pull-down-to-close-page-effect" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The advantage of custom pull-down is that it supports all iOS versions on the market, can control the overlay percentage, control the trigger close position, and customize the animation effect.</p><p><a href="/assets/14cee137c565/1*Wz8y5UJSgS0IUN86upSqLw.gif" class="popup img-link "><img data-src="/assets/14cee137c565/1*Wz8y5UJSgS0IUN86upSqLw.gif" alt="Click the top right + Present page" class="lazyload" data-proofer-ignore></a></p><p>Click the top right + Present page</p><p>This is an example of <code class="language-plaintext highlighter-rouge">HomeViewController</code> presenting <code class="language-plaintext highlighter-rouge">HomeAddViewController</code> and <code class="language-plaintext highlighter-rouge">HomeAddViewController</code> dismissing.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">addButtonTapped</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">homeAddViewController</span> <span class="o">=</span> <span class="kt">UIStoryboard</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Main"</span><span class="p">,</span> <span class="nv">bundle</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span><span class="o">.</span><span class="nf">instantiateViewController</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"HomeAddViewController"</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">HomeAddViewController</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="c1">//transitioningDelegate can be specified to handle the target ViewController or the current ViewController</span>
        <span class="n">homeAddViewController</span><span class="o">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="n">homeAddViewController</span>
        <span class="n">homeAddViewController</span><span class="o">.</span><span class="n">modalPresentationStyle</span> <span class="o">=</span> <span class="o">.</span><span class="n">custom</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">homeAddViewController</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">pullToDismissInteractive</span><span class="p">:</span> <span class="kt">PullToDismissInteractive</span><span class="o">!</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        
        <span class="c1">//Bind transition interactive information</span>
        <span class="k">self</span><span class="o">.</span><span class="n">pullToDismissInteractive</span> <span class="o">=</span> <span class="kt">PullToDismissInteractive</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="k">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewControllerTransitioningDelegate</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">interactionControllerForDismissal</span><span class="p">(</span><span class="n">using</span> <span class="nv">animator</span><span class="p">:</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerInteractiveTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pullToDismissInteractive</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forPresented</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">presenting</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">PresentAndDismissTransition</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forDismissed</span> <span class="nv">dismissed</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">PresentAndDismissTransition</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">interactionControllerForPresentation</span><span class="p">(</span><span class="n">using</span> <span class="nv">animator</span><span class="p">:</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerInteractiveTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//No Present operation gesture here</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">PullToDismissInteractive</span><span class="p">:</span> <span class="kt">UIPercentDrivenInteractiveTransition</span> <span class="p">{</span>
    
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">interactiveView</span><span class="p">:</span> <span class="kt">UIView</span><span class="o">!</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="o">!</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">threshold</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mf">0.4</span>
    
    <span class="kd">convenience</span> <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">_</span> <span class="nv">interactiveView</span><span class="p">:</span> <span class="kt">UIView</span><span class="p">,</span> <span class="n">_</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">interactiveView</span> <span class="o">=</span> <span class="n">interactiveView</span>
        <span class="k">self</span><span class="o">.</span><span class="n">completion</span> <span class="o">=</span> <span class="n">completion</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presented</span> <span class="o">=</span> <span class="n">presented</span>
        <span class="nf">setupPanGesture</span><span class="p">()</span>
        
        <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">setupPanGesture</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">panGesture</span> <span class="o">=</span> <span class="kt">UIPanGestureRecognizer</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="kd">#selector(</span><span class="nf">handlePan(_:)</span><span class="kd">)</span><span class="p">)</span>
        <span class="n">panGesture</span><span class="o">.</span><span class="n">maximumNumberOfTouches</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">panGesture</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">interactiveView</span><span class="o">.</span><span class="nf">addGestureRecognizer</span><span class="p">(</span><span class="n">panGesture</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">handlePan</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UIPanGestureRecognizer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">sender</span><span class="o">.</span><span class="n">state</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">began</span><span class="p">:</span>
            <span class="n">sender</span><span class="o">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
            <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">true</span>
            
            <span class="k">self</span><span class="o">.</span><span class="n">presented</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">completion</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">changed</span><span class="p">:</span>
            <span class="k">let</span> <span class="nv">translation</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="nf">translation</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
            <span class="k">guard</span> <span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">sender</span><span class="o">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>

            <span class="k">let</span> <span class="nv">percentage</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">interactiveView</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
            <span class="nf">update</span><span class="p">(</span><span class="n">percentage</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">ended</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">percentComplete</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="p">{</span>
                <span class="nf">finish</span><span class="p">()</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
                <span class="nf">cancel</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="o">.</span><span class="n">cancelled</span><span class="p">,</span> <span class="o">.</span><span class="nv">failed</span><span class="p">:</span>
            <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="nf">cancel</span><span class="p">()</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="k">return</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">PullToDismissInteractive</span><span class="p">:</span> <span class="kt">UIGestureRecognizerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">gestureRecognizer</span><span class="p">(</span><span class="n">_</span> <span class="nv">gestureRecognizer</span><span class="p">:</span> <span class="kt">UIGestureRecognizer</span><span class="p">,</span> <span class="n">shouldRecognizeSimultaneouslyWith</span> <span class="nv">otherGestureRecognizer</span><span class="p">:</span> <span class="kt">UIGestureRecognizer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">scrollView</span> <span class="o">=</span> <span class="n">otherGestureRecognizer</span><span class="o">.</span><span class="n">view</span> <span class="k">as?</span> <span class="kt">UIScrollView</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">scrollView</span><span class="o">.</span><span class="n">contentOffset</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>With the above, you can achieve the effect shown in the image. The code here is quite messy due to the simplicity of the tutorial, and there is much room for optimization and integration.</p><blockquote><p><strong><em>Worth mentioning…</em></strong></p></blockquote><blockquote><p><em>iOS ≥ 13, if the View contains a UITextView, during the pull-down close animation, the text content of the UITextView will be blank; causing a flicker in the experience <a href="https://twitter.com/zhgchgli/status/1207851671553892352" target="_blank">(video example)</a> …</em></p></blockquote><blockquote><p><em>The solution here is to use <code class="language-plaintext highlighter-rouge">snapshotView(afterScreenUpdates:)</code> to replace the original View layer during the animation.</em></p></blockquote><h3 id="full-page-right-swipe-back"><span class="me-2">Full-page right swipe back</span><a href="#full-page-right-swipe-back" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When looking for a solution to enable right swipe back gesture for the entire screen, I found a <strong>Tricky</strong> method: Directly add a <code class="language-plaintext highlighter-rouge">UIPanGestureRecognizer</code> to the screen and then set the <code class="language-plaintext highlighter-rouge">target</code> and <code class="language-plaintext highlighter-rouge">action</code> to the native <code class="language-plaintext highlighter-rouge">interactivePopGestureRecognizer</code>, <code class="language-plaintext highlighter-rouge">action:handleNavigationTransition</code>. <a href="https://juejin.im/entry/5795809dd342d30059ed5c60" target="_blank"><em>*Detailed method click me&lt;</em></a></p><p>That’s right! It looks like a Private API, and it feels like it might get rejected during review; also, it’s uncertain if it works with Swift, as it might use Runtime features specific to Objective-C.</p><h4 id="lets-go-the-proper-way"><span class="me-2">Let’s go the proper way:</span><a href="#lets-go-the-proper-way" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Using the same method as in this article, we handle the <code class="language-plaintext highlighter-rouge">navigationController</code> POP back ourselves; add a full-page right swipe gesture control with a custom right swipe animation!</p><p>Other parts are omitted, only the key animation and interaction handling class is posted:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre>import UIKit

class SwipeBackInteractive: UIPercentDrivenInteractiveTransition {
    
    private var interactiveView: UIView!
    private var navigationController: UINavigationController!

    private let threshold: CGFloat = 0.4
    
    convenience init(_ navigationController: UINavigationController, _ interactiveView: UIView) {
        self.init()
        self.interactiveView = interactiveView
        
        self.navigationController = navigationController
        setupPanGesture()
        
        wantsInteractiveStart = false
    }

    private func setupPanGesture() {
        let panGesture = UIPanGestureRecognizer(target: self, action: #selector(handlePan(_:)))
        panGesture.maximumNumberOfTouches = 1
        interactiveView.addGestureRecognizer(panGesture)
    }

    @objc func handlePan(_ sender: UIPanGestureRecognizer) {
        
        switch sender.state {
        case .began:
            sender.setTranslation(.zero, in: interactiveView)
            wantsInteractiveStart = true
            
            self.navigationController.popViewController(animated: true)
        case .changed:
            let translation = sender.translation(in: interactiveView)
            guard translation.x &gt;= 0 else {
                sender.setTranslation(.zero, in: interactiveView)
                return
            }

            let percentage = abs(translation.x / interactiveView.bounds.width)
            update(percentage)
        case .ended:
            if percentComplete &gt;= threshold {
                finish()
            } else {
                wantsInteractiveStart = false
                cancel()
            }
        case .cancelled, .failed:
            wantsInteractiveStart = false
            cancel()
        default:
            wantsInteractiveStart = false
            return
        }
    }
}
</pre></table></code></div></div><h3 id="pull-up-fade-in-uiviewcontroller"><span class="me-2">Pull-up fade-in UIViewController</span><a href="#pull-up-fade-in-uiviewcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>On the View, pull up to fade in + pull down to close, which creates a transition effect similar to Spotify’s player!</p><p>This part is more tedious, but the principle is the same. I won’t post it here, but interested friends can refer to the GitHub example content.</p><p>One thing to note is that <strong>when pulling up to fade in, the animation must ensure that it uses “.curveLinear” linear, otherwise there will be a problem where the pull-up does not follow the hand</strong>; the degree of pull and the displayed position are not proportional.</p><h3 id="completed"><span class="me-2">Completed!</span><a href="#completed" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/14cee137c565/1*RRAVb3p7mZpUCNOpd64-Pw.gif" class="popup img-link "><img data-src="/assets/14cee137c565/1*RRAVb3p7mZpUCNOpd64-Pw.gif" alt="Completed Image" class="lazyload" data-proofer-ignore></a></p><p>Completed Image</p><blockquote><p>This article is very long and took me a long time to organize and produce. Thank you for your patience in reading.</p></blockquote><h4 id="full-github-example-download"><span class="me-2">Full GitHub example download:</span><a href="#full-github-example-download" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/zhgchgli0718/UIViewControllerTransitionDemo" target="_blank" class="img-link shimmer" ><img data-src="https://opengraph.githubassets.com/af405b87d71ea95f59b19f5de94bda740a12566ddf86eb5a9b34d2271d53bb20/zhgchgli0718/UIViewControllerTransitionDemo" alt="" class="lazyload" data-proofer-ignore></a></p><p><strong>References:</strong></p><ol><li><a href="https://imnotyourson.com/draggable-view-controller-interactive-view-controller/" target="_blank">Draggable view controller? Interactive view controller!</a><li><a href="https://juejin.im/post/5c24745b6fb9a049d5198ce5#18-%E5%AF%BC%E8%88%AA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%BD%AC%E5%9C%BA" target="_blank">Systematic study of iOS animations part four: View controller transition animations</a><li><a href="https://juejin.im/post/5c3aa7ff518825551e285b8d" target="_blank">Systematic study of iOS animations part five: Using UIViewPropertyAnimator</a><li><a href="https://juejin.im/post/5a9651d25188257a5911f666" target="_blank">Using UIPresentationController to write a simple and beautiful bottom pop-up control</a> (Simply for Present animation effects, you can directly use this)</ol><p><strong>For elegant code encapsulation references:</strong></p><ol><li>Swift: <a href="https://github.com/Kharauzov/SwipeableCards" target="_blank">https://github.com/Kharauzov/SwipeableCards</a><li>Objective-C: <a href="https://github.com/saiday/DraggableViewControllerDemo" target="_blank">https://github.com/saiday/DraggableViewControllerDemo</a></ol><p>If you have any questions or comments, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/14cee137c565/" target="_blank">本文中文版本</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ➡️ <a href="https://medium.com/p/14cee137c565" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=🍺&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/uiviewcontroller/" class="post-tag no-text-decoration" >uiviewcontroller</a> <a href="/tags/mobile-app-development/" class="post-tag no-text-decoration" >mobile-app-development</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20UIViewController%20Transition%20Techniques%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F14cee137c565%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20UIViewController%20Transition%20Techniques%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F14cee137c565%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F14cee137c565%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ≥ 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/e37d66ea1146/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539454069" data-df="ll" > Oct 14, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS UITextView Text Wrapping Editor (Swift)</h4><div class="text-muted small"><p> iOS UITextView Text Wrapping Editor (Swift) Practical Route Target Functionality: The app has a discussion area where users can post articles. The interface for posting articles needs to support...</p></div></div></a></div><div class="col"> <a href="/posts/c5e7e580c341/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1556551801" data-df="ll" > Apr 29, 2019 </em><h4 class="pt-0 my-2" data-toc-skip>Perfect Implementation of One-Time Offers or Trials in iOS (Swift)</h4><div class="text-muted small"><p> Perfect Implementation of One-Time Offers or Trials in iOS (Swift) iOS DeviceCheck follows you everywhere While writing the previous Call Directory Extension, I accidentally discovered this obscu...</p></div></div></a></div><div class="col"> <a href="/posts/cb6eba52a342/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539618241" data-df="ll" > Oct 15, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS ≥ 10 Notification Service Extension Application (Swift)</h4><div class="text-muted small"><p> iOS ≥ 10 Notification Service Extension Application (Swift) Image push notifications, push notification display statistics, pre-processing before push notification display Regarding the basics of...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/b08ef940c196/" class="btn btn-outline-primary" prompt="Older" ><p>iOS Deferred Deep Link Implementation (Swift)</p></a> <a href="/posts/94a4020edb82/" class="btn btn-outline-primary" prompt="Newer" ><p>Mi Home APP / Xiao Ai Speaker Region Issues</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">中文版網站</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
