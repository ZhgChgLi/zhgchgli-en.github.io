<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Write Run Script Directly in Swift with Xcode!" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Introducing Localization multi-language and Image Assets missing check, using Swift to create Run Script" /><meta property="og:description" content="Introducing Localization multi-language and Image Assets missing check, using Swift to create Run Script" /><link rel="canonical" href="https://en.zhgchg.li/posts/41c49a75a743/" /><meta property="og:url" content="https://en.zhgchg.li/posts/41c49a75a743/" /><meta property="og:site_name" content="ZhgChgLi" /><meta property="og:image" content="https://en.zhgchg.li/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-09-17T23:53:20+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://en.zhgchg.li/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.jpeg" /><meta property="twitter:title" content="Write Run Script Directly in Swift with Xcode!" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@ZhgChgLi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi"},"dateModified":"2024-04-13T16:35:25+08:00","datePublished":"2020-09-17T23:53:20+08:00","description":"Introducing Localization multi-language and Image Assets missing check, using Swift to create Run Script","headline":"Write Run Script Directly in Swift with Xcode!","image":"https://en.zhgchg.li/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://en.zhgchg.li/posts/41c49a75a743/"},"url":"https://en.zhgchg.li/posts/41c49a75a743/"}</script><title>Write Run Script Directly in Swift with Xcode! | ZhgChgLi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi"><meta name="application-name" content="ZhgChgLi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ZhgChgLi</a></div><div class="site-subtitle fst-italic">Live a life you will remember.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/real/" class="nav-link"> <i class="fa-fw fa fa-camera-retro"></i> <span>REAL LIFE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Write Run Script Directly in Swift with Xcode!</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Write Run Script Directly in Swift with Xcode!</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1600358000" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 17, 2020 </em> </span> <span> Updated <em class="" data-ts="1712997325" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.jpeg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.jpeg" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4225 words" > <em>23 min</em> read</span></div></div></div><div class="post-content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><h3 id="write-shell-script-directly-in-swift-with-xcode"><span class="me-2">Write Shell Script Directly in Swift with Xcode!</span><a href="#write-shell-script-directly-in-swift-with-xcode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Introducing Localization multi-language and Image Assets missing check, using Swift to create Shell Script</p><p><a href="/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.jpeg" class="popup img-link "><img data-src="/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.jpeg" alt="Photo by [Glenn Carstens-Peters](https://unsplash.com/@glenncarstenspeters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" class="lazyload" data-proofer-ignore></a></p><p>Photo by <a href="https://unsplash.com/@glenncarstenspeters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">Glenn Carstens-Peters</a></p><h3 id="background"><span class="me-2">Background</span><a href="#background" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Because of my clumsiness, I often miss the ‚Äú;‚Äù when editing multi-language files, causing the app to display the wrong language after building. Additionally, as development progresses, the language files become increasingly large, with repeated and unused phrases mixed together, making it very chaotic (the same situation applies to Image Assets).</p><p>I have always wanted to find a tool to help handle these issues. Previously, I used <a href="https://github.com/igorkulman/iOSLocalizationEditor" target="_blank">iOSLocalizationEditor</a>, a Mac APP, but it is more like a language file editor that reads and edits language file content without automatic checking functionality.</p><h3 id="desired-features"><span class="me-2">Desired Features</span><a href="#desired-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Automatically check for errors, omissions, duplicates in multi-language files, and missing Image Assets when building the project.</p><h3 id="solution"><span class="me-2">Solution</span><a href="#solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To achieve our desired features, we need to add a Run Script check script in Build Phases.</p><p>However, the check script needs to be written using shell script. Since my proficiency in shell script is not very high, I thought of standing on the shoulders of giants and searching for existing scripts online but couldn‚Äôt find any that fully met the desired features. Just when I was about to give up, I suddenly thought:</p><blockquote><p><strong>Shell Script can be written in Swift</strong>!</p></blockquote><p>Compared to shell script, I am more familiar and proficient with Swift! Following this direction, I indeed found two existing tool scripts!</p><p>Two checking tools written by the <a href="https://freshos.github.io/" target="_blank">freshOS</a> team:</p><ul><li><a href="https://github.com/freshOS/Localize" target="_blank"><strong>Localize üèÅ</strong></a><li><a href="https://github.com/s4cha/AssetChecker" target="_blank"><strong>Asset Checker üëÆ</strong></a></ul><p>They fully meet our desired feature requirements! And since they are written in Swift, customizing and modifying them is very easy.</p><h4 id="localize--multi-language-file-checking-tool"><span class="me-2"><a href="https://github.com/freshOS/Localize" target="_blank">Localize üèÅ</a> Multi-language File Checking Tool</span><a href="#localize--multi-language-file-checking-tool" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>Features:</strong></p><ul><li>Automatic check during build<li>Automatic formatting and organizing of language files<li>Check for omissions and redundancies between multi-language and primary language files<li>Check for duplicate phrases in multi-language files<li>Check for untranslated phrases in multi-language files<li>Check for unused phrases in multi-language files</ul><p><strong>Installation Method:</strong></p><ol><li><a href="https://github.com/freshOS/Localize/blob/master/Localize.swift" target="_blank">Download the Swift Script file of the tool</a><li>Place it in the project directory, e.g., <code class="language-plaintext highlighter-rouge">${SRCROOT}/Localize.swift</code><li>Open project settings ‚Üí iOS Target ‚Üí Build Phases ‚Üí click the ‚Äú+‚Äù in the top left corner ‚Üí New Run Script Phases ‚Üí paste the path in the Script content, e.g., <code class="language-plaintext highlighter-rouge">${SRCROOT}/Localize.swift</code></ol><p><a href="/assets/41c49a75a743/1*k2OHjrcQaQIWLqV7G57TgA.png" class="popup img-link "><img data-src="/assets/41c49a75a743/1*k2OHjrcQaQIWLqV7G57TgA.png" alt="" class="lazyload" data-proofer-ignore></a></p><ol><li>Use Xcode to open and edit the <code class="language-plaintext highlighter-rouge">Localize.swift</code> file for configuration. You can see the configurable items in the upper part of the file: ```swift // Enable the check script let enabled = true</ol><p>// Localization file directory let relativeLocalizableFolders = ‚Äú/Resources/Languages‚Äù</p><p>// Project directory (used to search if the phrases are used in the code) let relativeSourceFolder = ‚Äú/Sources‚Äù</p><p>// Regular expression patterns for NSLocalized phrases in the code // You can add your own without changing the existing ones let patterns = [ ‚ÄúNSLocalized(Format)?String\(\s<em>@?"([\w\.]+)"‚Äù, // Swift and Objc Native ‚ÄúLocalizations\.((?:[A-Z]{1}[a-z]</em>[A-z]<em>)</em>(?:\.[A-Z]{1}[a-z]<em>[A-z]</em>)<em>)‚Äù, // Laurine Calls ‚ÄúL10n.tr\(key: "(\w+)"‚Äù, // SwiftGen generation ‚ÄúypLocalized\("(.</em>)"\)‚Äù, ‚Äú"(.*)".localized‚Äù // ‚Äúkey‚Äù.localized pattern ]</p><p>// Phrases to ignore for ‚Äúunused phrase warning‚Äù let ignoredFromUnusedKeys: [String] = [] /* example let ignoredFromUnusedKeys = [ ‚ÄúNotificationNoOne‚Äù, ‚ÄúNotificationCommentPhoto‚Äù, ‚ÄúNotificationCommentHisPhoto‚Äù, ‚ÄúNotificationCommentHerPhoto‚Äù ] */</p><p>// Main language let masterLanguage = ‚Äúen‚Äù</p><p>// Enable a-z sorting and organizing functionality for localization files let sanitizeFiles = false</p><p>// Is the project single or multi-language let singleLanguage = false</p><p>// Enable check for untranslated phrases let checkForUntranslated = true</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre>
5. Build! Success!

![](/assets/41c49a75a743/1*74osParg9RRi2gcRx9ELuw.png)

**Check result prompt types:**
- **Build Error** ‚ùå **:**
  - \[Duplication\] The item is duplicated in the localization file
  - \[Unused Key\] The item is defined in the localization file but not used in the actual code
  - \[Missing\] The item is used in the actual code but not defined in the localization file
  - \[Redundant\] The item is redundant in this localization file compared to the main localization file
  - \[Missing Translation\] The item exists in the main localization file but is missing in this localization file
- **Build Warning** ‚ö†Ô∏è **:**
  - \[Potentially Untranslated\] This item is untranslated (same content as the main localization file)

&gt; **_Not done yet, now we have automatic check prompts, but we still need to customize a bit._**

**Custom regular expression matching:**

Looking back at the patterns section in the top configuration block of the check script `Localize.swift`:

`"NSLocalized(Format)?String\\(\\s*@?\"([\\w\\.]+)\""`

This matches the `NSLocalizedString()` method in Swift/ObjC, but this regular expression can only match phrases like `"Home.Title"`. If we have full sentences or phrases with format parameters, they will be mistakenly marked as \[Unused Key\].

EX: `"Hi, %@ welcome to my app", "Hello World!"` **&lt;- These phrases cannot be matched**

We can add a new pattern setting or change the original pattern to:

`"NSLocalized(Format)?String\\(\\s*@?\"([^(\")]+)\""`

The main adjustment is to match any string until the `"` appears, stopping there. You can also [click here](https://rubular.com/r/5eXvGy3svsAHyT){:target="_blank"} to customize according to your needs.

**Add Language File Format Check Functionality:**

This script only checks the content of language files for correspondence and does not check if the file format is correct (whether a ";" is missing). If you need this functionality, you need to add it yourself!
```swift
//....
let formatResult = shell("plutil -lint \(location)")
guard formatResult.trimmingCharacters(in: .whitespacesAndNewlines).suffix(2) == "OK" else {
  let str = "\(path)/\(name).lproj"
            + "/Localizable.strings:1: "
            + "error: [File Invalid] "
            + "This Localizable.strings file format is invalid."
  print(str)
  numberOfErrors += 1
  return
}
//....

func shell(_ command: String) -&gt; String {
    let task = Process()
    let pipe = Pipe()

    task.standardOutput = pipe
    task.arguments = ["-c", command]
    task.launchPath = "/bin/bash"
    task.launch()

    let data = pipe.fileHandleForReading.readDataToEndOfFile()
    let output = String(data: data, encoding: .utf8)!

    return output
}
</pre></table></code></div></div><p>Add <code class="language-plaintext highlighter-rouge">shell()</code> to execute shell scripts, using <code class="language-plaintext highlighter-rouge">plutil -lint</code> to check the correctness of the plist language file format. If there are errors or missing ‚Äú;‚Äù, it will return an error; if there are no errors, it will return <code class="language-plaintext highlighter-rouge">OK</code> as the judgment!</p><p>The check can be added after LocalizationFiles-&gt;process( )-&gt; <code class="language-plaintext highlighter-rouge">let location = singleLanguage‚Ä¶</code>, around line 135, or refer to the complete modified version I provided at the end.</p><p><strong>Other Customizations:</strong></p><p>We can customize according to our needs, such as changing error to warning or removing a certain check function (EX: Potentially Untranslated, Unused Key); the script is in Swift, which we are all familiar with! No fear of breaking or making mistakes!</p><p>To show Error ‚ùå during build:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>print("ProjectFile.lproj" + "/File:Line: " + "error: ErrorMessage")
</pre></table></code></div></div><p>To show Warning ‚ö†Ô∏è during build:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>print("ProjectFile.lproj" + "/File:Line: " + "warning: WarningMessage")
</pre></table></code></div></div><p><strong>Final Modified Version:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
</pre><td class="rouge-code"><pre><span class="cp">#!/usr/bin/env xcrun --sdk macosx swift</span>

<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="c1">// WHAT</span>
<span class="c1">// 1. Find Missing keys in other Localisation files</span>
<span class="c1">// 2. Find potentially untranslated keys</span>
<span class="c1">// 3. Find Duplicate keys</span>
<span class="c1">// 4. Find Unused keys and generate script to delete them all at once</span>

<span class="c1">// MARK: Start Of Configurable Section</span>

<span class="cm">/*
 You can enable or disable the script whenever you want
 */</span>
<span class="k">let</span> <span class="nv">enabled</span> <span class="o">=</span> <span class="kc">true</span>

<span class="cm">/*
 Put your path here, example -&gt;  Resources/Localizations/Languages
 */</span>
<span class="k">let</span> <span class="nv">relativeLocalizableFolders</span> <span class="o">=</span> <span class="s">"/streetvoice/SupportingFiles"</span>

<span class="cm">/*
 This is the path of your source folder which will be used in searching
 for the localization keys you actually use in your project
 */</span>
<span class="k">let</span> <span class="nv">relativeSourceFolder</span> <span class="o">=</span> <span class="s">"/streetvoice"</span>

<span class="cm">/*
 Those are the regex patterns to recognize localizations.
 */</span>
<span class="k">let</span> <span class="nv">patterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"NSLocalized(Format)?String</span><span class="se">\\</span><span class="s">(</span><span class="se">\\</span><span class="s">s*@?</span><span class="se">\"</span><span class="s">([^(</span><span class="se">\"</span><span class="s">)]+)</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// Swift and Objc Native</span>
    <span class="s">"Localizations</span><span class="se">\\</span><span class="s">.((?:[A-Z]{1}[a-z]*[A-z]*)*(?:</span><span class="se">\\</span><span class="s">.[A-Z]{1}[a-z]*[A-z]*)*)"</span><span class="p">,</span> <span class="c1">// Laurine Calls</span>
    <span class="s">"L10n.tr</span><span class="se">\\</span><span class="s">(key: </span><span class="se">\"</span><span class="s">(</span><span class="se">\\</span><span class="s">w+)</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// SwiftGen generation</span>
    <span class="s">"ypLocalized</span><span class="se">\\</span><span class="s">(</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"\\</span><span class="s">)"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"</span><span class="s">.localized"</span> <span class="c1">// "key".localized pattern</span>
<span class="p">]</span>

<span class="cm">/*
 Those are the keys you don't want to be recognized as "unused"
 For instance, Keys that you concatenate will not be detected by the parsing
 so you want to add them here in order not to create false positives :)
 */</span>
<span class="k">let</span> <span class="nv">ignoredFromUnusedKeys</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="cm">/* example
let ignoredFromUnusedKeys = [
    "NotificationNoOne",
    "NotificationCommentPhoto",
    "NotificationCommentHisPhoto",
    "NotificationCommentHerPhoto"
]
*/</span>

<span class="k">let</span> <span class="nv">masterLanguage</span> <span class="o">=</span> <span class="s">"base"</span>

<span class="cm">/*
 Sanitizing files will remove comments, empty lines and order your keys alphabetically.
 */</span>
<span class="k">let</span> <span class="nv">sanitizeFiles</span> <span class="o">=</span> <span class="kc">false</span>

<span class="cm">/*
 Determines if there are multiple localizations or not.
 */</span>
<span class="k">let</span> <span class="nv">singleLanguage</span> <span class="o">=</span> <span class="kc">false</span>

<span class="cm">/*
 Determines if we should show errors if there's a key within the app
 that does not appear in master translations.
*/</span>
<span class="k">let</span> <span class="nv">checkForUntranslated</span> <span class="o">=</span> <span class="kc">false</span>

<span class="c1">// MARK: End Of Configurable Section</span>

<span class="k">if</span> <span class="n">enabled</span> <span class="o">==</span> <span class="kc">false</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Localization check cancelled"</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mo">000</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Detect list of supported languages automatically</span>
<span class="kd">func</span> <span class="nf">listSupportedLanguages</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">sl</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="n">currentDirectoryPath</span> <span class="o">+</span> <span class="n">relativeLocalizableFolders</span>
    <span class="k">if</span> <span class="o">!</span><span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">fileExists</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Invalid configuration: </span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s"> does not exist."</span><span class="p">)</span>
        <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">extensionName</span> <span class="o">=</span> <span class="s">"lproj"</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Found these languages:"</span><span class="p">)</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">element</span> <span class="o">=</span> <span class="n">enumerator</span><span class="p">?</span><span class="o">.</span><span class="nf">nextObject</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="n">extensionName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">".</span><span class="se">\(</span><span class="n">extensionName</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span>
            <span class="n">sl</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sl</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">supportedLanguages</span> <span class="o">=</span> <span class="nf">listSupportedLanguages</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">ignoredFromSameTranslation</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[:]</span>
<span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="n">currentDirectoryPath</span> <span class="o">+</span> <span class="n">relativeLocalizableFolders</span>
<span class="k">var</span> <span class="nv">numberOfWarnings</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">var</span> <span class="nv">numberOfErrors</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">struct</span> <span class="kt">LocalizationFiles</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">name</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">var</span> <span class="nv">keyValue</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
    <span class="k">var</span> <span class="nv">linesNumbers</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nf">process</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">process</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">sanitizeFiles</span> <span class="p">{</span>
            <span class="nf">removeCommentsFromFile</span><span class="p">()</span>
            <span class="nf">removeEmptyLinesFromFile</span><span class="p">()</span>
            <span class="nf">sortLinesAlphabetically</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="n">singleLanguage</span> <span class="p">?</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/Localizable.strings"</span> <span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings"</span>
        
        <span class="k">let</span> <span class="nv">formatResult</span> <span class="o">=</span> <span class="nf">shell</span><span class="p">(</span><span class="s">"plutil -lint </span><span class="se">\(</span><span class="n">location</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">guard</span> <span class="n">formatResult</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span><span class="o">.</span><span class="nf">suffix</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s">"OK"</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj"</span>
                <span class="o">+</span> <span class="s">"/Localizable.strings:1: "</span>
                <span class="o">+</span> <span class="s">"error: [File Invalid] "</span>
                <span class="o">+</span> <span class="s">"This Localizable.strings file format is invalid."</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
            <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="o">.</span><span class="n">newlines</span><span class="p">)</span>
        <span class="n">keyValue</span> <span class="o">=</span> <span class="p">[:]</span>

        <span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"</span><span class="s"> = </span><span class="se">\"</span><span class="s">(.+)</span><span class="se">\"</span><span class="s">;"</span>
        <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">pattern</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
        <span class="k">var</span> <span class="nv">ignoredTranslation</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">lineNumber</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">in</span> <span class="n">lines</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="p">(</span><span class="n">line</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>

            <span class="c1">// Ignored pattern</span>
            <span class="k">let</span> <span class="nv">ignoredPattern</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"</span><span class="s"> = </span><span class="se">\"</span><span class="s">(.+)</span><span class="se">\"</span><span class="s">; *</span><span class="se">\\</span><span class="s">/</span><span class="se">\\</span><span class="s">/ *ignore-same-translation-warning"</span>
            <span class="k">let</span> <span class="nv">ignoredRegex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">ignoredPattern</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">ignoredMatch</span> <span class="o">=</span> <span class="n">ignoredRegex</span><span class="p">?</span><span class="o">.</span><span class="nf">firstMatch</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">line</span><span class="p">,</span>
                                                           <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span>
                                                           <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">ignoredMatch</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">ignoredTranslation</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="k">let</span> <span class="nv">firstMatch</span> <span class="o">=</span> <span class="n">regex</span><span class="p">?</span><span class="o">.</span><span class="nf">firstMatch</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">line</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">firstMatch</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">firstMatch</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">2</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">keyValue</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj"</span>
                        <span class="o">+</span> <span class="s">"/Localizable.strings:</span><span class="se">\(</span><span class="n">linesNumbers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">: "</span>
                        <span class="o">+</span> <span class="s">"error: [Duplication] </span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s"> "</span>
                        <span class="o">+</span> <span class="s">"is duplicated in </span><span class="se">\(</span><span class="n">name</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span><span class="se">)</span><span class="s"> file"</span>
                    <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
                    <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">keyValue</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">linesNumbers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineNumber</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">ignoredFromSameTranslation</span><span class="p">)</span>
        <span class="n">ignoredFromSameTranslation</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ignoredTranslation</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">rebuildFileString</span><span class="p">(</span><span class="n">from</span> <span class="nv">lines</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">r</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">s</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="nf">in</span>
            <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="s">""</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">removeEmptyLinesFromFile</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="o">.</span><span class="n">newlines</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespaces</span><span class="p">)</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">}</span>
            <span class="k">let</span> <span class="nv">s</span> <span class="o">=</span> <span class="nf">rebuildFileString</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">lines</span><span class="p">)</span>
            <span class="k">try</span><span class="p">?</span> <span class="n">s</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">toFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">removeCommentsFromFile</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="o">.</span><span class="n">newlines</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="o">!</span><span class="nv">$0</span><span class="o">.</span><span class="nf">hasPrefix</span><span class="p">(</span><span class="s">"//"</span><span class="p">)</span> <span class="p">}</span>
            <span class="k">let</span> <span class="nv">s</span> <span class="o">=</span> <span class="nf">rebuildFileString</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">lines</span><span class="p">)</span>
            <span class="k">try</span><span class="p">?</span> <span class="n">s</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">toFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sortLinesAlphabetically</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="o">.</span><span class="n">newlines</span><span class="p">)</span>

            <span class="k">var</span> <span class="nv">s</span> <span class="o">=</span> <span class="s">""</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="k">in</span> <span class="nf">sortAlphabetically</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">l</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">lines</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">try</span><span class="p">?</span> <span class="n">s</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">toFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">removeEmptyLinesFromLines</span><span class="p">(</span><span class="n">_</span> <span class="nv">lines</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespaces</span><span class="p">)</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sortAlphabetically</span><span class="p">(</span><span class="n">_</span> <span class="nv">lines</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="nf">sorted</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Load Localisation Files in memory</span>

<span class="k">let</span> <span class="nv">masterLocalizationFile</span> <span class="o">=</span> <span class="kt">LocalizationFiles</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="n">masterLanguage</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">localizationFiles</span> <span class="o">=</span> <span class="n">supportedLanguages</span>
    <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">!=</span> <span class="n">masterLanguage</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">LocalizationFiles</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>

<span class="c1">// MARK: - Detect Unused Keys</span>

<span class="k">let</span> <span class="nv">sourcesPath</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="n">currentDirectoryPath</span> <span class="o">+</span> <span class="n">relativeSourceFolder</span>
<span class="k">let</span> <span class="nv">fileManager</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span>
<span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="n">fileManager</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">sourcesPath</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">localizedStrings</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">swiftFileLocation</span> <span class="o">=</span> <span class="n">enumerator</span><span class="p">?</span><span class="o">.</span><span class="nf">nextObject</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="c1">// checks the extension</span>
    <span class="k">if</span> <span class="n">swiftFileLocation</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="n">swiftFileLocation</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="n">swiftFileLocation</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".mm"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcesPath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">swiftFileLocation</span><span class="se">)</span><span class="s">"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">p</span> <span class="k">in</span> <span class="n">patterns</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
                <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="p">(</span><span class="n">string</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="c1">// Obj c wa</span>
                <span class="n">regex</span><span class="p">?</span><span class="o">.</span><span class="nf">enumerateMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
                                        <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span>
                                        <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">,</span>
                                        <span class="nv">using</span><span class="p">:</span> <span class="p">{</span> <span class="n">result</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
                                            <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
                                                <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">numberOfRanges</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                                                <span class="n">localizedStrings</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                                            <span class="p">}</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">masterKeys</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">keyValue</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">usedKeys</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">ignored</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="n">ignoredFromUnusedKeys</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">unused</span> <span class="o">=</span> <span class="n">masterKeys</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">usedKeys</span><span class="p">)</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">ignored</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">untranslated</span> <span class="o">=</span> <span class="n">usedKeys</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">masterKeys</span><span class="p">)</span>

<span class="c1">// Here generate Xcode regex Find and replace script to remove dead keys all at once!</span>
<span class="k">var</span> <span class="nv">replaceCommand</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">("</span>
<span class="k">var</span> <span class="nv">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">v</span> <span class="k">in</span> <span class="n">unused</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings:</span><span class="se">\(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">linesNumbers</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">: "</span>
    <span class="n">str</span> <span class="o">+=</span> <span class="s">"error: [Unused Key] </span><span class="se">\"\(</span><span class="n">v</span><span class="se">)\"</span><span class="s"> is never used"</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">replaceCommand</span> <span class="o">+=</span> <span class="s">"|"</span>
    <span class="p">}</span>
    <span class="n">replaceCommand</span> <span class="o">+=</span> <span class="n">v</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="n">unused</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="n">replaceCommand</span> <span class="o">+=</span> <span class="s">")</span><span class="se">\"</span><span class="s"> = </span><span class="se">\"</span><span class="s">.*</span><span class="se">\"</span><span class="s">;"</span>
    <span class="p">}</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="n">replaceCommand</span><span class="p">)</span>

<span class="c1">// MARK: - Compare each translation file against master (en)</span>

<span class="k">for</span> <span class="n">file</span> <span class="k">in</span> <span class="n">localizationFiles</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">keyValue</span><span class="o">.</span><span class="n">keys</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">keyValue</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings:</span><span class="se">\(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">linesNumbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">: "</span>
            <span class="n">str</span> <span class="o">+=</span> <span class="s">"error: [Missing] </span><span class="se">\"\(</span><span class="n">k</span><span class="se">)\"</span><span class="s"> missing from </span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span><span class="se">)</span><span class="s"> file"</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
            <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">redundantKeys</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">keyValue</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="o">!</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">keyValue</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>

    <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="n">redundantKeys</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings:</span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">linesNumbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">: "</span>
            <span class="o">+</span> <span class="s">"error: [Redundant key] </span><span class="se">\"\(</span><span class="n">k</span><span class="se">)\"</span><span class="s"> redundant in </span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span><span class="se">)</span><span class="s"> file"</span>

        <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">checkForUntranslated</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">key</span> <span class="k">in</span> <span class="n">untranslated</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings:1: "</span>
        <span class="n">str</span> <span class="o">+=</span> <span class="s">"error: [Missing Translation] </span><span class="se">\(</span><span class="n">key</span><span class="se">)</span><span class="s"> is not translated"</span>

        <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
        <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="s">"Number of warnings : </span><span class="se">\(</span><span class="n">numberOfWarnings</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"Number of errors : </span><span class="se">\(</span><span class="n">numberOfErrors</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">numberOfErrors</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">shell</span><span class="p">(</span><span class="n">_</span> <span class="nv">command</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">Process</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">pipe</span> <span class="o">=</span> <span class="kt">Pipe</span><span class="p">()</span>

    <span class="n">task</span><span class="o">.</span><span class="n">standardOutput</span> <span class="o">=</span> <span class="n">pipe</span>
    <span class="n">task</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="s">"-c"</span><span class="p">,</span> <span class="n">command</span><span class="p">]</span>
    <span class="n">task</span><span class="o">.</span><span class="n">launchPath</span> <span class="o">=</span> <span class="s">"/bin/bash"</span>
    <span class="n">task</span><span class="o">.</span><span class="nf">launch</span><span class="p">()</span>

    <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fileHandleForReading</span><span class="o">.</span><span class="nf">readDataToEndOfFile</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">output</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>

    <span class="k">return</span> <span class="n">output</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><strong><em>Finally, it‚Äôs not over yet!</em></strong></p></blockquote><p>When our Swift check tool script is fully debugged, we need to <strong>compile it into an executable to reduce build time</strong>. Otherwise, it will need to be recompiled every time we build (this can reduce the time by about 90%).</p><p>Open the terminal and navigate to the directory where the check tool script is located in the project, then execute:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>swiftc <span class="nt">-o</span> Localize Localize.swift
</pre></table></code></div></div><p><a href="/assets/41c49a75a743/1*rwq_KZIDW-Lvtpd2xmgjDw.png" class="popup img-link "><img data-src="/assets/41c49a75a743/1*rwq_KZIDW-Lvtpd2xmgjDw.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/41c49a75a743/1*BCKtqshZxHH17j3nBGtNlg.png" class="popup img-link "><img data-src="/assets/41c49a75a743/1*BCKtqshZxHH17j3nBGtNlg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Then go back to Build Phases and change the Script content path to the executable</p><p>EX: <code class="language-plaintext highlighter-rouge">${SRCROOT}/Localize</code></p><p><a href="/assets/41c49a75a743/1*ewhCXzXNuS0MCTMCuINWng.png" class="popup img-link "><img data-src="/assets/41c49a75a743/1*ewhCXzXNuS0MCTMCuINWng.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><strong>Done!</strong></p><h4 id="tool-2-asset-checker--image-resource-check-tool"><span class="me-2">Tool 2. <a href="https://github.com/s4cha/AssetChecker" target="_blank"><strong>Asset Checker üëÆ</strong></a> <strong>Image Resource Check Tool</strong></span><a href="#tool-2-asset-checker--image-resource-check-tool" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>Features:</strong></p><ul><li>Automatically checks during build<li>Checks for missing images: names are called, but the image resource directory does not contain them<li>Checks for redundant images: names are not used, but the image resource directory contains them</ul><p><strong>Installation Method:</strong></p><ol><li><a href="https://github.com/freshOS/AssetChecker/blob/master/Classes/main.swift" target="_blank">Download the tool‚Äôs Swift Script file</a><li>Place it in the project directory EX: <code class="language-plaintext highlighter-rouge">${SRCROOT}/AssetChecker.swift</code><li>Open project settings ‚Üí iOS Target ‚Üí Build Phases ‚Üí top left ‚Äú+‚Äù ‚Üí New Run Script Phases ‚Üí paste the path in the Script content</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span>/AssetChecker.swift <span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span>/project_directory <span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span>/Resources/Images.xcassets
//<span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span>/Resources/Images.xcassets <span class="o">=</span> the location of your .xcassets
</pre></table></code></div></div><p><a href="/assets/41c49a75a743/1*TPLS60W1iQiGFzU-inf3aA.png" class="popup img-link "><img data-src="/assets/41c49a75a743/1*TPLS60W1iQiGFzU-inf3aA.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>You can directly set the parameters in the path, parameter 1: project directory location, parameter 2: image resource directory location; or edit the <code class="language-plaintext highlighter-rouge">AssetChecker.swift</code> top parameter setting block like the localization check tool:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Configure me \o/</span>

<span class="c1">// Project directory location (used to search if images are used in the code)</span>
<span class="k">var</span> <span class="nv">sourcePathOption</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="c1">// .xcassets directory location</span>
<span class="k">var</span> <span class="nv">assetCatalogPathOption</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="c1">// Unused warning ignore items</span>
<span class="k">let</span> <span class="nv">ignoredUnusedNames</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
</pre></table></code></div></div><ol><li>Build! Success!</ol><p><strong>Check Result Prompt Types:</strong></p><ul><li><strong>Build Error</strong> ‚ùå <strong>:</strong> - [Asset Missing] The item is called in the code but does not appear in the image resource directory<li><strong>Build Warning</strong> ‚ö†Ô∏è <strong>:</strong> - [Asset Unused] The item is not used in the code but appears in the image resource directory <em>p.s. If the image is provided by a dynamic variable, the check tool will not recognize it. You can add it to <code class="language-plaintext highlighter-rouge">ignoredUnusedNames</code> as an exception.</em></ul><p>Other operations are the same as the localization check tool, so they won‚Äôt be repeated here; the most important thing is to <strong>remember to compile it into an executable after debugging and change the run script content to the executable!</strong></p><h4 id="develop-your-own-tools"><span class="me-2">Develop Your Own Tools!</span><a href="#develop-your-own-tools" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><strong><em>We can refer to the image resource check tool script:</em></strong></p></blockquote><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre><td class="rouge-code"><pre><span class="cp">#!/usr/bin/env xcrun --sdk macosx swift</span>

<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="c1">// Configure me \o/</span>
<span class="k">var</span> <span class="nv">sourcePathOption</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="k">var</span> <span class="nv">assetCatalogPathOption</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="k">let</span> <span class="nv">ignoredUnusedNames</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="k">in</span> <span class="kt">CommandLine</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">index</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sourcePathOption</span> <span class="o">=</span> <span class="n">arg</span>
    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">assetCatalogPathOption</span> <span class="o">=</span> <span class="n">arg</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">sourcePath</span> <span class="o">=</span> <span class="n">sourcePathOption</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"AssetChecker:: error: Source path was missing!"</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">assetCatalogAbsolutePath</span> <span class="o">=</span> <span class="n">assetCatalogPathOption</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"AssetChecker:: error: Asset Catalog path was missing!"</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="s">"Searching sources in </span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s"> for assets in </span><span class="se">\(</span><span class="n">assetCatalogAbsolutePath</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>

<span class="cm">/* Put here the asset generating false positives, 
 For instance when you build asset names at runtime
let ignoredUnusedNames = [
    "IconArticle",
    "IconMedia",
    "voteEN",
    "voteES",
    "voteFR"
] 
*/</span>

<span class="c1">// MARK : - End Of Configurable Section</span>
<span class="kd">func</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">_</span> <span class="nv">enumerator</span><span class="p">:</span> <span class="kt">FileManager</span><span class="o">.</span><span class="kt">DirectoryEnumerator</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">elements</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">e</span> <span class="o">=</span> <span class="n">enumerator</span><span class="p">?</span><span class="o">.</span><span class="nf">nextObject</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="n">elements</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">elements</span>
<span class="p">}</span>

<span class="c1">// MARK: - List Assets</span>
<span class="kd">func</span> <span class="nf">listAssets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">extensionName</span> <span class="o">=</span> <span class="s">"imageset"</span>
    <span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">assetCatalogAbsolutePath</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="n">extensionName</span><span class="p">)</span> <span class="p">}</span>                             <span class="c1">// Is Asset</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">".</span><span class="se">\(</span><span class="n">extensionName</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Remove extension</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="s">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">last</span> <span class="p">??</span> <span class="nv">$0</span> <span class="p">}</span>                 <span class="c1">// Remove folder path</span>
<span class="p">}</span>

<span class="c1">// MARK: - List Used Assets in the codebase</span>
<span class="kd">func</span> <span class="nf">localizedStrings</span><span class="p">(</span><span class="nv">inStringFile</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">localizedStrings</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="k">let</span> <span class="nv">namePattern</span> <span class="o">=</span> <span class="s">"([</span><span class="se">\\</span><span class="s">w-]+)"</span>
    <span class="k">let</span> <span class="nv">patterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"#imageLiteral</span><span class="se">\\</span><span class="s">(resourceName: </span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"\\</span><span class="s">)"</span><span class="p">,</span> <span class="c1">// Image Literal</span>
        <span class="s">"UIImage</span><span class="se">\\</span><span class="s">(named:</span><span class="se">\\</span><span class="s">s*</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"\\</span><span class="s">)"</span><span class="p">,</span> <span class="c1">// Default UIImage call (Swift)</span>
        <span class="s">"UIImage imageNamed:</span><span class="se">\\</span><span class="s">s*</span><span class="se">\\</span><span class="s">@</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// Default UIImage call </span>
        <span class="s">"</span><span class="se">\\</span><span class="s">&lt;image name=</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"</span><span class="s">.*"</span><span class="p">,</span> <span class="c1">// Storyboard resources</span>
        <span class="s">"R.image.</span><span class="se">\(</span><span class="n">namePattern</span><span class="se">)\\</span><span class="s">(</span><span class="se">\\</span><span class="s">)"</span> <span class="c1">//R.swift support</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="k">in</span> <span class="n">patterns</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
        <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:(</span><span class="n">inStringFile</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">regex</span><span class="p">?</span><span class="o">.</span><span class="nf">enumerateMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">inStringFile</span><span class="p">,</span><span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">inStringFile</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span><span class="n">r</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">localizedStrings</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">localizedStrings</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">listUsedAssetLiterals</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span><span class="n">sourcePath</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">)</span>
    
    <span class="cp">#if swift(&gt;=4.1)</span>
        <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".xib"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".storyboard"</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// Only Swift and Obj-C files</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span> <span class="p">}</span>                              <span class="c1">// Build file paths</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)}</span>    <span class="c1">// Get file contents</span>
            <span class="o">.</span><span class="n">compactMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>
            <span class="o">.</span><span class="n">compactMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                             <span class="c1">// Remove nil entries</span>
            <span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>                                      <span class="c1">// Find localizedStrings occurrences</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Flatten</span>
    <span class="cp">#else</span>
        <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".xib"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".storyboard"</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// Only Swift and Obj-C files</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span> <span class="p">}</span>                              <span class="c1">// Build file paths</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)}</span>    <span class="c1">// Get file contents</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Remove nil entries</span>
            <span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>                                      <span class="c1">// Find localizedStrings occurrences</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Flatten</span>
    <span class="cp">#endif</span>
<span class="p">}</span>

<span class="c1">// MARK: - Beginning of script</span>
<span class="k">let</span> <span class="nv">assets</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="nf">listAssets</span><span class="p">())</span>
<span class="k">let</span> <span class="nv">used</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="nf">listUsedAssetLiterals</span><span class="p">()</span> <span class="o">+</span> <span class="n">ignoredUnusedNames</span><span class="p">)</span>

<span class="c1">// Generate Warnings for Unused Assets</span>
<span class="k">let</span> <span class="nv">unused</span> <span class="o">=</span> <span class="n">assets</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">used</span><span class="p">)</span>
<span class="n">unused</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">assetCatalogAbsolutePath</span><span class="se">)</span><span class="s">:: warning: [Asset Unused] </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="p">}</span>

<span class="c1">// Generate Error for broken Assets</span>
<span class="k">let</span> <span class="nv">broken</span> <span class="o">=</span> <span class="n">used</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
<span class="n">broken</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">assetCatalogAbsolutePath</span><span class="se">)</span><span class="s">:: error: [Asset Missing] </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="p">}</span>

<span class="k">if</span> <span class="n">broken</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Compared to the language check script, this script is concise and has all the important functions, making it very valuable for reference!</p><p><em>P.S. You can see the code has the <code class="language-plaintext highlighter-rouge">localizedStrings()</code> naming, suspecting the author borrowed the logic from the language check tool and forgot to change the method name XD</em></p><p><strong>Example:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="k">in</span> <span class="kt">CommandLine</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">index</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1">// Parameter 1</span>
    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1">// Parameter 2</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>^ Method to receive external parameters</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">_</span> <span class="nv">enumerator</span><span class="p">:</span> <span class="kt">FileManager</span><span class="o">.</span><span class="kt">DirectoryEnumerator</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">elements</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">e</span> <span class="o">=</span> <span class="n">enumerator</span><span class="p">?</span><span class="o">.</span><span class="nf">nextObject</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="n">elements</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">elements</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">localizedStrings</span><span class="p">(</span><span class="nv">inStringFile</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">localizedStrings</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="k">let</span> <span class="nv">namePattern</span> <span class="o">=</span> <span class="s">"([</span><span class="se">\\</span><span class="s">w-]+)"</span>
    <span class="k">let</span> <span class="nv">patterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"#imageLiteral</span><span class="se">\\</span><span class="s">(resourceName: </span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"\\</span><span class="s">)"</span><span class="p">,</span> <span class="c1">// Image Literal</span>
        <span class="s">"UIImage</span><span class="se">\\</span><span class="s">(named:</span><span class="se">\\</span><span class="s">s*</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"\\</span><span class="s">)"</span><span class="p">,</span> <span class="c1">// Default UIImage call (Swift)</span>
        <span class="s">"UIImage imageNamed:</span><span class="se">\\</span><span class="s">s*</span><span class="se">\\</span><span class="s">@</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// Default UIImage call </span>
        <span class="s">"</span><span class="se">\\</span><span class="s">&lt;image name=</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"</span><span class="s">.*"</span><span class="p">,</span> <span class="c1">// Storyboard resources</span>
        <span class="s">"R.image.</span><span class="se">\(</span><span class="n">namePattern</span><span class="se">)\\</span><span class="s">(</span><span class="se">\\</span><span class="s">)"</span> <span class="c1">//R.swift support</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="k">in</span> <span class="n">patterns</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
        <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:(</span><span class="n">inStringFile</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">regex</span><span class="p">?</span><span class="o">.</span><span class="nf">enumerateMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">inStringFile</span><span class="p">,</span><span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">inStringFile</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span><span class="n">r</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">localizedStrings</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">localizedStrings</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">listUsedAssetLiterals</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span><span class="n">sourcePath</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">)</span>
    
    <span class="cp">#if swift(&gt;=4.1)</span>
        <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".xib"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".storyboard"</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// Only Swift and Obj-C files</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span> <span class="p">}</span>                              <span class="c1">// Build file paths</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)}</span>    <span class="c1">// Get file contents</span>
            <span class="o">.</span><span class="n">compactMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>
            <span class="o">.</span><span class="n">compactMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                             <span class="c1">// Remove nil entries</span>
            <span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>                                      <span class="c1">// Find localizedStrings occurrences</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Flatten</span>
    <span class="cp">#else</span>
        <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".xib"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".storyboard"</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// Only Swift and Obj-C files</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span> <span class="p">}</span>                              <span class="c1">// Build file paths</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)}</span>    <span class="c1">// Get file contents</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Remove nil entries</span>
            <span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>                                      <span class="c1">// Find localizedStrings occurrences</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Flatten</span>
    <span class="cp">#endif</span>
<span class="p">}</span>
</pre></table></code></div></div><p>^Traverse all project files and perform regex matching</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// To make an Error ‚ùå appear during build:</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"ProjectFile.lproj"</span> <span class="o">+</span> <span class="s">"/file:line: "</span> <span class="o">+</span> <span class="s">"error: error message"</span><span class="p">)</span>
<span class="c1">// To make a Warning ‚ö†Ô∏è appear during build:</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"ProjectFile.lproj"</span> <span class="o">+</span> <span class="s">"/file:line: "</span> <span class="o">+</span> <span class="s">"warning: warning message"</span><span class="p">)</span>
</pre></table></code></div></div><p>^print error or warning</p><p>You can refer to the above code methods to create your own desired tools.</p><h3 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After introducing these two checking tools, we can develop more confidently, efficiently, and reduce redundancy; also, this experience has been eye-opening, and in the future, if there are any new build run script requirements, we can directly use the most familiar language, Swift, to create them!</p><p>If you have any questions or feedback, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>===</p><p><a href="https://zhgchg.li/posts/41c49a75a743/" target="_blank">Êú¨Êñá‰∏≠ÊñáÁâàÊú¨</a></p><p>===</p><p>This article was first published in Traditional Chinese on Medium ‚û°Ô∏è <a href="https://medium.com/p/41c49a75a743" target="_blank"><strong>View Here</strong></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill" width="560" height="60" autoscale="on" adaptive="414"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script></div><hr/> <a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer!&emoji=üç∫&slug=zhgchgli&button_colour=FFDD00&font_colour=000000&font_family=Bree&outline_colour=000000&coffee_colour=ffffff" class="lazyload" data-proofer-ignore></a> <br/> <a href="https://medium.com/@zhgchgli" target="_blank" class="img-link shimmer" ><img data-src="/assets/images/followmymedium.png" class="lazyload" data-proofer-ignore></a> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3184248473087645" data-ad-slot="7555148040"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/zrealm/'>ZRealm</a>, <a href='/categories/dev/'>Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/shell-script/" class="post-tag no-text-decoration" >shell-script</a> <a href="/tags/xcode/" class="post-tag no-text-decoration" >xcode</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/toolkit/" class="post-tag no-text-decoration" >toolkit</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Write%20Run%20Script%20Directly%20in%20Swift%20with%20Xcode!%20-%20ZhgChgLi&url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F41c49a75a743%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Write%20Run%20Script%20Directly%20in%20Swift%20with%20Xcode!%20-%20ZhgChgLi&u=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F41c49a75a743%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fen.zhgchg.li%2Fposts%2F41c49a75a743%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/d9a95d4224ea/">Medium Custom Domain Feature Returns</a><li class="text-truncate lh-lg"> <a href="/posts/483af5d93297/">Custom Domain Tutorial for Github Pages</a><li class="text-truncate lh-lg"> <a href="/posts/9e43897d99fc/">Behavior Change in Merging NSAttributedString Attributes Range in iOS ‚â• 18</a><li class="text-truncate lh-lg"> <a href="/posts/b08ef940c196/">iOS Deferred Deep Link Implementation (Swift)</a><li class="text-truncate lh-lg"> <a href="/posts/12c5026da33d/">What's New with Universal Links</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/e37d66ea1146/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539454069" data-df="ll" > Oct 14, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS UITextView Text Wrapping Editor (Swift)</h4><div class="text-muted small"><p> iOS UITextView Text Wrapping Editor (Swift) Practical Route Target Functionality: The app has a discussion area where users can post articles. The interface for posting articles needs to support...</p></div></div></a></div><div class="col"> <a href="/posts/cb6eba52a342/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539618241" data-df="ll" > Oct 15, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>iOS ‚â• 10 Notification Service Extension Application (Swift)</h4><div class="text-muted small"><p> iOS ‚â• 10 Notification Service Extension Application (Swift) Image push notifications, push notification display statistics, pre-processing before push notification display Regarding the basics of...</p></div></div></a></div><div class="col"> <a href="/posts/9a9aa892f9a9/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1539705684" data-df="ll" > Oct 17, 2018 </em><h4 class="pt-0 my-2" data-toc-skip>Exploring Vision‚Ää‚Äî‚ÄäAutomatic Face Detection and Cropping for Profile Pictures (Swift)</h4><div class="text-muted small"><p> Exploring Vision‚Ää‚Äî‚ÄäAutomatic Face Detection and Cropping for Profile Pictures (Swift) Practical Application of Vision [2024/08/13 Update] Refer to the new article and API: ‚ÄúiOS Vision framewor...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/8a04443024e2/" class="btn btn-outline-primary" prompt="Older" ><p>iOS 14 Clipboard Data Theft Panic: The Dilemma of Privacy and Convenience</p></a> <a href="/posts/eab0e984043/" class="btn btn-outline-primary" prompt="Newer" ><p>Apple Watch Series 6 Unboxing & Two-Year Usage Experience</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/unboxing/">unboxing</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">Life</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/nsattributedstring/">nsattributedstring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> <br/> <a href="https://zhgchg.li" target="_blank">‰∏≠ÊñáÁâàÁ∂≤Á´ô</a><br/> Powered by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</p><p>¬© 2024 <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JSGN97L56L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JSGN97L56L'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
